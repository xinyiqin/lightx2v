<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SekoTalkæ•°å­—äººæœåŠ¡</title>
    <link rel="icon" type="image/png" href="/icon/logoblack.png">
    <link rel="shortcut icon" type="image/png" href="/icon/logoblack.png">
    <link rel="apple-touch-icon" href="/icon/logoblack.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ä¸»è¦å›¾æ ‡åº“ -->
    <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- å¤‡ç”¨å›¾æ ‡åº“ -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" media="print" onload="this.media='all'">
    <!-- æœ¬åœ°å¤‡ç”¨å›¾æ ‡ï¼ˆå¦‚æœCDNéƒ½å¤±è´¥ï¼‰ -->
    <link rel="stylesheet" href="/static/styles.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#9a72ff', // ä¸»ç´«è‰²
                        secondary: '#1b1240', // æ·±ç´«è‰²èƒŒæ™¯
                        accent: '#b78bff', // äº®ç´«è‰²å¼ºè°ƒ
                        dark: '#0b0a20', // æ·±è‰²èƒŒæ™¯
                        'dark-light': '#0f0e22', // ç¨äº®çš„æ·±è‰²
                        'laser-purple': '#9a72ff', // æ¿€å…‰ç´«è‰²
                        'neon-purple': '#b78bff', // éœ“è™¹ç´«è‰²
                        'electric-purple': '#7c6aff', // ç”µå…‰ç´«è‰²
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                    boxShadow: {
                        'neon': '0 0 10px rgba(154, 114, 255, 0.5), 0 0 20px rgba(154, 114, 255, 0.3)',
                        'neon-lg': '0 0 15px rgba(154, 114, 255, 0.7), 0 0 30px rgba(154, 114, 255, 0.5)',
                        'laser': '0 0 20px rgba(154, 114, 255, 0.8), 0 0 40px rgba(154, 114, 255, 0.6), 0 0 60px rgba(154, 114, 255, 0.4), 0 0 80px rgba(154, 114, 255, 0.2)',
                        'laser-intense': '0 0 25px rgba(154, 114, 255, 0.9), 0 0 50px rgba(154, 114, 255, 0.7), 0 0 75px rgba(154, 114, 255, 0.5), 0 0 100px rgba(154, 114, 255, 0.3), 0 0 125px rgba(154, 114, 255, 0.1)',
                        'electric': '0 0 15px rgba(124, 106, 255, 0.8), 0 0 30px rgba(124, 106, 255, 0.6), 0 0 45px rgba(124, 106, 255, 0.4)'
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">

        [v-cloak] { display: none; }
        
        /* é¢„æ£€æŸ¥ç™»å½•çŠ¶æ€ï¼Œå‡å°‘é—ªçƒ
        .login-container {
            display: var(--initial-login-state, block);
        } */
        /* ç¡®ä¿htmlå’Œbodyèƒ½å¤Ÿæ­£ç¡®å¡«å…… */
        html {
            height: 100%;
        }

        /* ç¡®ä¿bodyå’Œappå®¹å™¨èƒ½å¤Ÿæ­£ç¡®å¡«å…… */
        body {
            margin: 0;
            padding: 0;
            width: 125vw;
            height: 125vh;
            overflow-x: hidden;
            overflow-y: auto;
            /* æ•´ä½“ç¼©æ”¾80% */
            transform: scale(0.8);
            transform-origin: top left;
        }


        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-gradient {
                background-clip: text;
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
            }
            /* æ–°å¢æ¸å˜å›¾æ ‡é¢œè‰²ç±» */
            .text-gradient-icon {
                background: linear-gradient(135deg, #d2c1ff, #a88bff, #8e88ff);
                -webkit-background-clip: text;
                background-clip: text;
                -webkit-text-fill-color: transparent;
            }
            .scrollbar-thin {
                scrollbar-width: thin;
            }
            .scrollbar-thin::-webkit-scrollbar {
                width: 4px;
            }
            .scrollbar-thin::-webkit-scrollbar-thumb {
                background-color: rgba(210, 193, 255, 0.6);
                border-radius: 2px;
            }

            /* å†å²ä»»åŠ¡åŒºåŸŸæ»šåŠ¨æ¡æ ·å¼ - ä¸ä¸»å†…å®¹åŒºåŸŸä¿æŒä¸€è‡´ */
            .history-tasks-scroll::-webkit-scrollbar {
                width: 8px !important;
            }

            .history-tasks-scroll::-webkit-scrollbar-track {
                background: rgba(27, 18, 64, 0.3) !important;
                border-radius: 4px;
            }

            .history-tasks-scroll::-webkit-scrollbar-thumb {
                background: linear-gradient(135deg, rgba(210, 193, 255, 0.8), rgba(168, 139, 255, 0.8)) !important;
                border-radius: 4px;
                border: 1px solid rgba(210, 193, 255, 0.3);
            }

            .history-tasks-scroll::-webkit-scrollbar-thumb:hover {
                background: linear-gradient(135deg, rgba(210, 193, 255, 1), rgba(168, 139, 255, 1)) !important;
            }

            /* ç¡®ä¿å†å²ä»»åŠ¡åŒºåŸŸå¯ä»¥æ­£å¸¸æ»šåŠ¨ */
            .history-tasks-scroll {
                scroll-behavior: smooth;
                -webkit-overflow-scrolling: touch;
                /* ç§»é™¤max-heighté™åˆ¶ï¼Œè®©flex-1å æ®æ‰€æœ‰å¯ç”¨ç©ºé—´ */
            }

            /* ä¸»å†…å®¹åŒºåŸŸæ»šåŠ¨æ¡æ ·å¼ */
            .content-area::-webkit-scrollbar {
                width: 8px;
            }

            .content-area::-webkit-scrollbar-track {
                background: rgba(27, 18, 64, 0.3);
                border-radius: 4px;
            }

            .content-area::-webkit-scrollbar-thumb {
                background: linear-gradient(135deg, rgba(210, 193, 255, 0.8), rgba(168, 139, 255, 0.8));
                border-radius: 4px;
                border: 1px solid rgba(210, 193, 255, 0.3);
            }

            .content-area::-webkit-scrollbar-thumb:hover {
                background: linear-gradient(135deg, rgba(210, 193, 255, 1), rgba(168, 139, 255, 1));
            }

            /* ç¡®ä¿å†…å®¹å¯ä»¥æ­£å¸¸æ»šåŠ¨ */
            .content-area {
                scroll-behavior: smooth;
                -webkit-overflow-scrolling: touch;
            }
            .animate-pulse-slow {
                animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 0.5) infinite;
            }
            .animate-electric-pulse {
                animation: electricPulse 1.5s ease-in-out infinite;
            }
            @keyframes electricPulse {
                0%, 100% {
                    box-shadow: 0 0 15px rgba(142, 136, 255, 0.8), 0 0 30px rgba(142, 136, 255, 0.6);
                    transform: scale(1);
                }
                50% {
                    box-shadow: 0 0 25px rgba(142, 136, 255, 1), 0 0 50px rgba(142, 136, 255, 0.8), 0 0 75px rgba(142, 136, 255, 0.4);
                    transform: scale(1.02);
                }
            }
            .bg-laser-gradient {
                background: linear-gradient(135deg, #d2c1ff 0%, #a88bff 25%, #8e88ff 50%, #d2c1ff 75%, #a88bff 100%);
                background-size: 200% 200%;
                animation: gradientShift 3s ease-in-out infinite;
            }
            @keyframes gradientShift {
                0%, 100% { background-position: 0% 50%; }
                50% { background-position: 100% 50%; }
            }
            .text-laser-glow {
                text-shadow: 0 0 10px rgba(154, 114, 255, 0.8), 0 0 20px rgba(154, 114, 255, 0.6), 0 0 30px rgba(154, 114, 255, 0.4);
            }
            .border-laser {
                border-color: #d2c1ff;
                box-shadow: 0 0 15px rgba(154, 114, 255, 0.6), inset 0 0 15px rgba(154, 114, 255, 0.1);
            }
            .btn-primary{
                padding: 15px 25px;
                border-radius: 14px;
                font-weight: 500;
                font-size: 14px;
                letter-spacing: 0.2px;
                font-family: 'Inter', sans-serif;
                background: linear-gradient(135deg, #d2c1ff, #a88bff, #8e88ff);
                border: 0;
                text-decoration: none;
                box-shadow: 0 10px 30px rgba(140, 110, 255, 0.4);
                transition: transform 0.15s ease, box-shadow 0.15s ease;
            }
            .btn-primary:hover{
                transform: translateY(-1px);
                box-shadow: 0 14px 40px rgba(140, 110, 255, 0.55);
            }

            /* ä¿®å¤å¸ƒå±€é—®é¢˜ */
            .task-type-btn {
                padding: 0.75rem 1rem;
                font-size: 0.875rem;
                font-weight: 500;
                transition-property: color, background-color;
                transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
                transition-duration: 150ms;
            }

            .task-type-btn:hover {
                background-color: rgba(154, 114, 255, 0.1);
            }

            .model-selection {
                display: flex;
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .upload-section {
                display: grid;
                grid-template-columns: repeat(1, minmax(0, 1fr));
                gap: 1.5rem;
                margin-bottom: 1.5rem;
            }

            @media (min-width: 768px) {
                .upload-section {
                    grid-template-columns: repeat(2, minmax(0, 1fr));
                }
            }

            .upload-area {
                position: relative;
                border: 2px dashed rgba(154, 114, 255, 0.4);
                border-radius: 0.75rem;
                padding: 1.5rem;
                text-align: center;
                transition-property: all;
                transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
                transition-duration: 150ms;
                cursor: pointer;
                background-color: rgba(27, 18, 64, 0.1);
                min-height: 250px; /* ç¡®ä¿ä¸Šä¼ åŒºåŸŸæœ‰æœ€å°é«˜åº¦ï¼Œé˜²æ­¢é¢„è§ˆæ—¶é«˜åº¦æ”¶ç¼© */
            }

            .upload-area:hover {
                border-color: rgba(154, 114, 255, 0.7);
                box-shadow: 0 0 20px rgba(154, 114, 255, 0.8), 0 0 40px rgba(154, 114, 255, 0.6), 0 0 60px rgba(154, 114, 255, 0.4), 0 0 80px rgba(154, 114, 255, 0.2);
            }

            .upload-icon {
                margin: 0 auto;
                width: 4rem;
                height: 4rem;
                background-color: rgba(154, 114, 255, 0.2);
                border-radius: 9999px;
                display: flex;
                align-items: center;
                justify-content: center;
                margin-bottom: 1rem;
                transition-property: all;
                transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
                transition-duration: 150ms;
            }

            .upload-area:hover .upload-icon {
                background-color: rgba(154, 114, 255, 0.3);
            }

            /* å›¾ç‰‡é¢„è§ˆå æ®æ•´ä¸ªä¸Šä¼ åŒºåŸŸ */
            .image-preview {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                overflow: hidden;
                z-index: 10;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
            }

            .image-preview img {
                height: 100%;
                width: auto;
                max-width: 100%;
                display: block;
                margin: 0 auto;
                object-fit: contain;
                transition: all 0.3s ease;
            }

            /* éŸ³é¢‘é¢„è§ˆå æ®æ•´ä¸ªä¸Šä¼ åŒºåŸŸ */
            .audio-preview {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                border-radius: 0.75rem;
                overflow: hidden;
                z-index: 10;
                display: flex;
                align-items: center;
                justify-content: center;
                background-color: rgba(154, 114, 255, 0.1);
                border: 2px solid rgba(154, 114, 255, 0.3);
                cursor: pointer;
            }

            .audio-preview audio {
                width: 90%;
                height: 60px;
                max-height: 80%;
                border-radius: 0.5rem;
                background-color: rgba(27, 18, 64, 0.3);
                display: block;
            }

            /* ç¡®ä¿éŸ³é¢‘æ§ä»¶åœ¨å®¹å™¨ä¸­æ­£ç¡®æ˜¾ç¤º */
            .audio-preview audio::-webkit-media-controls {
                background-color: rgba(27, 18, 64, 0.5);
                border-radius: 0.5rem;
            }

            /* ä¸Šä¼ å†…å®¹æ ·å¼ */
            .upload-content {
                width: 100%;
                height: 100%;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
            }

            .btn-close {
                position: absolute;
                top: 0.5rem;
                right: 0.5rem;
                background-color: #ef4444;
                color: white;
                border-radius: 9999px;
                width: 1.5rem;
                height: 1.5rem;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 0.75rem;
                cursor: pointer;
                z-index: 20;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            }

            /* ç¡®ä¿flexboxå¸ƒå±€æ­£ç¡® */
            #app {
                display: flex;
                width: 100%;
                height: 100%;
            }

            .bg-linear-dark {
                background-color: linear-gradient(135deg, #0b0a20 0%, #1b1240 50%, #0f0e22 100%);
            }

            aside {
                flex-shrink: 0;
                width: 280px; /* é»˜è®¤å±•å¼€å®½åº¦ */
                min-width: 3rem; /* æœ€å°å®½åº¦ */
                max-width: 500px; /* æœ€å¤§å®½åº¦ */
                background-color: linear-gradient(135deg, #0b0a20 0%, #1b1240 50%, #0f0e22 100%);
                border-right: 1px solid rgba(154, 114, 255, 0.4);
                display: flex;
                flex-direction: column;
                transition-property: all;
                transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
                transition-duration: 300ms;
                z-index: 10;
                position: relative;
            }

            /* æ‹–æ‹½è°ƒæ•´å™¨ */
            .resize-handle {
                position: absolute;
                top: 0;
                right: 0;
                width: 6px;
                height: 100%;
                background: transparent;
                cursor: col-resize;
                z-index: 50;
                transition: background-color 0.2s ease;
            }

            .resize-handle:hover {
                background: rgba(154, 114, 255, 0.5);
            }

            .resize-handle:active {
                background: rgba(154, 114, 255, 0.8);
            }

            /* ç¡®ä¿æ‹–æ‹½æ‰‹æŸ„å¯è§ */
            .resize-handle::before {
                content: '';
                position: absolute;
                top: 50%;
                right: 1px;
                width: 2px;
                height: 20px;
                background: rgba(154, 114, 255, 0.3);
                transform: translateY(-50%);
                border-radius: 1px;
            }

            /* æ‹–æ‹½æ—¶çš„è§†è§‰åé¦ˆ */
            .resizing {
                user-select: none;
                pointer-events: none;
            }

            .resizing * {
                pointer-events: none;
            }

            main {
                flex: 1;
                display: flex;
                flex-direction: column;
                min-width: 0;
                width: calc(100% - 280px); /* ä¸»å†…å®¹åŒºåŸŸå æ®å‰©ä½™å®½åº¦ï¼Œé€‚åº”å±•å¼€çš„ä¾§è¾¹æ  */
                height: 100%;
            }

            /* å†…å®¹åŒºåŸŸå…¨å±æ˜¾ç¤º */
            .content-area {
                flex: 1;
                overflow-y: auto;
                background-color: #0b0a20;
                padding: 2rem;
                width: 100%;
                min-height: 0; /* ç¡®ä¿flexå­å…ƒç´ å¯ä»¥æ”¶ç¼© */
            }

            /* ä»»åŠ¡åˆ›å»ºé¢æ¿å…¨å± */
            #task-creator {
                max-width: none;
                width: 80%;
                padding: 0 1rem;
            }

            #inspiration-gallery {
                max-width: none;
                width: 80%;
                padding: 0 1rem;
            }

            /* ä»»åŠ¡è¯¦æƒ…é¢æ¿å…¨å± */
            .task-detail-panel {
                max-width: none;
                width: 80%;
                padding: 0 0rem;
            }

            /* ä¸Šä¼ åŒºåŸŸå…¨å±å¸ƒå±€ */
            .upload-section {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 2rem;
                margin-bottom: 2rem;
                width: 100%;
            }

            /* ä»»åŠ¡ç±»å‹é€‰æ‹©å…¨å± */
            .task-type-selection {
                width: 100%;
                margin-bottom: 2rem;
            }

            .task-type-buttons {
                display: flex;
                width: 100%;
                border-bottom: 1px solid rgba(154, 114, 255, 0.3);
            }

            .task-type-btn {
                flex: 1;
                padding: 1rem 1.5rem;
                font-size: 1rem;
                font-weight: 500;
                transition-property: color, background-color;
                transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
                transition-duration: 150ms;
                text-align: center;
            }

            /* æ¨¡å‹é€‰æ‹©å…¨å± */
            .model-selection {
                display: flex;
                flex-wrap: wrap;
                gap: 1rem;
                width: 100%;
                justify-content: flex-start;
            }

            /* æç¤ºè¯è¾“å…¥å…¨å± */
            .prompt-input-section {
                width: 100%;
                margin-bottom: 2rem;
            }

            .prompt-textarea {
                width: 100%;
                min-height: 150px;
                resize: vertical;
            }

            /* å†å²ä»»åŠ¡åŒºåŸŸæ”¶èµ·æ ·å¼ */
            .sidebar-collapsed .history-tasks-section {
                display: none !important;
            }

            /* ä¾§è¾¹æ å±•å¼€æ ·å¼ */
            aside {
                width: 280px !important;
            }

            .sidebar-collapsed .sidebar-content {
                display: none !important;
            }

            .sidebar-collapsed .resize-handle {
                display: none !important;
            }

            .sidebar-collapsed .user-info-section {
                display: none !important;
            }

            .sidebar-collapsed .sidebar-header {
                justify-content: center;
                padding: 1rem 0.5rem;
            }

            .sidebar-collapsed .sidebar-header h1 {
                display: none;
            }

            /* å±•å¼€çŠ¶æ€ä¸‹æ˜¾ç¤ºæ‰€æœ‰å†…å®¹ */
            aside:not(.sidebar-collapsed) .sidebar-content {
                display: flex !important;
            }

            aside:not(.sidebar-collapsed) .resize-handle {
                display: block !important;
            }

            aside:not(.sidebar-collapsed) .sidebar-header {
                justify-content: space-between;
                padding: 1rem;
            }

            aside:not(.sidebar-collapsed) .sidebar-header h1 {
                display: flex;
            }

            aside:not(.sidebar-collapsed) .sidebar-header .toggle-btn {
                display: flex !important;
                align-items: center;
                justify-content: center;
            }

            aside:not(.sidebar-collapsed) .user-info-section {
                display: block !important;
            }

            .sidebar-collapsed .sidebar-header .toggle-btn {
                display: flex !important;
                align-items: center;
                justify-content: center;
                width: 2rem;
                height: 2rem;
                border-radius: 0.375rem;
                background-color: rgba(154, 114, 255, 0.1);
                border: 1px solid rgba(154, 114, 255, 0.3);
                margin: 0 auto;
            }

            /* å½“å†å²ä»»åŠ¡åŒºåŸŸæŠ˜å æ—¶ï¼Œä¸»å†…å®¹åŒºåŸŸè°ƒæ•´ */
            .sidebar-collapsed + main {
                width: calc(100% - 256px); /* åªå‡å»å›ºå®šåŒºåŸŸçš„å®½åº¦ */
            }

            /* å½“å†å²ä»»åŠ¡åŒºåŸŸå±•å¼€æ—¶ï¼Œä¸»å†…å®¹åŒºåŸŸè°ƒæ•´ */
            aside:not(.sidebar-collapsed) + main {
                width: calc(100% - 256px); /* å‡å»ä¾§è¾¹æ çš„å®½åº¦ */
            }

            /* å“åº”å¼è®¾è®¡ */
            @media (max-width: 1200px) {
                aside:not(.sidebar-collapsed) {
                    width: 250px !important;
                }

                .sidebar-collapsed + main {
                    width: calc(100% - 250px);
                }

                aside:not(.sidebar-collapsed) + main {
                    width: calc(100% - 250px);
                }
            }

            @media (max-width: 768px) {
                aside:not(.sidebar-collapsed) {
                    width: 200px !important;
                }

                .sidebar-collapsed + main {
                    width: calc(100% - 200px);
                }

                aside:not(.sidebar-collapsed) + main {
                    width: calc(100% - 200px);
                }

                .upload-section {
                    grid-template-columns: 1fr;
                }
            }


            /* åˆ†é¡µç»„ä»¶æ ·å¼ */
            .pagination-container {
                border-bottom: 1px solid rgba(154, 114, 255, 0.15);
                padding-bottom: 0.5rem;
            }

            .pagination-btn-compact {
                @apply px-1.5 py-0.5 rounded text-xs transition-all duration-200;
                background: rgba(27, 18, 64, 0.2);
                border: 1px solid rgba(154, 114, 255, 0.2);
                color: rgba(255, 255, 255, 0.6);
                min-width: 20px;
                height: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 10px;
            }

            .pagination-btn-compact:hover:not(.disabled) {
                background: rgba(154, 114, 255, 0.15);
                border-color: rgba(154, 114, 255, 0.4);
                color: rgba(255, 255, 255, 0.8);
                transform: translateY(-0.5px);
            }

            .pagination-btn-compact.active {
                background: linear-gradient(135deg, rgba(154, 114, 255, 0.6), rgba(168, 139, 255, 0.6));
                border-color: rgba(154, 114, 255, 0.6);
                color: white;
                box-shadow: 0 0 6px rgba(154, 114, 255, 0.4);
            }

            .pagination-btn-compact.disabled {
                opacity: 0.3;
                cursor: not-allowed;
                background: rgba(27, 18, 64, 0.05);
                border-color: rgba(154, 114, 255, 0.05);
                color: rgba(255, 255, 255, 0.2);
            }

            .pagination-btn-compact.disabled:hover {
                transform: none;
                background: rgba(27, 18, 64, 0.05);
                border-color: rgba(154, 114, 255, 0.05);
                color: rgba(255, 255, 255, 0.2);
            }

            /* é¡µç è¾“å…¥æ¡†æ ·å¼ */
            .page-input {
                @apply w-8 h-5 text-center text-xs rounded;
                background: linear-gradient(135deg, rgba(154, 114, 255, 0.3), rgba(168, 139, 255, 0.3));
                border: 1px solid rgba(154, 114, 255, 0.4);
                color: white;
                outline: none;
                transition: all 0.2s ease;
                font-weight: 500;
            }

            .page-input:focus {
                border-color: rgba(154, 114, 255, 0.8);
                background: linear-gradient(135deg, rgba(154, 114, 255, 0.5), rgba(168, 139, 255, 0.5));
                box-shadow: 0 0 6px rgba(154, 114, 255, 0.4);
            }

            .page-input::-webkit-outer-spin-button,
            .page-input::-webkit-inner-spin-button {
                -webkit-appearance: none;
                margin: 0;
            }

            .page-input[type=number] {
                -moz-appearance: textfield;
            }

            /* ä¿®å¤çŠ¶æ€æŒ‡ç¤ºå™¨ */
            .status-indicator {
                width: 0.75rem;
                height: 0.75rem;
                border-radius: 9999px;
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            }

            /* ä¿®å¤æŒ‰é’®æ ·å¼ */
            .btn-primary {
                padding: 12px 22px;
                border-radius: 14px;
                font-weight: 700;
                letter-spacing: 0.2px;
                color: #0c0920;
                background: linear-gradient(135deg, #d2c1ff, #a88bff, #8e88ff);
                border: 0;
                text-decoration: none;
                box-shadow: 0 10px 30px rgba(140, 110, 255, 0.4);
                transition: transform 0.15s ease, box-shadow 0.15s ease;
                cursor: pointer;
                display: inline-block;
            }

            .btn-primary:hover {
                transform: translateY(-1px);
                box-shadow: 0 14px 40px rgba(140, 110, 255, 0.55);
            }

            /* ä¿®å¤æ¨¡å‹æŒ‰é’®æ ·å¼ */
            .model-btn {
                padding: 0.5rem 1rem;
                border-radius: 0.5rem;
                font-size: 0.875rem;
                transition-property: all;
                transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
                transition-duration: 150ms;
                cursor: pointer;
                border: 1px solid;
            }

            .model-btn.active {
                background-color: rgba(154, 114, 255, 0.2);
                border-color: rgba(154, 114, 255, 0.4);
                box-shadow: 0 0 20px rgba(154, 114, 255, 0.8), 0 0 40px rgba(154, 114, 255, 0.6), 0 0 60px rgba(154, 114, 255, 0.4), 0 0 80px rgba(154, 114, 255, 0.2);
                animation: electricPulse 1.5s ease-in-out infinite;
            }

            /* ç¡®ä¿å†…å®¹åŒºåŸŸæ­£ç¡®æ»šåŠ¨ */
            .content-scroll {
                flex: 1;
                overflow-y: auto;
            }


            /* ä»»åŠ¡è¿›è¡Œä¸­é¢æ¿æ ·å¼ */
            .task-running-panel .animate-pulse-slow {
                animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 0.5) infinite;
            }

            /* è¿›åº¦æ¡æ ·å¼ */
            .progress-container {
                background: rgba(27, 18, 64, 0.3);
                border-radius: 8px;
                padding: 1rem;
                margin: 1rem 0;
            }

            .progress-bar {
                width: 100%;
                height: 8px;
                background: rgba(154, 114, 255, 0.2);
                border-radius: 4px;
                overflow: hidden;
                position: relative;
            }

            .progress-fill {
                height: 100%;
                background: linear-gradient(90deg, #9a72ff, #a88bff);
                border-radius: 4px;
                transition: width 0.3s ease;
                position: relative;
            }

            .progress-fill::after {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
                animation: shimmer 2s infinite;
            }

            @keyframes shimmer {
                0% { transform: translateX(-100%); }
                100% { transform: translateX(100%); }
            }

            .subtask-item {
                background: rgba(27, 18, 64, 0.2);
                border: 1px solid rgba(154, 114, 255, 0.2);
                border-radius: 8px;
                padding: 0.75rem;
                margin: 0.5rem 0;
            }

            .subtask-header {
                display: flex;
                justify-content: between;
                align-items: center;
                margin-bottom: 0.5rem;
            }

            .subtask-status {
                padding: 0.25rem 0.5rem;
                border-radius: 4px;
                font-size: 0.75rem;
                font-weight: 500;
            }

            .subtask-status.pending {
                background: rgba(251, 191, 36, 0.2);
                color: #fbbf24;
            }

            .subtask-status.running {
                background: rgba(59, 130, 246, 0.2);
                color: #3b82f6;
            }

            .subtask-info {
                font-size: 0.75rem;
                color: rgba(255, 255, 255, 0.6);
                margin-top: 0.25rem;
            }

            /* ä»»åŠ¡å¤±è´¥é¢æ¿æ ·å¼ */
            .task-failed-panel .bg-red-500\/10 {
                background-color: rgba(239, 68, 68, 0.1);
            }

            .error-details {
                background: rgba(239, 68, 68, 0.1);
                border: 1px solid rgba(239, 68, 68, 0.3);
                border-radius: 8px;
                padding: 1rem;
                margin: 1rem 0;
                text-align: left;
            }

            .error-details pre {
                background: rgba(0, 0, 0, 0.3);
                border-radius: 4px;
                padding: 0.75rem;
                margin: 0.5rem 0 0 0;
                font-size: 0.75rem;
                color: #fca5a5;
                overflow-x: auto;
                white-space: pre-wrap;
                word-break: break-word;
            }

            .subtask-error {
                background: rgba(239, 68, 68, 0.05);
                border-left: 3px solid #ef4444;
                padding: 0.75rem;
                margin: 0.5rem 0;
                border-radius: 0 4px 4px 0;
            }
            
            .subtask-error pre {
                background: #1a1a1a;
                border: 1px solid #dc2626;
                border-radius: 6px;
                padding: 12px;
                margin: 8px 0;
                color: #fca5a5;
                font-size: 12px;
                line-height: 1.4;
                white-space: pre-wrap;
                word-break: break-word;
                max-height: 200px;
                overflow-y: auto;
            }
            
            .error-details {
                animation: slideDown 0.3s ease-out;
            }
            
            @keyframes slideDown {
                from {
                    opacity: 0;
                    transform: translateY(-10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }


            .task-detail-panel video {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

            /* ç´ æé¢„è§ˆæ ·å¼ */

            /* ä»»åŠ¡çŠ¶æ€æŒ‡ç¤ºå™¨å¢å¼º */
            .status-indicator {
                position: relative;
            }

            .status-indicator::after {
                content: '';
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 0.25rem;
                height: 0.25rem;
                background-color: currentColor;
                border-radius: 50%;
                opacity: 0.8;
            }


            /* å“åº”å¼ä»»åŠ¡é¢æ¿ */
            @media (max-width: 768px) {
                .task-detail-panel {
                    padding: 0 0.5rem;
                }
            }

            /* æç¤ºæ¶ˆæ¯åŠ¨ç”» */
            .animate-slide-down {
                animation: slideDown 0.3s ease-out;
            }

            @keyframes slideDown {
                0% {
                    opacity: 0;
                    transform: translate(-50%, -100%);
                }
                100% {
                    opacity: 1;
                    transform: translate(-50%, 0);
                }
            }

            /* æç¤ºæ¶ˆæ¯æ ·å¼ - ç»Ÿä¸€æµ…è‰²é€æ˜èƒŒæ™¯ */
            .alert {
                backdrop-filter: blur(15px);
                background: rgba(0, 0, 0, 0.8);
                border-radius: 0.75rem;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
                color: #fff;
            }
        }
 
             
             .floating-toggle-btn {
                 position: fixed;
                 top: 50%;
                 left: 256px; /* é»˜è®¤ä½ç½®ï¼Œå¯¹åº” w-64 (256px) */
                 transform: translateY(-50%);
                 width: 20px;
                 height: 40px;
                 background: linear-gradient(135deg, #1a1a2e 0%, #2a2a4e 50%, #1e1e3e 100%);
                 border: 1px solid rgba(139, 92, 246, 0.3);
                 border-left: none;
                 border-radius: 0 8px 8px 0;
                 color: #9ca3af;
                 display: flex;
                 align-items: center;
                 justify-content: center;
                 cursor: pointer;
                 transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
                 z-index: 20;
                 box-shadow: 2px 0 8px rgba(0, 0, 0, 0.3);
             }
             
             .floating-toggle-btn:hover {
                 background: linear-gradient(135deg, #2a2a4e 0%, #3a3a5e 50%, #2e2e4e 100%);
                 color: #8b5cf6;
                 box-shadow: 2px 0 12px rgba(139, 92, 246, 0.3);
             }
             
             .floating-toggle-btn.collapsed {
                 border-radius: 0 8px 8px 0;
                 border-left: 1px solid rgba(139, 92, 246, 0.3);
                 border-right: none;
             }
             
             .resizing .floating-toggle-btn {
                 transition: none !important;
             }
             
             /* å±å¹•å·¦ä¾§å‘å…‰åŒºåŸŸ */
             .left-glow-zone {
                 position: fixed;
                 left: 0;
                 top: 0;
                 width: 8%;
                 height: 100%;
                 /* å‘å…‰ä¸­å¿ƒåœ¨å·¦ä¾§æ­£ä¸­ï¼Œå‘å³å¤§èŒƒå›´å‘æ•£ï¼Œè¾¹ç¼˜é€æ˜ */
                 background: radial-gradient(ellipse 60% 80% at 0% 50%, 
                     rgba(200, 170, 255, 0.95) 0%, 
                     rgba(168, 139, 255, 0.55) 20%, 
                     rgba(154, 114, 255, 0.18) 50%, 
                     rgba(139, 92, 246, 0) 100%);
                 pointer-events: auto;
                 opacity: 0;
                 transition: opacity 0.3s ease;
                 z-index: 5;
                 filter: blur(8px);
             }
             
             .left-glow-zone.show-glow {
                 opacity: 1;
             }
             
             .history-section {
                 max-height: calc(100% - 200px);
                 border-radius: 0 12px 12px 0;
                 border: 2px solid rgba(139, 92, 246, 0.4);
                 box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                 margin: 8px 8px 8px 0;
                 transition: all 0.3s ease;
                 cursor: pointer;
                 background: rgba(139, 92, 246, 0.05);
             }
             
             .history-section:hover {
                 background: rgba(139, 92, 246, 0.05) !important;
                 border-color: rgba(139, 92, 246, 0.15) !important;
                 box-shadow: 0 0 20px rgba(154, 114, 255, 0.8), 0 0 40px rgba(154, 114, 255, 0.6), 0 0 60px rgba(154, 114, 255, 0.4), 0 0 80px rgba(154, 114, 255, 0.2);
                 transform: translateY(-2px);
             }
             
             .history-section:hover {
                 background: rgba(139, 92, 246, 0.08) !important;
             }
             
                   /* ä¿®å¤ä»»åŠ¡é¡¹æ ·å¼ */
            .task-item {
                border: 1px solid rgba(139, 92, 246, 0.3);
                padding: 0.75rem;
                border-radius: 0.5rem;
                cursor: pointer;
                transition-property: all;
                transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
                transition-duration: 200ms;
                transition: all 0.2s ease;
            }

            .task-item:hover {
                border: 1px solid rgba(167, 132, 255, 0.2);
                background-color: rgba(167, 132, 255, 0.2);
                transform: translateX(5px);
            }

            /* ä»»åŠ¡æ“ä½œèœå•æ ·å¼ */
            .task-menu-container {
                position: relative;
            }

            .task-menu-dropdown {
                animation: fadeInUp 0.2s ease-out;
            }

            @keyframes fadeInUp {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .task-menu-item {
                transition: all 0.2s ease;
            }

            .task-menu-item:hover {
                transform: translateX(2px);
            }

            /* çŸ­ä¿¡ç™»å½•æ ·å¼ */
            .sms-login-form {
                background: rgba(255, 255, 255, 0.05);
                border-radius: 12px;
                padding: 20px;
                border: 1px solid rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                margin-top: 10px;
                animation: slideDown 0.3s ease-out;
            }

            @keyframes slideDown {
                from {
                    opacity: 0;
                    transform: translateY(-10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .sms-login-form .form-control {
                background: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
                color: white;
                border-radius: 8px;
                transition: all 0.3s ease;
                height: 50px;
                padding: 12px 16px;
                font-size: 16px;
                margin-right: 20px;
            }

            .sms-login-form .form-control:focus {
                background: rgba(255, 255, 255, 0.15);
                border-color: #007bff;
                box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
                color: white;
            }

            .sms-login-form .form-control::placeholder {
                color: rgba(255, 255, 255, 1.0);
            }

            .sms-login-form .btn-primary:disabled {
                opacity: 0.6;
                cursor: not-allowed;
            }

            .sms-login-form .btn-primary {
                color: white;
                transition: all 0.3s ease;
                height: 50px;
                padding: 12px 20px;
                font-size: 16px;
                font-weight: 500;
            }
    </style>
</head>
<body
    class="bg-dark text-gray-100 font-inter"
>

    <div id="app" v-cloak>

        <!-- ç™»å½•é¡µé¢ -->
        <div v-if="!isLoggedIn" class="login-container">
            <!-- æµ®åŠ¨ç²’å­èƒŒæ™¯ -->
            <div class="floating-particles">
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
            </div>

            <div class="login-card">
                            <div class="card-body text-center p-5">
                                <!-- Logoå’Œæ ‡é¢˜ -->
                                <div class="mb-4">
                                    <div class="login-logo">
                                        <i class="fas fa-film me-3"></i>
                                        LightX2V
                                    </div>
                                    <p class="login-subtitle">ä¸€ä¸ªå¼ºå¤§çš„è§†é¢‘ç”Ÿæˆå¹³å°</p>
                                </div>

                                <!-- ç™»å½•æŒ‰é’® -->
                                <div class="mb-4">
                                <button @click="loginWithGitHub" class="btn btn-github btn-lg w-100 mb-4" :disabled="loginLoading">
                                    <i class="fab fa-github me-2"></i>
                                    {{ loginLoading||initLoading ? 'ç™»å½•ä¸­...' : 'ä½¿ç”¨GitHubç™»å½•' }}
                                </button>
                                </div>

                                <!-- ç™»å½•æŒ‰é’® -->
                                <div class="mb-4">
                                <button @click="loginWithGoogle" class="btn btn-github btn-lg w-100 mb-4" :disabled="loginLoading">
                                    <i class="fab fa-google me-2"></i>
                                    {{ loginLoading||initLoading ? 'ç™»å½•ä¸­...' : 'ä½¿ç”¨Googleç™»å½•' }}
                                </button>
                                </div>

                                <!-- çŸ­ä¿¡éªŒè¯ç ç™»å½• -->
                                <div class="mb-4">
                                    <button @click="toggleSmsLogin" class="btn btn-github btn-lg w-100 mb-4" :disabled="loginLoading">
                                        <i class="fas fa-mobile-alt me-2"></i>
                                        {{ loginLoading ? 'ç™»å½•ä¸­...' : 'çŸ­ä¿¡éªŒè¯ç ç™»å½•' }}
                                    </button>

                                    <!-- çŸ­ä¿¡ç™»å½•è¡¨å• -->
                                    <div v-if="showSmsForm" class="sms-login-form">
                                        <div class="mb-3 d-flex gap-3">
                                            <input v-model="phoneNumber"
                                                type="tel"
                                                class="form-control form-control-lg flex-1"
                                                placeholder="è¯·è¾“å…¥æ‰‹æœºå·"
                                                :disabled="loginLoading"
                                                maxlength="11"
                                            >
                                            <button
                                                @click="sendSmsCode"
                                                class="btn btn-primary btn-lg"
                                                :disabled="!phoneNumber || smsCountdown > 0 || loginLoading"
                                                style="min-width: 120px;"
                                            >
                                                {{ smsCountdown > 0 ? `${smsCountdown}s` : 'å‘é€éªŒè¯ç ' }}
                                            </button>
                                        </div>
                                        <div class="mb-3 d-flex gap-3">
                                            <input
                                                v-model="verifyCode"
                                                type="text"
                                                class="form-control form-control-lg flex-1"
                                                placeholder="è¯·è¾“å…¥éªŒè¯ç "
                                                :disabled="loginLoading"
                                                maxlength="6"
                                            >
                                            <button
                                                @click="loginWithSms"
                                                class="btn btn-primary btn-lg"
                                                :disabled="!phoneNumber || !verifyCode || loginLoading"
                                                style="min-width: 120px;"
                                            >
                                                {{ loginLoading ? 'ç™»å½•ä¸­...' : 'ç¡®è®¤ç™»å½•' }}
                                            </button>
                                        </div>
                                        <div class="d-flex justify-content-end">
                                            <button
                                                @click="toggleSmsLogin"
                                                class="btn btn-primary btn-lg"
                                                :disabled="loginLoading"
                                                style="min-width: 120px; margin-top: 20px;"
                                            >
                                                <i class="fas fa-times me-2"></i>
                                                å–æ¶ˆ
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- åŠŸèƒ½ç‰¹æ€§ -->
                                <div class="login-features">
                                    <div class="feature-item">
                                        <div class="feature-icon">ğŸ­</div>
                                        <span>ç”µå½±çº§æ•°å­—äººè§†é¢‘</span>
                                    </div>
                                    <div class="feature-item">
                                        <div class="feature-icon">âš¡</div>
                                        <span>20å€ç”Ÿæˆæé€Ÿ</span>
                                    </div>
                                    <div class="feature-item">
                                        <div class="feature-icon">ğŸ’°</div>
                                        <span>è¶…ä½æˆæœ¬ç”Ÿæˆ</span>
                                    </div>
                                    <div class="feature-item">
                                        <div class="feature-icon">ğŸ¯</div>
                                        <span>ç²¾å‡†å£å‹å¯¹é½</span>
                                    </div>
                                    <div class="feature-item">
                                        <div class="feature-icon">ğŸ“±</div>
                                        <span>åˆ†é’Ÿçº§è§†é¢‘æ—¶é•¿</span>
                                    </div>
                                    <div class="feature-item">
                                        <div class="feature-icon">ğŸ¨</div>
                                        <span>å¤šåœºæ™¯åº”ç”¨</span>
                                    </div>
                                </div>
                            </div>
            </div>
        </div>

        <!-- ä¸»åº”ç”¨é¡µé¢ -->
        <div v-if="isLoggedIn" class="main-container">
        <!-- æµ®åŠ¨ç²’å­èƒŒæ™¯ -->
        <div class="floating-particles">
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
        </div>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
            <div class="main-content-area flex flex-col relative h-full">
            <!-- é¡¶éƒ¨æ  -->
            <div class="bg-dark top-bar">
                <div class="top-bar-content">
                    <!-- å·¦ä¾§å›¾æ ‡ -->
                    <div class="top-bar-left">
                        <img src="/icon/seko_logo_white.svg" alt="SekoTalk Logo" class="top-bar-logo">
                    </div>
                    
                    <!-- å³ä¾§ç”¨æˆ·ä¿¡æ¯ -->
                    <div class="top-bar-right">
                        <div class="user-info">
                            <div class="user-avatar text-gradient-icon">
                                <img v-if="currentUser.avatar" :src="currentUser.avatar" :alt="currentUser.username" class="avatar-img">
                                <i v-else class="fas fa-user"></i>
                            </div>
                            <div class="user-details">
                                <span class="username">{{ currentUser.username }}</span>
                                <span class="user-email">{{ currentUser.email }}</span>
                            </div>
                            <button @click="logout" class="text-gradient-icon" title="é€€å‡ºç™»å½•">
                                <i class="fas fa-sign-out-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

                <!-- ä¸‹æ–¹åŒºåŸŸ -->
                <div class="flex flex-row relative flex-1 min-h-0">
                    <!-- å·¦ä¾§åŠŸèƒ½åŒº -->
                    <div class="relative w-16 flex flex-col z-10 bg-dark border-r border-laser-purple/40 smooth-transition hover:bg-dark-light">
                        <!-- åŠŸèƒ½å¯¼èˆª -->
                <div class="p-2">
                            <nav class="space-y-2">
                                <!-- ç”Ÿæˆè§†é¢‘åŠŸèƒ½ -->
                                <div class="relative group">
                    <button
                                        @click="switchToCreateView"
                                        class="w-full flex items-center justify-center p-3 rounded-lg transition-all duration-200 font-medium text-sm border border-transparent"
                                        :class="currentView === 'create' 
                                            ? 'bg-laser-purple/20 text-white border-laser-purple/40' 
                                            : 'text-gray-400 hover:text-white hover:bg-dark-light'"
                                        title="ç”Ÿæˆè§†é¢‘">
                                        <i class="fas fa-plus text-lg"></i>
                    </button>
                </div>

                                <!-- æˆ‘çš„é¡¹ç›®åŠŸèƒ½ -->
                                <div class="relative group">
                                    <button
                                        @click="switchToProjectsView"
                                        class="w-full flex items-center justify-center p-3 rounded-lg transition-all duration-200 font-medium text-sm border border-transparent"
                                        :class="currentView === 'projects' 
                                            ? 'bg-laser-purple/20 text-white border-laser-purple/40' 
                                            : 'text-gray-400 hover:text-white hover:bg-dark-light'"
                                        title="æˆ‘çš„é¡¹ç›®">
                                        <i class="fas fa-folder text-lg"></i>
                                    </button>
                    </div>

                                <!-- çµæ„Ÿå¹¿åœºåŠŸèƒ½ -->
                                <div class="relative group">
                                    <button
                                        @click="switchToInspirationView"
                                        class="w-full flex items-center justify-center p-3 rounded-lg transition-all duration-200 font-medium text-sm border border-transparent"
                                        :class="currentView === 'inspiration' 
                                            ? 'bg-laser-purple/20 text-white border-laser-purple/40' 
                                            : 'text-gray-400 hover:text-white hover:bg-dark-light'"
                                        title="çµæ„Ÿå¹¿åœº">
                                        <i class="fas fa-star text-lg"></i>
                                    </button>
                    </div>
                            </nav>
                        </div>
                            </div>
                            

                    <!-- å†å²ä»»åŠ¡åŒºåŸŸ -->
                    <div v-if="currentView === 'projects'" class="flex-1 flex flex-col min-h-0">
                        <!-- å†…å®¹åŒºåŸŸ -->
                        <div class="flex-1 overflow-y-auto p-10 content-area">
                            <!-- å†å²ä»»åŠ¡åŠŸèƒ½åŒº -->
                            <div class="max-w-4xl mx-auto" id="task-creator">
                                <!-- æœç´¢å’Œç­›é€‰åŒºåŸŸ -->
                                <div class="flex flex-col md:flex-row gap-4 mb-6">
                            <!-- æœç´¢æ¡† -->
                                    <div class="relative flex-1">
                                        <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none z-10"></i>
                            <input
                                v-model="searchQuery"
                                            class="w-full bg-dark-light border border-laser-purple/30 rounded-lg py-3 pl-10 pr-4 text-sm focus:outline-none focus:ring-2 focus:ring-laser-purple/50 transition-all focus:border-laser focus:shadow-laser"
                                            placeholder="æœç´¢å†å²ä»»åŠ¡..."
                                type="text"
                            />
                        </div>

                                    <!-- åˆ†ç±»ç­›é€‰ -->
                                    <div class="flex gap-2">
                                <button
                                    @click="statusFilter = 'ALL'"
                                            :class="statusFilter === 'ALL' 
                                                ? 'bg-laser-purple/20 text-white border-laser-purple/40' 
                                                : 'bg-dark-light text-gray-400 hover:text-white hover:bg-dark-light/80'"
                                            class="px-4 py-2 rounded-lg border border-transparent transition-all duration-200 text-sm font-medium"
                                >
                                    å…¨éƒ¨
                                </button>
                                <button
                                    @click="statusFilter = 'SUCCEED'"
                                            :class="statusFilter === 'SUCCEED' 
                                                ? 'bg-laser-purple/20 text-white border-laser-purple/40' 
                                                : 'bg-dark-light text-gray-400 hover:text-white hover:bg-dark-light/80'"
                                            class="px-4 py-2 rounded-lg border border-transparent transition-all duration-200 text-sm font-medium"
                                >
                                    æˆåŠŸ
                                </button>
                                <button
                                    @click="statusFilter = 'RUNNING'"
                                            :class="statusFilter === 'RUNNING' 
                                                ? 'bg-laser-purple/20 text-white border-laser-purple/40' 
                                                : 'bg-dark-light text-gray-400 hover:text-white hover:bg-dark-light/80'"
                                            class="px-4 py-2 rounded-lg border border-transparent transition-all duration-200 text-sm font-medium"
                                >
                                    è¿›è¡Œä¸­
                                </button>
                                <button
                                    @click="statusFilter = 'FAILED'"
                                            :class="statusFilter === 'FAILED' 
                                                ? 'bg-laser-purple/20 text-white border-laser-purple/40' 
                                                : 'bg-dark-light text-gray-400 hover:text-white hover:bg-dark-light/80'"
                                            class="px-4 py-2 rounded-lg border border-transparent transition-all duration-200 text-sm font-medium"
                                >
                                    å¤±è´¥
                                </button>
                                <button
                                    @click="() => refreshTasks(true)"
                                    class="text-gray-400 hover:text-gradient-icon transition-colors flex-shrink-0"
                                    title="åˆ·æ–°ä»»åŠ¡åˆ—è¡¨"
                                >
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                        </div>
                    </div>
                            
                            <!-- åˆ†é¡µç»„ä»¶ -->
                            <div v-cloak>
                                            <div v-if="paginationInfo" :key="paginationKey" class="pagination-container mb-3">
                                    <div class="flex items-center justify-between text-xs text-gray-400">
                                        <div class="flex items-center space-x-1 text-gray-500">
                                            <span>å…±{{ paginationInfo.total }}æ¡</span>
                        </div>
                                        <div v-if="paginationInfo.total_pages > 1" class="flex items-center space-x-2">
                                            <!-- ä¸Šä¸€é¡µæŒ‰é’® -->
                                            <button
                                                @click="goToPage(currentPage - 1)"
                                                :disabled="currentPage <= 1"
                                                class="pagination-btn-compact"
                                                :class="{ 'disabled': currentPage <= 1 }"
                                                title="ä¸Šä¸€é¡µ"
                                            >
                                                <i class="fas fa-chevron-left text-xs"></i>
                                            </button>
                                            
                                            <!-- é¡µç è¾“å…¥æ¡† -->
                                            <div class="flex items-center space-x-1">
                                                <input
                                                    v-model.number="pageInput"
                                                    @keyup.enter="jumpToPage"
                                                    @blur="jumpToPage"
                                                    type="number"
                                                    :min="1"
                                                    :max="paginationInfo.total_pages"
                                                    class="page-input"
                                                    title="è¾“å…¥é¡µç è·³è½¬"
                                                />
                                                <span class="text-gray-500">/</span>
                                                <span class="text-gray-500">{{ paginationInfo.total_pages }}</span>
                            </div>
                                            
                                            <!-- ä¸‹ä¸€é¡µæŒ‰é’® -->
                                            <button
                                                @click="goToPage(currentPage + 1)"
                                                :disabled="currentPage >= paginationInfo.total_pages"
                                                class="pagination-btn-compact"
                                                :class="{ 'disabled': currentPage >= paginationInfo.total_pages }"
                                                title="ä¸‹ä¸€é¡µ"
                                            >
                                                <i class="fas fa-chevron-right text-xs"></i>
                                            </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                            
                        
                        <!-- å¯æ»šåŠ¨çš„ä»»åŠ¡åˆ—è¡¨åŒºåŸŸ -->
                                <div class="flex-1 overflow-y-auto history-tasks-scroll min-h-0 p-4" style="overflow-x: visible;">
                            <div v-cloak>
                                <div v-if="filteredTasks.length === 0" class="flex-col items-center justify-center py-12 text-center">
                                    <p class="text-gray-400 text-sm">æš‚æ— å†å²ä»»åŠ¡</p>
                                    <p class="text-gray-500 text-xs mt-1">å¼€å§‹åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªAIè§†é¢‘å§</p>
                                </div>
                                        <div v-else class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                                                <!-- ä»»åŠ¡å¡ç‰‡ -->
                            <div
                                v-for="task in filteredTasks"
                                :key="task.task_id"
                                                    class="group relative bg-dark-light rounded-xl overflow-hidden border border-gray-700/50 hover:border-laser-purple/40 transition-all duration-300 hover:shadow-laser/20"
                                                    @click="openTaskDetailModal(task)"
                                                >
                                                    <!-- ç¼©ç•¥å›¾åŒºåŸŸ -->
                                                    <div class="relative mb-3">
                                                        <div class="w-full h-44 bg-dark-light rounded-lg overflow-hidden">
                                                            <!-- æˆåŠŸä»»åŠ¡ï¼šæ˜¾ç¤ºè§†é¢‘åŠ¨å›¾ -->
                                                            <video 
                                                                v-if="task.status === 'SUCCEED'"
                                                                :src="getVideoUrl(task.task_id, 'output_video')"
                                                                :poster="getTaskInputImage(task)"
                                                                class="w-full h-44 object-cover group-hover:scale-105 transition-transform duration-300"
                                                                muted
                                                                loop
                                                                preload="metadata"
                                                                playsinline
                                                                webkit-playsinline
                                                                @mouseenter="playVideo($event)"
                                                                @mouseleave="pauseVideo($event)"
                                                                @loadeddata="onVideoLoaded($event)"
                                                                @error="onVideoError($event)"
                                                            ></video>
                                                            
                                                            <!-- å¤±è´¥ä»»åŠ¡ï¼šæ˜¾ç¤ºè¾“å…¥å›¾ç‰‡ -->
                                                            <img
                                                                v-else-if="task.status !== 'SUCCEED' && getTaskInputImage(task)"
                                                                :src="getTaskInputImage(task)"
                                                                alt="ä»»åŠ¡é¢„è§ˆ"
                                                                class="w-full h-44 object-cover bg-dark-light transition-transform duration-300 group-hover:scale-105"
                                                                @error="handleThumbnailError"
                                                            />
                                                            
                                                            <!-- å…¶ä»–çŠ¶æ€ï¼šæ˜¾ç¤ºè¾“å…¥å›¾ç‰‡æˆ–å ä½ç¬¦ -->
                                                            <img
                                                                v-else-if="getTaskInputImage(task)"
                                                                :src="getTaskInputImage(task)"
                                                                alt="ä»»åŠ¡é¢„è§ˆ"
                                                                class="w-full h-44 object-cover bg-dark-light transition-transform duration-300 group-hover:scale-105"
                                                                @error="handleThumbnailError"
                                                            />
                                                            <div v-else class="w-full h-44 bg-laser-purple/20 flex items-center justify-center">
                                                                <i class="fas fa-video text-gradient-icon text-4xl"></i>
                                                            </div>
                                    </div>
                                                        
                                                        <!-- çŠ¶æ€æŒ‡ç¤ºå™¨ -->
                                                        <div class="absolute top-2 right-2">
                                                            <span :class="getTaskStatusColor(task.status)" class="px-2 py-1 rounded-full text-xs font-medium bg-black/50 backdrop-blur-sm">
                                                                {{ getTaskStatusDisplay(task.status) }}
                                                            </span>
                                                        </div>
                                                        
                                                        <!-- æ‚¬åœæ—¶æ˜¾ç¤ºçš„æ“ä½œæŒ‰é’® -->                
                                                        <div class="absolute bottom-2 left-1/2 transform -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none">
                                                            <div class="flex space-x-3 pointer-events-auto">
                                                <button
                                                                    v-if="['CREATED', 'PENDING', 'RUNNING','SUCCEED', 'FAILED', 'CANCEL'].includes(task.status)"
                                                                    @click.stop="reuseTask(task)"
                                                                    class="w-10 h-10 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center text-white hover:bg-white/30 transition-colors"
                                                                    title="å¤ç”¨ä»»åŠ¡"
                                                                >
                                                            <i class="fas fa-copy text-lg"></i>
                                                </button>
                                                        <button
                                                                v-if="['CREATED', 'PENDING', 'RUNNING'].includes(task.status)"
                                                                @click.stop="cancelTask(task.task_id)"
                                                                class="w-10 h-10 rounded-full bg-laser-purple/80 backdrop-blur-sm flex items-center justify-center text-white hover:bg-laser-purple transition-colors"
                                                                title="å–æ¶ˆä»»åŠ¡"
                                                            >
                                                            <i class="fas fa-times text-lg"></i>
                                                        </button>
                                                        <button
                                                                    v-if="['SUCCEED', 'FAILED', 'CANCEL'].includes(task.status)"
                                                                    @click.stop="resumeTask(task.task_id)"
                                                                    class="w-10 h-10 rounded-full bg-laser-purple/80 backdrop-blur-sm flex items-center justify-center text-white hover:bg-laser-purple transition-colors"
                                                                    title="é‡è¯•"
                                                                >
                                                                    <i class="fas fa-redo text-lg"></i>
                                                        </button>
                                                        <button
                                                                    v-if="task.status === 'SUCCEED'"
                                                                    @click.stop="downloadTaskOutput(task)"
                                                                    class="w-10 h-10 rounded-full bg-laser-purple/80 backdrop-blur-sm flex items-center justify-center text-white hover:bg-laser-purple transition-colors"
                                                                    title="ä¸‹è½½"
                                                                >
                                                                    <i class="fas fa-download text-lg"></i>
                                                        </button>
                                                        <button
                                                                    v-if="['SUCCEED', 'FAILED', 'CANCEL'].includes(task.status)"
                                                                    @click.stop="deleteTask(task.task_id)"
                                                                    class="w-10 h-10 rounded-full bg-red-400/80 backdrop-blur-sm flex items-center justify-center text-white hover:bg-red-500 transition-colors"
                                                                    title="åˆ é™¤"
                                                                >
                                                                    <i class="fas fa-trash text-lg"></i>
                                                        </button>
                                                </div>
                                            </div>
                                        </div>
                                                    
                                                    <!-- ä»»åŠ¡ä¿¡æ¯ -->
                                                    <div class="pl-4 pr-4 pb-4">
                                                        <h3 class="text-white font-medium text-sm mb-2 line-clamp-2">{{ task.params.prompt.length > 20 ? task.params.prompt.slice(0, 20) + 'Â·Â·Â·' : task.params.prompt }}</h3>
                                                        <div class="flex items-center justify-between text-xs text-gray-500">
                                                            <span>{{ task.model_cls }}</span>
                                                            <span>{{ getRelativeTime(task.create_t) }}</span>
                                    </div>
                                                        
                                </div>
                            </div>
                            </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ç”Ÿæˆè§†é¢‘åŒºåŸŸ -->
                    <div v-if="currentView === 'create'" class="flex-1 flex flex-col min-h-0">
                    <!-- å†…å®¹åŒºåŸŸ -->
                    <div class="flex-1 overflow-y-auto p-6 content-area">
                        <!-- æ¨¡æ¿é€‰æ‹©æµ®çª— -->
                        <div v-cloak>
                            <div v-if="showImageTemplates || showAudioTemplates"
                                class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center"
                                @click="showImageTemplates = false; showAudioTemplates = false">
                                <div class="bg-secondary rounded-xl p-6 max-w-4xl w-full mx-4 max-h-[80vh] overflow-hidden"
                                    @click.stop>
                                    <!-- æµ®çª—å¤´éƒ¨ -->
                                    <div class="flex items-center justify-between mb-4">
                                        <h3 class="text-lg font-medium text-white">
                                            <i v-if="showImageTemplates" class="fas fa-image text-gradient-icon mr-2"></i>
                                            <i v-if="showAudioTemplates" class="fas fa-music text-gradient-icon mr-2"></i>
                                            {{ showImageTemplates ? 'å›¾ç‰‡ç´ æåº“' : 'éŸ³é¢‘ç´ æåº“' }}
                                        </h3>
                                        <button @click="showImageTemplates = false; showAudioTemplates = false"
                                                class="text-gray-400 hover:text-white transition-colors">
                                            <i class="fas fa-times text-xl"></i>
                                        </button>
                                    </div>

                                    <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
                                    <div class="flex border-b border-gray-700 mb-6">
                                        <button @click="mediaModalTab = 'history'; showImageTemplates && getImageHistory(); showAudioTemplates && getAudioHistory()"
                                                class="px-4 py-2 text-sm font-medium transition-colors"
                                                :class="mediaModalTab === 'history' 
                                                    ? 'text-gradient-icon border-b-2 border-laser-purple' 
                                                    : 'text-gray-400 hover:text-gray-300'">
                                            <i class="fas fa-history mr-2"></i>
                                            å†å²è®°å½•
                                        </button>
                                        <button @click="mediaModalTab = 'templates'"
                                                class="px-4 py-2 text-sm font-medium transition-colors"
                                                :class="mediaModalTab === 'templates' 
                                                    ? 'text-gradient-icon border-b-2 border-laser-purple' 
                                                    : 'text-gray-400 hover:text-gray-300'">
                                            <i class="fas fa-layer-group mr-2"></i>
                                            ç´ æ
                                        </button>
                                    </div>

                                    <!-- å›¾ç‰‡å†å²è®°å½• -->
                                    <div v-if="showImageTemplates && mediaModalTab === 'history'" class="overflow-y-auto max-h-[50vh]">
                                        <div v-if="imageHistory.length === 0" class="flex flex-col items-center justify-center py-12 text-center">
                                            <div class="w-16 h-16 bg-laser-purple/20 rounded-full flex items-center justify-center mb-4">
                                                <i class="fas fa-history text-gradient-icon text-2xl"></i>
                                            </div>
                                            <p class="text-gray-400 text-lg mb-2">æš‚æ— å†å²è®°å½•</p>
                                            <p class="text-gray-500 text-sm">å¼€å§‹ä½¿ç”¨å›¾ç‰‡åï¼Œå†å²è®°å½•å°†è‡ªåŠ¨ä¿å­˜</p>
                                        </div>
                                        <div v-else class="space-y-3">
                                            <div class="flex items-center justify-between mb-4">
                                                <span class="text-sm text-gray-400">å…± {{ imageHistory.length }} æ¡è®°å½•</span>
                                                <button @click="clearImageHistory" 
                                                        class="text-xs text-red-400 hover:text-red-300 transition-colors flex items-center gap-1"
                                                        title="æ¸…ç©ºå†å²è®°å½•">
                                                    <i class="fas fa-trash"></i>
                                                    æ¸…ç©º
                                                </button>
                                            </div>
                                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                                <div v-for="(history, index) in imageHistory" :key="index"
                                                    @click="selectImageHistory(history)"
                                                    class="relative group cursor-pointer rounded-lg overflow-hidden border border-gray-700 hover:border-laser-purple/50 transition-all">
                                                    <img :src="history.thumbnail" :alt="history.filename"
                                                        class="w-full h-24 object-cover">
                                                    <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                                                        <i class="fas fa-check text-white text-xl"></i>
                                                    </div>
                                                    <div class="absolute bottom-0 left-0 right-0 bg-black/80 text-white text-xs p-2">
                                                        <div class="truncate">{{ history.filename }}</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- å›¾ç‰‡æ¨¡æ¿ç½‘æ ¼ -->
                                    <div v-if="showImageTemplates && mediaModalTab === 'templates'" class="overflow-y-auto max-h-[50vh]">
                                        <div v-if="imageTemplates.length > 0" class="grid grid-cols-4 gap-4">
                                            <div v-for="template in imageTemplates" :key="template.filename"
                                                @click="selectImageTemplate(template)"
                                                class="relative group cursor-pointer rounded-lg overflow-hidden border border-gray-700 hover:border-laser-purple/50 transition-all">
                                                <img :src="template.url" :alt="template.filename"
                                                    class="w-full h-32 object-cover">
                                                <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                                                    <i class="fas fa-check text-white text-2xl"></i>
                                                </div>
                                                <div class="absolute bottom-0 left-0 right-0 bg-black/80 text-white text-xs p-2">
                                                    <div class="truncate">{{ template.filename }}</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div v-else class="flex flex-col items-center justify-center py-12 text-center">
                                            <div class="w-16 h-16 bg-laser-purple/20 rounded-full flex items-center justify-center mb-4">
                                                <i class="fas fa-image text-gradient-icon text-2xl"></i>
                                            </div>
                                            <p class="text-gray-400 text-lg mb-2">ç›®å‰æš‚æ— å›¾ç‰‡æ¨¡æ¿</p>
                                        </div>
                                    </div>

                                    <!-- éŸ³é¢‘å†å²è®°å½• -->
                                    <div v-if="showAudioTemplates && mediaModalTab === 'history'" class="overflow-y-auto max-h-[50vh]">
                                        <div v-if="audioHistory.length === 0" class="flex flex-col items-center justify-center py-12 text-center">
                                            <div class="w-16 h-16 bg-laser-purple/20 rounded-full flex items-center justify-center mb-4">
                                                <i class="fas fa-history text-gradient-icon text-2xl"></i>
                                            </div>
                                            <p class="text-gray-400 text-lg mb-2">æš‚æ— å†å²è®°å½•</p>
                                            <p class="text-gray-500 text-sm">å¼€å§‹ä½¿ç”¨éŸ³é¢‘åï¼Œå†å²è®°å½•å°†è‡ªåŠ¨ä¿å­˜</p>
                                        </div>
                                        <div v-else class="space-y-3">
                                            <div class="flex items-center justify-between mb-4">
                                                <span class="text-sm text-gray-400">å…± {{ audioHistory.length }} æ¡è®°å½•</span>
                                                <button @click="clearAudioHistory" 
                                                        class="text-xs text-red-400 hover:text-red-300 transition-colors flex items-center gap-1"
                                                        title="æ¸…ç©ºå†å²è®°å½•">
                                                    <i class="fas fa-trash"></i>
                                                    æ¸…ç©º
                                                </button>
                                            </div>
                                            <div class="space-y-3">
                                                <div v-for="(history, index) in audioHistory" :key="index"
                                                    @click="selectAudioHistory(history)"
                                                    class="flex items-center gap-4 p-4 rounded-lg border border-gray-700 hover:border-laser-purple/50 transition-all cursor-pointer bg-dark-light/50 group">
                                                    <div class="w-12 h-12 bg-laser-purple/20 rounded-lg flex items-center justify-center">
                                                        <i class="fas fa-music text-gradient-icon text-xl"></i>
                                                    </div>
                                                    <div class="flex-1">
                                                        <div class="text-white font-medium group-hover:text-gradient-icon transition-colors">{{ history.filename }}</div>
                                                        <div class="text-gray-400 text-sm">éŸ³é¢‘æ–‡ä»¶</div>
                                                    </div>
                                                    <button @click.stop="previewAudioHistory(history)"
                                                            class="px-3 py-2 bg-laser-purple/20 hover:bg-laser-purple/30 text-gradient-icon rounded-lg transition-all">
                                                        <i class="fas fa-play mr-2"></i>
                                                        è¯•å¬
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- éŸ³é¢‘æ¨¡æ¿åˆ—è¡¨ -->
                                    <div v-if="showAudioTemplates && mediaModalTab === 'templates'" class="overflow-y-auto max-h-[50vh]">
                                        <div v-if="audioTemplates.length > 0" class="space-y-3">
                                            <div v-for="template in audioTemplates" :key="template.filename"
                                                @click="selectAudioTemplate(template)"
                                                class="flex items-center gap-4 p-4 rounded-lg border border-gray-700 hover:border-laser-purple/50 transition-all cursor-pointer bg-dark-light/50">
                                                <div class="w-12 h-12 bg-laser-purple/20 rounded-lg flex items-center justify-center">
                                                    <i class="fas fa-music text-gradient-icon text-xl"></i>
                                                </div>
                                                <div class="flex-1">
                                                    <div class="text-white font-medium">{{ template.filename }}</div>
                                                    <div class="text-gray-400 text-sm">éŸ³é¢‘æ¨¡æ¿</div>
                                                </div>
                                                <button @click.stop="previewAudioTemplate(template)"
                                                        class="px-3 py-2 bg-laser-purple/20 hover:bg-laser-purple/30 text-gradient-icon rounded-lg transition-all">
                                                    <i class="fas fa-play mr-2"></i>
                                                    è¯•å¬
                                                </button>
                                            </div>
                                        </div>
                                        <div v-else class="flex flex-col items-center justify-center py-12 text-center">
                                            <div class="w-16 h-16 bg-laser-purple/20 rounded-full flex items-center justify-center mb-4">
                                                <i class="fas fa-music text-gradient-icon text-2xl"></i>
                                            </div>
                                            <p class="text-gray-400 text-lg mb-2">ç›®å‰æš‚æ— éŸ³é¢‘æ¨¡æ¿</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ä»»åŠ¡åˆ›å»ºé¢æ¿ -->
                        <div class="max-w-4xl mx-auto" id="task-creator">
                            <!-- ä»»åŠ¡ç±»å‹é€‰æ‹© -->
                            <div class="mb-8 task-type-selection">
                                <div class="flex border-b border-laser-purple/30 task-type-buttons">
                                    <button
                                        v-for="taskType in availableTaskTypes"
                                        :key="taskType"
                                        @click="selectTask(taskType)"
                                        class="task-type-btn"
                                        :class="getTaskTypeBtnClass(taskType)"
                                    >
                                        <i :class="getTaskTypeIcon(taskType)" class="mr-2"></i>
                                        {{ getTaskTypeName(taskType) }}
                                    </button>
                                </div>
                            </div>

                            <!-- æ¨¡å‹é€‰æ‹© -->
                            <div v-if="selectedTaskId" class="mb-6">
                                <label class="block text-sm text-gray-400 mb-2">é€‰æ‹©æ¨¡å‹</label>
                                <div class="model-selection">
                                    <button
                                        v-for="model in availableModelClasses"
                                        :key="model"
                                        @click="selectModel(model)"
                                        class="model-btn px-4 py-2 rounded-lg text-sm transition-all"
                                        :class="getModelBtnClass(model)"
                                    >
                                        <i v-if="model === getCurrentForm().model_cls" class="fas fa-star text-yellow-400 mr-1"></i>
                                        {{ model }}
                                    </button>
                                </div>
                            </div>

                            <!-- ä¸Šä¼ åŒºåŸŸ -->
                            <div v-if="selectedTaskId === 'i2v' || selectedTaskId === 's2v'" class="upload-section">
                                <!-- ä¸Šä¼ å›¾ç‰‡ -->
                                <div v-if="selectedTaskId === 'i2v' || selectedTaskId === 's2v'" class="upload-area" @click="triggerImageUpload">
                                    <!-- é»˜è®¤ä¸Šä¼ ç•Œé¢ -->
                                    <div v-if="!getCurrentImagePreview()" class="upload-content">
                                    <div class="upload-icon">
                                        <i class="fas fa-image text-gradient-icon text-xl"></i>
                                    </div>
                                    <p class="text-xs text-gray-400 mb-4">æ”¯æŒJPGã€PNGæ ¼å¼ï¼Œå¤§å°ä¸è¶…è¿‡10MB</p>
                                    <div class="flex gap-2">
                                        <button class="btn-primary px-4 py-1.5 rounded-lg transition-all flex-1">ä¸Šä¼ å›¾ç‰‡</button>
                                        <button @click.stop="showImageTemplates = true; mediaModalTab = 'history'; getImageHistory()"
                                                class="px-4 py-1.5 rounded-lg bg-laser-purple/20 hover:bg-laser-purple/30 text-gradient-icon border border-laser-purple/40 rounded-lg transition-all">
                                            <i class="fas fa-images mr-1"></i>
                                            ç´ æ
                                        </button>
                                    </div>
                                    </div>

                                    <!-- å›¾ç‰‡é¢„è§ˆ -->
                                    <div v-if="getCurrentImagePreview()" class="image-preview group">
                                        <img :src="getCurrentImagePreview()" alt="é¢„è§ˆå›¾ç‰‡" class="w-full h-full object-cover rounded-lg transition-all duration-300 group-hover:brightness-50">

                                        <!-- æ‚¬åœæ—¶æ˜¾ç¤ºçš„æ“ä½œæŒ‰é’®ï¼Œä½ç½®åœ¨ä¸­ä¸‹æ–¹ -->
                                        <div class="absolute inset-x-0 bottom-4 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                            <div class="flex space-x-3">
                                                <button
                                                    @click.stop="triggerImageUpload"
                                                    class="w-12 h-12 flex items-center justify-center bg-white/15 text-white p-3 rounded-full transition-all duration-200 hover:scale-110 shadow-lg"
                                                    title="é‡æ–°ä¸Šä¼ ">
                                                    <i class="fas fa-upload text-lg"></i>
                                                </button>
                                                <button
                                                    @click.stop="removeImage"
                                                    class="w-12 h-12 flex items-center justify-center bg-white/15 text-white p-3 rounded-full transition-all duration-200 hover:scale-110 shadow-lg"
                                                    title="åˆ é™¤å›¾ç‰‡">
                                                    <i class="fas fa-trash text-lg"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <input
                                        type="file"
                                        ref="imageInput"
                                        @change="handleImageUpload"
                                        accept="image/*"
                                        style="display: none;">
                                </div>

                                <!-- ä¸Šä¼ éŸ³é¢‘ -->
                                    <div v-if="selectedTaskId === 's2v'" class="upload-area">
                                    <!-- é»˜è®¤ä¸Šä¼ ç•Œé¢ -->
                                        <div v-if="!getCurrentAudioPreview()" class="upload-content" @click="triggerAudioUpload">
                                    <div class="upload-icon">
                                        <i class="fas fa-microphone text-gradient-icon text-xl"></i>
                                    </div>
                                        <p class="text-xs text-gray-400 mb-4">æ”¯æŒMP4ã€WAVæ ¼å¼ï¼Œæœ€é•¿æ”¯æŒ120s</p>
                                    <div class="flex gap-2">
                                        <button class="btn-primary px-4 py-1.5 rounded-lg transition-all flex-1">ä¸Šä¼ éŸ³é¢‘</button>
                                        <button @click.stop="showAudioTemplates = true; mediaModalTab = 'history'; getAudioHistory()"
                                                class="px-4 py-1.5 rounded-lg bg-laser-purple/20 hover:bg-laser-purple/30 text-gradient-icon border border-laser-purple/40 rounded-lg transition-all">
                                            <i class="fas fa-music mr-1"></i>
                                            ç´ æ
                                        </button>
                                    </div>
                                    </div>

                                    <!-- éŸ³é¢‘é¢„è§ˆ -->
                                        <div v-if="getCurrentAudioPreview()" class="audio-preview group">
                                        <audio controls class="w-full h-full">
                                            <source :src="getCurrentAudioPreview()" :type="getAudioMimeType()">
                                        </audio>

                                        <!-- æ‚¬åœæ—¶æ˜¾ç¤ºçš„æ“ä½œæŒ‰é’®ï¼Œä½ç½®åœ¨ä¸­ä¸‹æ–¹ -->
                                        <div class="absolute inset-x-0 bottom-4 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-black/20">
                                            <div class="flex space-x-3">
                                                <button
                                                    @click.stop="triggerAudioUpload"
                                                    class="w-12 h-12 flex items-center justify-center bg-white/15 text-white p-3 rounded-full transition-all duration-200 hover:scale-110 shadow-lg"
                                                    title="é‡æ–°ä¸Šä¼ ">
                                                    <i class="fas fa-upload text-lg"></i>
                                                </button>
                                                <button
                                                    @click.stop="removeAudio"
                                                    class="w-12 h-12 flex items-center justify-center bg-white/15 text-white p-3 rounded-full transition-all duration-200 hover:scale-110 shadow-lg"
                                                    title="åˆ é™¤éŸ³é¢‘">
                                                    <i class="fas fa-trash text-lg"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <input
                                        type="file"
                                        ref="audioInput"
                                        @change="handleAudioUpload"
                                        accept="audio/*"
                                        style="display: none;">
                                </div>
                            </div>

                            <!-- æç¤ºè¯è¾“å…¥ -->
                            <div class="mb-6 prompt-input-section">
                                <div class="flex justify-between items-center mb-2">
                                    <label class="block text-sm text-gray-400 flex items-center">
                                        æç¤ºè¯
                                        <button @click="showPromptModal = true; promptModalTab = 'templates'" class="text-xs text-gray-400 hover:text-gradient-icon transition-colors pl-3" title="æç¤ºè¯ç´ æåº“">
                                            <i class="fas fa-lightbulb"></i>
                                        </button>
                                    </label>
                                </div>


                                <div class="relative">
                                    <textarea
                                        v-model="getCurrentForm().prompt"
                                        class="w-full bg-dark-light border border-laser-purple/40 rounded-lg p-4 pr-16 text-base min-h-[120px] focus:outline-none focus:ring-2 focus:ring-laser-purple/60 transition-all resize-none scrollbar-thin focus:border-laser focus:shadow-laser prompt-textarea"
                                        :placeholder="getPromptPlaceholder()"
                                        rows="3"
                                        required
                                    ></textarea>
                                </div>

                                <div class="flex justify-between items-center pl-2">
                                    <button @click="clearPrompt" class="flex items-center text-sm rounded transition-all text-gray-400 hover:text-gradient-icon">
                                        <i class="fas fa-sync-alt text-sm mr-2"></i>
                                        æ¸…ç©º
                                    </button>
                                    <div>
                
                                    </div>
                                </div>

                                <div class="flex justify-center mt-6">
                                    <button @click="submitTask" :disabled="submitting" class="btn-primary flex items-center justify-center px-8 py-3 rounded-lg text-lg transition-all shadow-lg">
                                        <i class="fas fa-play text-xl mr-2"></i>
                                        {{ submitting ? 'æäº¤ä¸­...' : 'ç”Ÿæˆè§†é¢‘' }}
                                    </button>
                                </div>
                            </div>
                        </div>

                </div>
                    </div>

                <!-- çµæ„Ÿå¹¿åœºåŒºåŸŸ -->
                <div v-if="currentView === 'inspiration'" class="flex-1 flex flex-col min-h-0">
                    <!-- å†…å®¹åŒºåŸŸ -->
                    <div class="flex-1 overflow-y-auto p-6 content-area">
                        <!-- çµæ„Ÿå¹¿åœºåŠŸèƒ½åŒº -->
                        <div class="max-w-4xl mx-auto" id="inspiration-gallery">
                            <!-- å›ºå®šåŠŸèƒ½åŒº -->
                            <div class="flex-shrink-0 p-1">
                                <!-- æ ‡é¢˜åŒºåŸŸ -->
                                <div class="text-center mb-8">
                                    <h1 class="text-3xl font-bold text-white mb-2">çµæ„Ÿå¹¿åœº</h1>
                                    <p class="text-gray-400">å‘ç°åˆ›æ„ï¼Œæ¿€å‘çµæ„Ÿ</p>
            </div>
            
                                <!-- æœç´¢å’Œç­›é€‰åŒºåŸŸ -->
                                <div class="flex flex-col md:flex-row gap-4 mb-6">
                                    <!-- æœç´¢æ¡† -->
                                    <div class="relative flex-1">
                                        <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none z-10"></i>
                                        <input
                                            v-model="inspirationSearchQuery"
                                            class="w-full bg-dark-light border border-laser-purple/30 rounded-lg py-3 pl-10 pr-4 text-sm focus:outline-none focus:ring-2 focus:ring-laser-purple/50 transition-all focus:border-laser focus:shadow-laser"
                                            placeholder="æœç´¢çµæ„Ÿå†…å®¹..."
                                            type="text"
                                        />
                                    </div>
                                    
                                    <!-- åˆ†ç±»ç­›é€‰ -->
                                    <div class="flex gap-2">
                                        <button
                                            v-for="category in inspirationCategories"
                                            :key="category.id"
                                            @click="selectInspirationCategory(category.id)"
                                            :class="selectedInspirationCategory === category.id 
                                                ? 'bg-laser-purple/20 text-white border-laser-purple/40' 
                                                : 'bg-dark-light text-gray-400 hover:text-white hover:bg-dark-light/80'"
                                            class="px-4 py-2 rounded-lg border border-transparent transition-all duration-200 text-sm font-medium"
                                        >
                                            {{ category.name }}
                                        </button>
                                    </div>
                                </div>

                                <!-- çµæ„Ÿå†…å®¹ç½‘æ ¼ -->
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                                    <!-- çµæ„Ÿå¡ç‰‡ -->
                                    <div 
                                        v-for="item in filteredInspirationItems" 
                                        :key="item.id"
                                        class="group relative bg-dark-light rounded-xl overflow-hidden border border-gray-700/50 hover:border-laser-purple/40 transition-all duration-300 hover:shadow-laser/20"
                                    >
                                        <!-- è§†é¢‘ç¼©ç•¥å›¾åŒºåŸŸ -->
                                        <div class="aspect-video bg-gray-800 relative overflow-hidden">
                                                <!-- è§†é¢‘é¢„è§ˆ -->
                                                <video 
                                                    v-if="item.videoUrl"
                                                    :src="item.videoUrl"
                                                    :poster="item.imageUrl"
                                                    class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                                                    muted
                                                    loop
                                                    preload="metadata"
                                                    playsinline
                                                    webkit-playsinline
                                                    @mouseenter="playVideo($event)"
                                                    @mouseleave="pauseVideo($event)"
                                                    @loadeddata="onVideoLoaded($event)"
                                                    @error="onVideoError($event)"
                                                ></video>
                                            <!-- å›¾ç‰‡ç¼©ç•¥å›¾ -->
                                            <img 
                                                v-else-if="item.imageUrl"
                                                :src="item.imageUrl" 
                                                :alt="item.title"
                                                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                                            />
                                            <!-- å ä½ç¬¦ -->
                                            <div v-else class="w-full h-full flex items-center justify-center">
                                                <i class="fas fa-star text-4xl text-gray-600"></i>
                                            </div>
                                            
                                            <!-- æ‚¬æµ®æ“ä½œæŒ‰é’® -->
                                            <div class="absolute bottom-2 left-1/2 transform -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none">
                                                <div class="flex space-x-3 pointer-events-auto">
            <button
                                                        @click="previewTemplateDetail(item)"
                                                        class="w-10 h-10 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center text-white hover:bg-white/30 transition-colors"
                                                        title="é¢„è§ˆè¯¦æƒ…"
                                                    >
                                                        <i class="fas fa-eye text-sm"></i>
                                                    </button>
                                                    <button 
                                                        @click="useTemplate(item)"
                                                        class="w-10 h-10 rounded-full bg-laser-purple/80 backdrop-blur-sm flex items-center justify-center text-white hover:bg-laser-purple transition-colors"
                                                        title="ä½¿ç”¨æ¨¡æ¿"
                                                    >
                                                        <i class="fas fa-copy text-sm"></i>
            </button>
                                                </div>
                                            </div>
                                            
                                        </div>
                                        
                                        <!-- å†…å®¹ä¿¡æ¯ -->
                                        <div class="p-4">
                                            <h3 class="text-white font-medium text-sm mb-2 line-clamp-2">{{ item.title }}</h3>
                                            <!-- æ ‡ç­¾ -->
                                            <div class="flex flex-wrap gap-1 mb-3">
                                                <span 
                                                    v-for="tag in item.tags" 
                                                    :key="tag"
                                                    class="px-2 py-1 bg-gray-700/50 text-gray-300 text-xs rounded-full"
                                                >
                                                    {{ tag }}
                                                </span>
                                            </div>
                                            
                                            <!-- åº•éƒ¨ä¿¡æ¯ -->
                                            <div class="flex items-center justify-between text-xs text-gray-500">
                                                <span>{{ item.category }}</span>
                                                <span>{{ formatDate(item.createdAt) }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- åŠ è½½æ›´å¤šæŒ‰é’® -->
                                <div class="text-center mt-8">
                                    <button 
                                        @click="loadMoreInspiration"
                                        class="px-6 py-3 bg-laser-purple/20 text-laser-purple border border-laser-purple/40 rounded-lg hover:bg-laser-purple/30 transition-all duration-200 font-medium"
                                    >
                                        åŠ è½½æ›´å¤šçµæ„Ÿ
                                                </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                </div>
            </div>
        </div>

        <!-- å¢å¼ºçš„æç¤ºæ¶ˆæ¯ç³»ç»Ÿ -->
        <div v-cloak>
            <div v-if="alert.show"
                class="fixed top-4 left-1/2 transform -translate-x-1/2 z-[9999] max-w-xs w-full px-4"
                :class="getAlertClass(alert.type)">
                <div class="bg-gray-800/95 backdrop-blur-sm border border-gray-700/50 rounded-lg shadow-lg transition-all duration-300 ease-out">
                    <div class="flex items-center p-3">
                        <div class="flex-shrink-0 mr-3">
                            <div class="w-6 h-6 rounded-full flex items-center justify-center"
                                :class="getAlertIconBgClass(alert.type)">
                                <i :class="getAlertIcon(alert.type)" class="text-xs"></i>
                            </div>
                        </div>
                        <div class="flex-1">
                            <p class="text-xs font-medium text-gray-200">
                                {{ alert.message }}
                            </p>
                        </div>
                        <div class="flex-shrink-0 ml-2">
                            <button @click="alert.show = false"
                                    class="w-5 h-5 rounded-full flex items-center justify-center text-gray-400 hover:text-gray-200 hover:bg-gray-700/50 transition-all duration-200">
                                <i class="fas fa-times text-xs"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡† -->
         <div v-cloak>
        <div v-if="confirmDialog.show" class="fixed inset-0 z-50 flex items-center justify-center p-4">
            <!-- èƒŒæ™¯é®ç½© -->
            <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" @click="confirmDialog.show = false"></div>
            
            <!-- å¯¹è¯æ¡†å†…å®¹ -->
            <div class="relative bg-dark-light border border-laser-purple/30 rounded-xl shadow-2xl max-w-md w-full mx-4 transform transition-all duration-300 ease-out"
                 :class="confirmDialog.show ? 'scale-100 opacity-100' : 'scale-95 opacity-0'">
                <!-- å¤´éƒ¨ -->
                <div class="flex items-center justify-between p-6 border-b border-gray-700">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-red-500/20 rounded-full flex items-center justify-center">
                            <i class="fas fa-exclamation-triangle text-red-400 text-lg"></i>
                                            </div>
                        <h3 class="text-lg font-semibold text-white">{{ confirmDialog.title }}</h3>
                    </div>
                    <button @click="confirmDialog.show = false" 
                            class="text-gray-400 hover:text-gray-300 transition-colors">
                        <i class="fas fa-times text-lg"></i>
                                                </button>
                                                </div>
                
                <!-- å†…å®¹ -->
                <div class="p-6">
                    <p class="text-gray-300 leading-relaxed mb-6">{{ confirmDialog.message }}</p>
                    
                    <!-- è­¦å‘Šä¿¡æ¯ -->
                    <div v-if="confirmDialog.warning" class="bg-red-500/10 border border-red-500/30 rounded-lg p-4 mb-6">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-info-circle text-red-400 mt-0.5"></i>
                            <div class="text-sm text-red-300">
                                <p class="font-medium mb-2">{{ confirmDialog.warning.title }}</p>
                                <ul class="space-y-1 text-xs">
                                    <li v-for="item in confirmDialog.warning.items" :key="item" class="flex items-center gap-2">
                                        <i class="fas fa-minus text-red-400 text-xs"></i>
                                        {{ item }}
                                    </li>
                                </ul>
                                            </div>
                                        </div>
                                    </div>
                </div>
                
                <!-- åº•éƒ¨æŒ‰é’® -->
                <div class="flex gap-3 p-6 pt-0">
                    <button @click="confirmDialog.cancel()" 
                            class="flex-1 px-4 py-2.5 bg-gray-600 hover:bg-gray-500 text-white rounded-lg transition-all duration-200 font-medium">
                        å–æ¶ˆ
                    </button>
                    <button @click="confirmDialog.confirm()" 
                            class="flex-1 px-4 py-2.5 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-all duration-200 font-medium flex items-center justify-center gap-2">
                        <i class="fas fa-trash text-sm"></i>
                        {{ confirmDialog.confirmText }}
                    </button>
                </div>
            </div>
        </div>
        </div>

        <!-- æç¤ºè¯æ¨¡æ¿å’Œå†å²è®°å½•å¼¹çª— -->
        <div v-cloak>
            <div v-if="showPromptModal"
                class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center"
                @click="showPromptModal = false">
                <div class="bg-secondary rounded-xl p-6 max-w-4xl w-full mx-4 max-h-[80vh] overflow-hidden"
                    @click.stop>
                    <!-- æµ®çª—å¤´éƒ¨ -->
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-medium text-white">
                            <i class="fas fa-lightbulb text-gradient-icon mr-2"></i>
                            æç¤ºè¯ç´ æåº“
                        </h3>
                        <button @click="showPromptModal = false"
                                class="text-gray-400 hover:text-white transition-colors">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>

                    <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
                    <div class="flex border-b border-gray-700 mb-6">
                        <button @click="promptModalTab = 'templates'"
                                class="px-4 py-2 text-sm font-medium transition-colors"
                                :class="promptModalTab === 'templates' 
                                    ? 'text-gradient-icon border-b-2 border-laser-purple' 
                                    : 'text-gray-400 hover:text-gray-300'">
                            <i class="fas fa-layer-group mr-2"></i>
                            æ¨¡æ¿
                        </button>
                        <button @click="promptModalTab = 'history'"
                                class="px-4 py-2 text-sm font-medium transition-colors"
                                :class="promptModalTab === 'history' 
                                    ? 'text-gradient-icon border-b-2 border-laser-purple' 
                                    : 'text-gray-400 hover:text-gray-300'">
                            <i class="fas fa-history mr-2"></i>
                            å†å²è®°å½•
                        </button>
                    </div>

                    <!-- æ¨¡æ¿å†…å®¹ -->
                    <div v-if="promptModalTab === 'templates'" class="overflow-y-auto max-h-[50vh]">
                        <div v-if="getPromptTemplates(selectedTaskId).length > 0" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <button
                                v-for="template in getPromptTemplates(selectedTaskId)"
                                :key="template.id"
                                @click="selectPromptTemplate(template)"
                                class="p-4 text-left bg-dark-light rounded-lg hover:bg-laser-purple/20 transition-all border border-transparent hover:border-laser-purple/40 group"
                            >
                                <div class="font-medium text-sm mb-2 text-white group-hover:text-gradient-icon transition-colors">
                                    {{ template.title }}
                                </div>
                                <div class="text-xs text-gray-400 line-clamp-3 leading-relaxed">
                                    {{ template.prompt }}
                                </div>
                                <div class="mt-3 flex items-center justify-between">
                                    <span class="text-xs text-laser-purple/60">ç‚¹å‡»åº”ç”¨</span>
                                    <i class="fas fa-arrow-right text-xs text-laser-purple/60 group-hover:translate-x-1 transition-transform"></i>
                                </div>
                            </button>
                        </div>
                        <div v-else class="flex flex-col items-center justify-center py-12 text-center">
                            <div class="w-16 h-16 bg-laser-purple/20 rounded-full flex items-center justify-center mb-4">
                                <i class="fas fa-layer-group text-gradient-icon text-2xl"></i>
                            </div>
                            <p class="text-gray-400 text-lg mb-2">æš‚æ— å¯ç”¨æ¨¡æ¿</p>
                            <p class="text-gray-500 text-sm">è¯·å…ˆé€‰æ‹©ä»»åŠ¡ç±»å‹</p>
                        </div>
                    </div>

                    <!-- å†å²è®°å½•å†…å®¹ -->
                    <div v-if="promptModalTab === 'history'" class="overflow-y-auto max-h-[50vh]">
                        <div v-if="promptHistory.length === 0" class="flex flex-col items-center justify-center py-12 text-center">
                            <div class="w-16 h-16 bg-laser-purple/20 rounded-full flex items-center justify-center mb-4">
                                <i class="fas fa-history text-gradient-icon text-2xl"></i>
                            </div>
                            <p class="text-gray-400 text-lg mb-2">æš‚æ— å†å²è®°å½•</p>
                            <p class="text-gray-500 text-sm">å¼€å§‹åˆ›å»ºä»»åŠ¡åï¼Œæç¤ºè¯å°†è‡ªåŠ¨ä¿å­˜</p>
                        </div>
                        <div v-else class="space-y-3">
                            <div class="flex items-center justify-between mb-4">
                                <span class="text-sm text-gray-400">å…± {{ promptHistory.length }} æ¡è®°å½•</span>
                                <button @click="clearPromptHistory" 
                                        class="text-xs text-red-400 hover:text-red-300 transition-colors flex items-center gap-1"
                                        title="æ¸…ç©ºå†å²è®°å½•">
                                    <i class="fas fa-trash"></i>
                                    æ¸…ç©º
                                </button>
                            </div>
                            <button
                                v-for="(history, index) in promptHistory"
                                :key="index"
                                @click="selectPromptHistory(history)"
                                class="w-full p-4 text-left bg-dark-light rounded-lg hover:bg-laser-purple/20 transition-all border border-transparent hover:border-laser-purple/40 group"
                            >
                                <div class="text-sm text-gray-300 line-clamp-3 leading-relaxed group-hover:text-white transition-colors">
                                    {{ history }}
                                </div>
                                <div class="mt-2 flex items-center justify-between">
                                    <span class="text-xs text-laser-purple/60">ç‚¹å‡»åº”ç”¨</span>
                                    <i class="fas fa-arrow-right text-xs text-laser-purple/60 group-hover:translate-x-1 transition-transform"></i>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

            <!-- æ¨¡æ¿è¯¦æƒ…å¼¹çª— -->
            <div v-cloak>
                <div v-if="showTemplateDetailModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" @click="closeTemplateDetailModal">
                    <div class="bg-secondary rounded-xl max-w-6xl w-full max-h-[90vh] overflow-hidden" @click.stop>
                        <!-- å¼¹çª—å¤´éƒ¨ -->
                        <div class="flex items-center justify-between p-6 border-b border-gray-700">
                            <h3 class="text-xl font-medium text-white flex items-center">
                                <i class="fas fa-star text-laser-purple mr-3"></i>
                                æ¨¡æ¿è¯¦æƒ…
                            </h3>
                            <button @click="closeTemplateDetailModal" class="text-gray-400 hover:text-white transition-colors">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        
                        <!-- å¼¹çª—å†…å®¹ -->
                        <div class="flex h-[calc(90vh-120px)]">
                            <!-- å·¦ä¾§è§†é¢‘æ’­æ”¾åŒºåŸŸ -->
                            <div class="flex-1 p-6">
                                <div class="w-full h-full bg-gray-900 rounded-lg overflow-hidden">
                                    <video 
                                        v-if="selectedTemplate?.videoUrl"
                                        :src="selectedTemplate.videoUrl"
                                        class="w-full h-full object-contain"
                                        controls
                                        autoplay
                                    ></video>
                                    <div v-else class="w-full h-full flex items-center justify-center text-gray-500">
                                        <i class="fas fa-video text-4xl"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- å³ä¾§æ¨¡æ¿ä¿¡æ¯åŒºåŸŸ -->
                            <div class="w-[28rem] overflow-y-auto border-l border-gray-700">
                                <div class="p-6 space-y-6">
                                    <!-- æ“ä½œæŒ‰é’® -->
                                    <div class="flex flex-col space-y-3 items-center">
                                        <button 
                                            @click="useTemplate(selectedTemplate)"
                                            class="w-3/4 px-4 py-3 bg-laser-purple/20 text-laser-purple border border-laser-purple/40 rounded-xl hover:bg-laser-purple/30 transition-all duration-200 font-medium"
                                        >
                                            ä½¿ç”¨æ¨¡æ¿
                                        </button>

                                    </div>  
                                    
                                    <!-- æ¨¡æ¿ä¿¡æ¯ -->
                                    <div>
                                        <h4 class="text-lg font-medium text-white mb-3">æ¨¡æ¿ä¿¡æ¯</h4>
                                        <div class="space-y-2 text-sm">
                                            <div class="flex justify-between">
                                                <span class="text-gray-400">æ¨¡å‹:</span>
                                                <span class="text-white">{{ selectedTemplate?.templateData?.task?.model_cls }}</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-400">ç±»å‹:</span>
                                                <span class="text-white">{{ selectedTemplate?.templateData?.task?.task_type }}</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-400">æç¤ºè¯:</span>
                                                <span class="text-white text-xs">{{ selectedTemplate?.templateData?.task?.params?.prompt }}</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- è¾“å…¥ç´ æ -->
                                    <div>
                                        <h4 class="text-lg font-medium text-white mb-3">è¾“å…¥ç´ æ</h4>
                                        <div class="space-y-4">
                                            <!-- è¾“å…¥å›¾ç‰‡ -->
                                            <div v-if="selectedTemplate?.imageUrl">
                                                <label class="text-sm text-gray-400 mb-2 block">è¾“å…¥å›¾ç‰‡</label>
                                                <div class="w-32 h-32 bg-gray-800 rounded-lg overflow-hidden">
                                                    <img 
                                                        :src="selectedTemplate.imageUrl" 
                                                        :alt="'è¾“å…¥å›¾ç‰‡'"
                                                        class="w-full h-full object-cover"
                                                    />
                                                </div>
                                            </div>
                                            
                                            <!-- è¾“å…¥éŸ³é¢‘ -->
                                            <div v-if="selectedTemplate?.audioUrl">
                                                <label class="text-sm text-gray-400 mb-2 block">è¾“å…¥éŸ³é¢‘</label>
                                                <div class="bg-gray-800 rounded-lg p-3">
                                                    <audio 
                                                        :src="selectedTemplate.audioUrl" 
                                                        controls
                                                        class="w-full"
                                                    ></audio>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä»»åŠ¡è¯¦æƒ…å¼¹çª— -->
            <div v-cloak>
                <div v-if="showTaskDetailModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" @click="closeTaskDetailModal">
                    <!-- ä»»åŠ¡å®Œæˆæ—¶çš„å¤§å¼¹çª— -->
                    <div v-if="modalTask?.status === 'SUCCEED'" class="bg-secondary rounded-xl max-w-7xl w-full max-h-[95vh] overflow-hidden" @click.stop>
                        <!-- å¼¹çª—å¤´éƒ¨ -->
                        <div class="flex items-center justify-between p-6 border-b border-gray-700">
                            <h3 class="text-xl font-medium text-white flex items-center">
                                <i class="fas fa-info-circle text-gradient-icon mr-2"></i>
                                ä»»åŠ¡è¯¦æƒ…
                            </h3>
                            <button @click="closeTaskDetailModal" class="text-gray-400 hover:text-white transition-colors">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>

                        <!-- å·¦å³å¸ƒå±€å†…å®¹ -->
                        <div class="flex h-[calc(100vh-120px)]">
                            <!-- å·¦ä¾§è§†é¢‘æ’­æ”¾å™¨ -->
                            <div class="flex-1 p-6">
                                <div class="h-full bg-black rounded-xl border border-laser-purple/50 overflow-hidden">
                        <video
                            v-if="selectedTaskFiles.outputs.output_video && selectedTaskFiles.outputs.output_video.url"
                                        class="w-full h-full object-contain"
                            controls
                            preload="metadata"
                            :src="selectedTaskFiles.outputs.output_video.url">
                            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
                        </video>
                        <div v-else-if="selectedTaskFiles.outputs.output_video && selectedTaskFiles.outputs.output_video.error"
                            class="w-full h-full flex items-center justify-center bg-red-900/20">
                            <div class="text-center">
                                <i class="fas fa-exclamation-triangle text-red-400 text-2xl mb-2"></i>
                                <p class="text-red-400 text-sm">è§†é¢‘åŠ è½½å¤±è´¥</p>
                            </div>
                        </div>
                        <div v-else
                            class="w-full h-full flex items-center justify-center bg-gray-700">
                            <div class="text-center">
                                <i class="fas fa-spinner fa-spin text-gray-400 text-2xl mb-2"></i>
                                <p class="text-gray-400 text-sm">åŠ è½½è§†é¢‘ä¸­...</p>
                            </div>
                        </div>
                    </div>
                </div>

                            <!-- å³ä¾§ä»»åŠ¡è¯¦æƒ… -->
                            <div class="w-[28rem] overflow-y-auto border-l border-gray-700">
                                <!-- ä»»åŠ¡æ“ä½œæŒ‰é’® -->
                                <div class="flex flex-col space-y-3 items-center">
                                    <button v-if="['CREATED', 'PENDING', 'RUNNING'].includes(modalTask?.status)"
                                            @click="cancelTask(modalTask.task_id, true); closeTaskDetailModal()"
                                            class="w-3/4 px-4 py-3 bg-gray-700/50 hover:bg-gray-600/50 text-white border border-gray-600/30 rounded-xl text-sm transition-all duration-200 hover:border-gray-500/50">
                                        <i class="fas fa-times mr-2"></i>
                                        å–æ¶ˆä»»åŠ¡
                                    </button>
                                    <button v-if="['SUCCEED', 'FAILED', 'CANCEL'].includes(modalTask?.status)"
                                            @click="reuseTask(modalTask); closeTaskDetailModal()"
                                            class="w-3/4 px-4 py-3 bg-laser-purple/20 hover:bg-laser-purple/30 text-white border border-laser-purple/40 rounded-xl text-sm transition-all duration-200 hover:border-laser-purple/60">
                                        <i class="fas fa-copy mr-2"></i>
                                        å¤ç”¨ä»»åŠ¡
                                    </button>
                                    <button v-if="['SUCCEED', 'FAILED', 'CANCEL'].includes(modalTask?.status)"
                                            @click="resumeTask(modalTask.task_id, true); closeTaskDetailModal()"
                                            class="w-3/4 px-4 py-3 bg-gray-700/50 hover:bg-gray-600/50 text-white border border-gray-600/30 rounded-xl text-sm transition-all duration-200 hover:border-gray-500/50">
                                        <i class="fas fa-redo mr-2"></i>
                                        é‡æ–°ç”Ÿæˆ
                                    </button>
                                    <button v-if="selectedTaskFiles.outputs.output_video && selectedTaskFiles.outputs.output_video.url"
                                            @click="downloadFile(selectedTaskFiles.outputs.output_video)"
                                            class="w-3/4 px-4 py-3 bg-gray-700/50 hover:bg-gray-600/50 text-white border border-gray-600/30 rounded-xl text-sm transition-all duration-200 hover:border-gray-500/50">
                                        <i class="fas fa-download mr-2"></i>
                                        ä¸‹è½½è§†é¢‘
                                    </button>
                                    <button v-if="['SUCCEED', 'FAILED', 'CANCEL'].includes(modalTask?.status)"
                                            @click="deleteTask(modalTask.task_id, true); closeTaskDetailModal()"
                                            class="w-3/4 px-4 py-3 bg-red-900/20 hover:bg-red-900/30 text-red-400 border border-red-500/30 rounded-xl text-sm transition-all duration-200 hover:border-red-500/50">
                                        <i class="fas fa-trash mr-2"></i>
                                        åˆ é™¤ä»»åŠ¡
                                    </button>
            </div>
                                <div class="p-6 space-y-6">
                                    <!-- ä»»åŠ¡çŠ¶æ€æ˜¾ç¤º -->
                                    <div class="bg-secondary/30 rounded-xl p-4">
                                <h4 class="text-sm font-medium mb-3 flex items-center">
                                    <i class="fas fa-info-circle text-gradient-icon mr-2"></i>
                                    ä»»åŠ¡ä¿¡æ¯
                                </h4>
                                <ul class="space-y-2 text-sm">
                                    <li class="flex justify-between">
                                        <span class="text-gray-400">ä»»åŠ¡ID</span>
                                        <span class="text-xs">{{ modalTask?.task_id }}</span>
                                    </li>
                                    <li class="flex justify-between">
                                        <span class="text-gray-400">ä»»åŠ¡ç±»å‹</span>
                                        <span>{{ getTaskTypeName(modalTask) }}</span>
                                    </li>
                                    <li class="flex justify-between">
                                        <span class="text-gray-400">æ¨¡å‹åç§°</span>
                                        <span class="text-gradient-icon">{{ modalTask?.model_cls }}</span>
                                    </li>
                                    <li class="flex justify-between">
                                        <span class="text-gray-400">åˆ›å»ºæ—¶é—´</span>
                                        <span>{{ formatTime(modalTask?.create_t) }}</span>
                                    </li>
                                    <li class="flex justify-between">
                                        <span class="text-gray-400">æ›´æ–°æ—¶é—´</span>
                                        <span>{{ formatTime(modalTask?.update_t) }}</span>
                                    </li>
                                    <li class="flex justify-between">
                                        <span class="text-gray-400">çŠ¶æ€</span>
                                        <span :class="getStatusTextClass(modalTask?.status)">{{ getTaskStatusDisplay(modalTask?.status) }}</span>
                                    </li>
                                </ul>
        </div>

                                    <!-- æç¤ºè¯ -->
                                    <div class="bg-secondary/30 rounded-xl p-4">
                                        <h4 class="text-sm font-medium mb-3 flex items-center">
                                            <i class="fas fa-file-alt text-gradient-icon mr-2"></i>
                                            æç¤ºè¯
                                        </h4>
                                        <div class="bg-dark-light rounded-lg p-3 text-sm text-gray-300">
                                    <p>{{ modalTask?.params?.prompt || 'æ— æç¤ºè¯' }}</p>
                                </div>
                                </div>

                                    <!-- ä¸Šä¼ ç´ æ -->
                                    <div v-if="modalTask?.inputs && Object.keys(modalTask.inputs).length" class="bg-secondary/30 rounded-xl p-4">
                                <h4 class="text-sm font-medium mb-3 flex items-center">
                                    <i class="fas fa-upload text-gradient-icon mr-2"></i>
                                    ä¸Šä¼ ç´ æ
                                    <span v-if="loadingTaskFiles" class="ml-2 text-xs text-gray-400">(åŠ è½½ä¸­...)</span>
                                </h4>
                                <div class="space-y-3">
                                    <template v-for="(input, key) in modalTask.inputs" :key="key">
                                        <div class="flex items-center gap-3">
                                            <template v-if="key.includes('image')">
                                                <i class="fas fa-image text-gradient-icon text-lg"></i>
                                                <div class="flex items-center gap-2">
                                                    <span v-if="!selectedTaskFiles.inputs[key] || !selectedTaskFiles.inputs[key].url"
                                                        class="text-gray-400 text-sm">{{ typeof input === 'string' ? input : 'å›¾ç‰‡' }}</span>
                                                    <div class="flex items-center gap-2 relative group">
                                                        <img v-if="selectedTaskFiles.inputs[key] && selectedTaskFiles.inputs[key].url"
                                                            :src="selectedTaskFiles.inputs[key].url"
                                                            :alt="input"
                                                            class="w-16 h-16 object-cover rounded bg-dark-light border border-gray-700">
                                                        <div v-else-if="selectedTaskFiles.inputs[key] && selectedTaskFiles.inputs[key].error"
                                                            class="w-16 h-16 rounded bg-red-900/20 border border-red-500/30 flex items-center justify-center">
                                                            <i class="fas fa-exclamation-triangle text-red-400"></i>
                                                        </div>
                                                        <div v-else
                                                            class="w-16 h-16 rounded bg-gray-700 border border-gray-600 flex items-center justify-center">
                                                            <i class="fas fa-spinner fa-spin text-gray-400"></i>
                                                        </div>
                                                        <button v-if="selectedTaskFiles.inputs[key] && selectedTaskFiles.inputs[key].url"
                                                                @click="downloadFile(selectedTaskFiles.inputs[key])"
                                                                class="text-xs px-2 py-1 rounded">
                                                            <i class="fas fa-download mr-1 text-white opacity-30 hover:opacity-100 transition-opacity"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </template>
                                            <template v-else-if="key.includes('audio')">
                                                <i class="fas fa-microphone text-gradient-icon text-lg"></i>
                                                <div class="flex items-center gap-2">
                                                    <span v-if="!selectedTaskFiles.inputs[key] || !selectedTaskFiles.inputs[key].url"
                                                        class="text-gray-400 text-sm">{{ typeof input === 'string' ? input : 'éŸ³é¢‘æ–‡ä»¶' }}</span>
                                                    <div class="flex items-center gap-2">
                                                        <audio v-if="selectedTaskFiles.inputs[key] && selectedTaskFiles.inputs[key].url"
                                                            :src="selectedTaskFiles.inputs[key].url"
                                                            controls
                                                            class="h-8 text-gradient-icon">
                                                            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
                                                        </audio>
                                                        <div v-else-if="selectedTaskFiles.inputs[key] && selectedTaskFiles.inputs[key].error"
                                                            class="h-8 px-3 rounded bg-red-900/20 border border-red-500/30 flex items-center">
                                                            <i class="fas fa-exclamation-triangle text-red-400 text-xs"></i>
                                                        </div>
                                                        <div v-else
                                                            class="h-8 px-3 rounded bg-gray-700 border border-gray-600 flex items-center">
                                                            <i class="fas fa-spinner fa-spin text-gray-400 text-xs"></i>
                                                        </div>
                                                        <button v-if="selectedTaskFiles.inputs[key] && selectedTaskFiles.inputs[key].url"
                                                                @click="downloadFile(selectedTaskFiles.inputs[key])"
                                                                class="text-xs px-2 py-1 rounded">
                                                            <i class="fas fa-download mr-1 text-white opacity-30 hover:opacity-100 transition-opacity"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </template>
                                        </div>
                                    </template>
                                </div>
                            </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- å…¶ä»–çŠ¶æ€çš„å°å¼¹çª— -->
                    <div v-else class="bg-secondary rounded-xl max-w-4xl w-full max-h-[90vh] overflow-hidden" @click.stop>
                        <!-- å¼¹çª—å¤´éƒ¨ -->
                        <div class="flex items-center justify-between p-6 border-b border-gray-700">
                            <h3 class="text-xl font-medium text-white flex items-center">
                                <i class="fas fa-info-circle text-gradient-icon mr-2"></i>
                                ä»»åŠ¡è¯¦æƒ…
                            </h3>
                            <button @click="closeTaskDetailModal" class="text-gray-400 hover:text-white transition-colors">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>

                        <!-- å¼¹çª—å†…å®¹ -->
 

                        <div class="overflow-y-auto max-h-[calc(90vh-120px)] p-6">
                                <!-- ä»»åŠ¡è¿›è¡Œä¸­ä¿¡æ¯ -->
                            <div v-if="['CREATED', 'PENDING', 'RUNNING'].includes(modalTask?.status)" class="max-w-4xl mx-auto task-running-panel">
                                    <div class="text-center py-8">
                                        <div class="w-24 h-24 mx-auto bg-laser-purple/20 rounded-full flex items-center justify-center mb-6 animate-pulse-slow">
                                            <i class="fas fa-spinner fa-spin text-gradient-icon text-3xl"></i>
                                        </div>
                                        <h3 class="text-xl font-medium mb-2">è§†é¢‘ç”Ÿæˆä¸­</h3>
                                        <p class="text-gray-400 mb-6">AIæ­£åœ¨åŠªåŠ›ç”Ÿæˆæ‚¨çš„è§†é¢‘ï¼Œè¯·ç¨å€™...</p>
                                        
                                        <!-- å­ä»»åŠ¡è¿›åº¦æ˜¾ç¤º -->
                                    <div v-if="modalTask && modalTask.subtasks && modalTask.subtasks.length > 0" class="progress-container">
                                            <h4 class="text-sm font-medium mb-4 flex items-center">
                                            <i class="fas fa-chart-line text-gradient-icon mr-2"></i>
                                            ä»»åŠ¡è¿›åº¦
                                            </h4>
                                            
                                            <!-- æ€»ä½“è¿›åº¦æ¡ -->
                                            <div class="mb-4">
                                                <div class="flex justify-between items-center mb-2">
                                                 <span class="text-sm text-gray-300">{{ getProgressTitle(modalTask.subtasks || []) }}</span>
                                                 <span class="text-sm text-gradient-icon">{{ getProgressInfo(modalTask.subtasks || []) }}</span>
                                                </div>
                                                <div class="progress-bar">
                                                 <div class="progress-fill" :style="{ width: getOverallProgress(modalTask.subtasks || []) + '%' }"></div>
                                                </div>
                                            </div>
                                            
                                            <!-- å­ä»»åŠ¡åˆ—è¡¨ -->
                                            <div class="space-y-2">
                                            <div v-for="(subtask, index) in (modalTask.subtasks || [])" :key="index" class="subtask-item">
                                                    <div class="subtask-header">
                                                        <span class="text-sm font-medium">å­ä»»åŠ¡ {{ index + 1 }}</span>
                                                        <span class="subtask-status" :class="subtask.status.toLowerCase()">
                                                            {{ getSubtaskStatusText(subtask.status) }}
                                                        </span>
                                                    </div>
                                                    
                                                    <!-- å­ä»»åŠ¡è¿›åº¦æ¡ -->
                                                    <div v-if="subtask.status === 'PENDING' || subtask.status === 'RUNNING'" class="mt-2">
                                                        <div class="flex justify-between items-center mb-1">
                                                            <span class="text-xs text-gray-400">{{ getSubtaskStatusText(subtask.status) }}</span>
                                                            <span class="text-xs text-gradient-icon">{{ formatEstimatedTime(subtask) }}</span>
                                                        </div>
                                                        <div class="progress-bar">
                                                            <div class="progress-fill" :style="{ width: getSubtaskProgress(subtask) + '%' }"></div>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- å­ä»»åŠ¡è¯¦ç»†ä¿¡æ¯ -->
                                                    <div class="subtask-info">
                                                        <div v-if="subtask.estimated_pending_order !== null" class="flex items-center gap-2 mt-1">
                                                            <i class="fas fa-clock text-xs"></i>
                                                            <span>é˜Ÿåˆ—ä½ç½®: {{ subtask.estimated_pending_order }}</span>
                                                        </div>
                                                        <div v-if="subtask.ready_worker_count !== null" class="flex items-center gap-2 mt-1">
                                                            <i class="fas fa-users text-xs"></i>
                                                            <span>å¯ç”¨Worker: {{ subtask.ready_worker_count }}</span>
                                                        </div>
                                                        <div v-if="subtask.fail_msg" class="flex items-center gap-2 mt-1 text-red-400">
                                                            <i class="fas fa-exclamation-triangle text-xs"></i>
                                                            <span>{{ subtask.fail_msg }}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- ä»»åŠ¡å¤±è´¥ä¿¡æ¯ -->
                            <div v-if="modalTask?.status === 'FAILED'" class="max-w-4xl mx-auto task-failed-panel">
                                    <div class="text-center py-8">
                                        <div class="w-24 h-24 mx-auto bg-red-500/10 rounded-full flex items-center justify-center mb-6">
                                            <i class="fas fa-exclamation-triangle text-red-500 text-3xl"></i>
                                        </div>
                                        <h3 class="text-xl font-medium mb-2">è§†é¢‘ç”Ÿæˆå¤±è´¥</h3>
                                        <p class="text-gray-400 mb-4 max-w-md mx-auto flex items-center justify-center gap-2">
                                            å¾ˆæŠ±æ­‰ï¼Œæ‚¨çš„è§†é¢‘ç”Ÿæˆä»»åŠ¡æœªèƒ½å®Œæˆã€‚
                                        <button v-if="getTaskFailureInfo(modalTask)" 
                                                    @click="showErrorDetails = !showErrorDetails" 
                                                    class="text-gray-400 hover:text-gray-100 transition-colors">
                                                <i class="fas fa-info-circle"></i>
                                            </button>
                                        </p>
                                        
                                        <!-- å¯å±•å¼€çš„é”™è¯¯è¯¦æƒ… -->
                                    <div v-if="showErrorDetails && getTaskFailureInfo(modalTask)" class="mt-4">
                                            <span class="text-xs">{{ getTaskFailureInfo(modalTask) }}</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- ä»»åŠ¡å–æ¶ˆä¿¡æ¯ -->
                            <div v-if="modalTask?.status === 'CANCEL'" class="max-w-4xl mx-auto task-cancelled-panel">
                                    <div class="text-center py-8">
                                        <div class="w-24 h-24 mx-auto bg-yellow-500/10 rounded-full flex items-center justify-center mb-6">
                                            <i class="fas fa-ban text-yellow-500 text-3xl"></i>
                                        </div>
                                        <h3 class="text-xl font-medium mb-2">ä»»åŠ¡å·²å–æ¶ˆ</h3>
                                        <p class="text-gray-400 mb-4 max-w-md mx-auto">
                                            æ­¤ä»»åŠ¡å·²è¢«å–æ¶ˆï¼Œæ‚¨å¯ä»¥é‡æ–°ç”Ÿæˆæˆ–æŸ¥çœ‹ä¹‹å‰ä¸Šä¼ çš„ç´ æã€‚
                                        </p>
                                    </div>

                                </div>

                            <!-- ä»»åŠ¡æ“ä½œæŒ‰é’® -->
                            <div class="flex justify-center space-x-3 p-4">
                            <button v-if="['CREATED', 'PENDING', 'RUNNING'].includes(modalTask?.status)"
                                    @click="cancelTask(modalTask.task_id, true); closeTaskDetailModal()"
                                            class="px-4 py-2 btn-primary rounded-lg text-sm transition-all">
                                        <i class="fas fa-times mr-2"></i>
                                        å–æ¶ˆä»»åŠ¡
                                    </button>
                            <button v-if="['SUCCEED', 'FAILED', 'CANCEL','CREATED', 'PENDING', 'RUNNING'].includes(modalTask?.status)"
                                    @click="reuseTask(modalTask); closeTaskDetailModal()"
                                    class="px-4 py-3 bg-laser-purple/20 hover:bg-laser-purple/30 text-white border border-laser-purple/40 rounded-xl text-sm transition-all duration-200 hover:border-laser-purple/60">
                                <i class="fas fa-copy mr-2"></i>
                                        å¤ç”¨ä»»åŠ¡
                                    </button>
                            <button v-if="['SUCCEED', 'FAILED', 'CANCEL'].includes(modalTask?.status)"
                                    @click="resumeTask(modalTask.task_id, true); closeTaskDetailModal()"
                                    class="px-4 py-3 bg-gray-700/50 hover:bg-gray-600/50 text-white border border-gray-600/30 rounded-xl text-sm transition-all duration-200 hover:border-gray-500/50">
                                        <i class="fas fa-redo mr-2"></i>
                                        é‡æ–°ç”Ÿæˆ
                                    </button>
                            <button v-if="['SUCCEED', 'FAILED', 'CANCEL'].includes(modalTask?.status)"
                                    @click="deleteTask(modalTask.task_id, true); closeTaskDetailModal()"
                                    class="px-4 py-3 bg-red-900/20 hover:bg-red-900/30 text-red-400 border border-red-500/30 rounded-xl text-sm transition-all duration-200 hover:border-red-500/50">
                                        <i class="fas fa-trash mr-2"></i>
                                        åˆ é™¤ä»»åŠ¡
                                    </button>
                                </div>
                            
                                <!-- ä»»åŠ¡çŠ¶æ€æ˜¾ç¤º -->
                                <div class="bg-secondary/30 rounded-xl p-6 mb-6">
                                    <h4 class="text-sm font-medium mb-3 flex items-center">
                                        <i class="fas fa-info-circle text-gradient-icon mr-2"></i>
                                        ä»»åŠ¡ä¿¡æ¯
                                    </h4>
                                    <ul class="space-y-2 text-sm">
                                        <li class="flex justify-between">
                                            <span class="text-gray-400">ä»»åŠ¡ID</span>
                                        <span>{{ modalTask?.task_id }}</span>
                                        </li>
                                        <li class="flex justify-between">
                                            <span class="text-gray-400">ä»»åŠ¡ç±»å‹</span>
                                        <span>{{ getTaskTypeName(modalTask) }}</span>
                                        </li>
                                        <li class="flex justify-between">
                                            <span class="text-gray-400">æ¨¡å‹åç§°</span>
                                        <span class="text-gradient-icon">{{ modalTask?.model_cls }}</span>
                                        </li>
                                        <li class="flex justify-between">
                                            <span class="text-gray-400">åˆ›å»ºæ—¶é—´</span>
                                        <span>{{ formatTime(modalTask?.create_t) }}</span>
                                        </li>
                                        <li class="flex justify-between">
                                            <span class="text-gray-400">æ›´æ–°æ—¶é—´</span>
                                        <span>{{ formatTime(modalTask?.update_t) }}</span>
                                        </li>
                                        <li class="flex justify-between">
                                            <span class="text-gray-400">çŠ¶æ€</span>
                                        <div class="flex items-center gap-2">
                                            <span :class="getStatusTextClass(modalTask?.status)">{{ getTaskStatusDisplay(modalTask?.status) }}</span>
                                            <button v-if="modalTask?.status === 'FAILED' && getTaskFailureInfo(modalTask)"
                                                    @click="showFailureDetails = !showFailureDetails"
                                                    class="text-red-400 hover:text-red-300 transition-colors"
                                                    title="æŸ¥çœ‹å¤±è´¥åŸå› ">
                                                <i class="fas fa-exclamation-triangle text-xs"></i>
                                            </button>
                                        </div>
                                        </li>
                                    </ul>
                                
                                <!-- å¤±è´¥åŸå› è¯¦æƒ… -->
                                <div v-if="showFailureDetails && modalTask?.status === 'FAILED' && getTaskFailureInfo(modalTask)" 
                                     class="mt-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg">
                                    <div class="flex items-start gap-2">
                                        <i class="fas fa-exclamation-triangle text-red-400 text-sm mt-0.5"></i>
                                        <div class="flex-1">
                                            <p class="text-xs text-red-300 font-medium mb-1">å¤±è´¥åŸå› ï¼š</p>
                                            <p class="text-xs text-red-200 whitespace-pre-wrap">{{ getTaskFailureInfo(modalTask) }}</p>
                                        </div>
                                    </div>
                                </div>
                                </div>

                                <!-- æç¤ºè¯ -->
                                <div class="bg-secondary/30 rounded-xl p-4 mb-6">
                                    <h4 class="text-sm font-medium mb-3 flex items-center">
                                        <i class="fas fa-file-alt text-gradient-icon mr-2"></i>
                                        æç¤ºè¯
                                    </h4>
                                    <div class="bg-dark-light rounded-lg p-4 text-sm text-gray-300">
                                    <p>{{ modalTask?.params?.prompt || 'æ— æç¤ºè¯' }}</p>
                                    </div>
                                </div>

                            <!-- ä¸Šä¼ ç´ æ -->
                            <div v-if="modalTask?.inputs && Object.keys(modalTask.inputs).length" class="bg-secondary/30 rounded-xl p-4 mb-6">
                                    <h4 class="text-sm font-medium mb-3 flex items-center">
                                        <i class="fas fa-upload text-gradient-icon mr-2"></i>
                                        ä¸Šä¼ ç´ æ
                                        <span v-if="loadingTaskFiles" class="ml-2 text-xs text-gray-400">(åŠ è½½ä¸­...)</span>
                                    </h4>
                                    <div class="space-y-3">
                                    <template v-for="(input, key) in modalTask.inputs" :key="key">
                                            <div class="flex items-center gap-3">
                                                <template v-if="key.includes('image')">
                                                    <i class="fas fa-image text-gradient-icon text-xl"></i>
                                                    <div class="flex items-center gap-2">
                                                        <span v-if="!selectedTaskFiles.inputs[key] || !selectedTaskFiles.inputs[key].url"
                                                            class="text-gray-400 text-sm">{{ typeof input === 'string' ? input : 'å›¾ç‰‡' }}</span>
                                                        <div class="flex items-center gap-2 relative group">
                                                            <img v-if="selectedTaskFiles.inputs[key] && selectedTaskFiles.inputs[key].url"
                                                                :src="selectedTaskFiles.inputs[key].url"
                                                                :alt="input"
                                                                class="w-20 h-20 object-cover rounded bg-dark-light border border-gray-700">
                                                            <div v-else-if="selectedTaskFiles.inputs[key] && selectedTaskFiles.inputs[key].error"
                                                                class="w-20 h-20 rounded bg-red-900/20 border border-red-500/30 flex items-center justify-center">
                                                                <i class="fas fa-exclamation-triangle text-red-400"></i>
                                                            </div>
                                                            <div v-else
                                                                class="w-20 h-20 rounded bg-gray-700 border border-gray-600 flex items-center justify-center">
                                                                <i class="fas fa-spinner fa-spin text-gray-400"></i>
                                                            </div>
                                                            <button v-if="selectedTaskFiles.inputs[key] && selectedTaskFiles.inputs[key].url"
                                                                    @click="downloadFile(selectedTaskFiles.inputs[key])"
                                                                    class="text-xs px-2 py-1 rounded">
                                                                <i class="fas fa-download mr-1 text-white opacity-30 hover:opacity-100 transition-opacity"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </template>
                                                <template v-else-if="key.includes('audio')">
                                                    <i class="fas fa-microphone text-gradient-icon text-xl"></i>
                                                    <div class="flex items-center gap-2">
                                                        <span v-if="!selectedTaskFiles.inputs[key] || !selectedTaskFiles.inputs[key].url"
                                                            class="text-gray-400 text-sm">{{ typeof input === 'string' ? input : 'éŸ³é¢‘æ–‡ä»¶' }}</span>
                                                        <div class="flex items-center gap-2">
                                                            <audio v-if="selectedTaskFiles.inputs[key] && selectedTaskFiles.inputs[key].url"
                                                                :src="selectedTaskFiles.inputs[key].url"
                                                                controls
                                                                class="h-8 text-gradient-icon">
                                                                æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
                                                            </audio>
                                                            <div v-else-if="selectedTaskFiles.inputs[key] && selectedTaskFiles.inputs[key].error"
                                                                class="h-8 px-3 rounded bg-red-900/20 border border-red-500/30 flex items-center">
                                                                <i class="fas fa-exclamation-triangle text-red-400 text-xs"></i>
                                                            </div>
                                                            <div v-else
                                                                class="h-8 px-3 rounded bg-gray-700 border border-gray-600 flex items-center">
                                                                <i class="fas fa-spinner fa-spin text-gray-400 text-xs"></i>
                                                            </div>
                                                            <button v-if="selectedTaskFiles.inputs[key] && selectedTaskFiles.inputs[key].url"
                                                                    @click="downloadFile(selectedTaskFiles.inputs[key])"
                                                                    class="text-xs px-2 py-1 rounded">
                                                                <i class="fas fa-download mr-1 text-white opacity-30 hover:opacity-100 transition-opacity"></i>
                                                            </button>
                                                    </div>
                                </div>
                                                </template>
                                    </div>
                                        </template>
                                    </div>
                                </div>

                </div>
            </div>
        </div>
    </div>


    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <script>
        // æ£€æµ‹Font Awesomeå›¾æ ‡æ˜¯å¦åŠ è½½æˆåŠŸ
        function checkFontAwesome() {
            const testIcon = document.createElement('i');
            testIcon.className = 'fas fa-check';
            testIcon.style.position = 'absolute';
            testIcon.style.left = '-9999px';
            document.body.appendChild(testIcon);

            const computedStyle = window.getComputedStyle(testIcon, ':before');
            const content = computedStyle.getPropertyValue('content');

            document.body.removeChild(testIcon);

            // å¦‚æœå›¾æ ‡æ²¡æœ‰æ­£ç¡®æ˜¾ç¤ºï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ
            if (!content || content === 'none' || content === 'normal') {
                console.warn('Font Awesome å›¾æ ‡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ');
                replaceIconsWithFallback();
            }
        }

        // ä½¿ç”¨å¤‡ç”¨å›¾æ ‡æ›¿æ¢å¤±è´¥çš„å›¾æ ‡
        function replaceIconsWithFallback() {
            const iconMap = {
                'fas fa-video': 'ğŸ¥',
                'fas fa-plus': 'â•',
                'fas fa-search': 'ğŸ”',
                'fas fa-clock': 'â°',
                'fas fa-bars': 'â˜°',
                'fas fa-sign-out-alt': 'ğŸšª',
                'fas fa-star': 'â­',
                'fas fa-cloud-upload-alt': 'â˜ï¸',
                'fas fa-microphone': 'ğŸ¤',
                'fas fa-magic': 'âœ¨',
                'fas fa-history': 'ğŸ“š',
                'fas fa-times': 'âœ–ï¸',
                'fas fa-trash': 'ğŸ—‘ï¸',
                'fas fa-sync-alt': 'ğŸ”„',
                'fas fa-play': 'â–¶ï¸',
                'fas fa-share-alt': 'ğŸ“¤',
                'fas fa-download': 'â¬‡ï¸',
                'fas fa-info-circle': 'â„¹ï¸',
                'fas fa-file-alt': 'ğŸ“„',
                'fas fa-file-video': 'ğŸ¬',
                'fas fa-eye': 'ğŸ‘ï¸',
                'fas fa-exclamation-triangle': 'âš ï¸',
                'fas fa-lightbulb': 'ğŸ’¡',
                'fas fa-check': 'âœ…',
                'fas fa-user': 'ğŸ‘¤',
                'fas fa-image': 'ğŸ–¼ï¸',
                'fas fa-font': 'ğŸ”¤',
                'fas fa-spinner': 'ğŸŒ€',
                'fas fa-check-circle': 'âœ…',
                'fas fa-hourglass-half': 'â³',
                'fas fa-ban': 'ğŸš«',
                'fas fa-question-circle': 'â“',
                'fas fa-times-circle': 'âŒ',
                'fas fa-music': 'ğŸµ',
                'fas fa-tags': 'ğŸ·ï¸',
                'fas fa-chart-bar': 'ğŸ“Š',
                'fas fa-redo': 'ğŸ”„',
                'fas fa-pause': 'â¸ï¸'
            };

            // æ›¿æ¢æ‰€æœ‰å›¾æ ‡
            Object.keys(iconMap).forEach(iconClass => {
                const icons = document.querySelectorAll(`.${iconClass.replace(/\s+/g, '.')}`);
                icons.forEach(icon => {
                    icon.innerHTML = iconMap[iconClass];
                    icon.className = icon.className.replace(/fas fa-[a-z-]+/g, '');
                });
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ£€æŸ¥å›¾æ ‡
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkFontAwesome, 1000); // å»¶è¿Ÿ1ç§’æ£€æŸ¥ï¼Œç¡®ä¿CDNåŠ è½½å®Œæˆ
        });
    </script>

    <script>
        const { createApp, ref, computed, onMounted, onUnmounted, watch, nextTick } = Vue;

        createApp({
            setup() {
                // å“åº”å¼æ•°æ®
                const loading = ref(false);
                const loginLoading = ref(false);
                const initLoading = ref(false);
                const downloadLoading = ref(false);
                const alert = ref({ show: false, message: '', type: 'info' });

                // çŸ­ä¿¡ç™»å½•ç›¸å…³æ•°æ®
                const phoneNumber = ref('');
                const verifyCode = ref('');
                const smsCountdown = ref(0);
                const showSmsForm = ref(false);
                const showErrorDetails = ref(false);
                const showFailureDetails = ref(false);
                
                // ä»»åŠ¡çŠ¶æ€è½®è¯¢ç›¸å…³
                const pollingInterval = ref(null);
                const pollingTasks = ref(new Set()); // æ­£åœ¨è½®è¯¢çš„ä»»åŠ¡IDé›†åˆ
                const confirmDialog = ref({
                    show: false,
                    title: '',
                    message: '',
                    confirmText: 'ç¡®è®¤',
                    warning: null,
                    confirm: () => {}
                });
                const submitting = ref(false);
                const searchQuery = ref('');
                const sidebarCollapsed = ref(false);
                const showExpandHint = ref(false);
                const showGlow = ref(false);

                // æ–°å¢ï¼šè§†å›¾åˆ‡æ¢ç›¸å…³çŠ¶æ€
                const currentView = ref('create'); // 'create'ã€'projects' æˆ– 'inspiration'
                const showTaskDetailModal = ref(false);
                const modalTask = ref(null);

                // çµæ„Ÿå¹¿åœºç›¸å…³æ•°æ®
                const inspirationSearchQuery = ref('');
                const selectedInspirationCategory = ref('all');
                const inspirationItems = ref([]);
                const inspirationCategories = ref([
                    { id: 'all', name: 'å…¨éƒ¨' },
                    { id: 'person', name: 'äººç‰©' },
                    { id: 'cartoon', name: 'å¡é€š' },
                    { id: 'anime', name: 'åŠ¨æ¼«' },
                    { id: 'animal', name: 'åŠ¨ç‰©' }
                ]);

                // æ¨¡æ¿è¯¦æƒ…å¼¹çª—ç›¸å…³æ•°æ®
                const showTemplateDetailModal = ref(false);
                const selectedTemplate = ref(null);

                // ä»»åŠ¡æ–‡ä»¶ç¼“å­˜ç³»ç»Ÿ
                const taskFileCache = ref(new Map());
                const taskFileCacheLoaded = ref(false);

                // localStorageç¼“å­˜ç›¸å…³å¸¸é‡
                const TASK_FILE_CACHE_KEY = 'lightx2v_task_files';
                const TASK_FILE_CACHE_EXPIRY = 24 * 60 * 60 * 1000; // 24å°æ—¶è¿‡æœŸ
                const MODELS_CACHE_KEY = 'lightx2v_models';
                const MODELS_CACHE_EXPIRY = 60 * 60 * 1000; // 1å°æ—¶è¿‡æœŸ
                const TEMPLATES_CACHE_KEY = 'lightx2v_templates';
                const TEMPLATES_CACHE_EXPIRY = 30 * 60 * 1000; // 30åˆ†é’Ÿè¿‡æœŸ
                const TASKS_CACHE_KEY = 'lightx2v_tasks';
                const TASKS_CACHE_EXPIRY = 5 * 60 * 1000; // 5åˆ†é’Ÿè¿‡æœŸ

                const imageTemplates = ref([]);
                const audioTemplates = ref([]);
                const showImageTemplates = ref(false);
                const showAudioTemplates = ref(false);
                const mediaModalTab = ref('history');
                const imageHistory = ref([]);
                const audioHistory = ref([]);
                
                // æ¨¡æ¿æ–‡ä»¶ç¼“å­˜ï¼Œé¿å…é‡å¤ä¸‹è½½
                const templateFileCache = ref(new Map());
                const currentUser = ref({});
                const models = ref([]);
                const tasks = ref([]);
                const isLoggedIn = ref(false);

                const selectedTaskId = ref(null);
                const selectedTask = ref(null);
                const selectedTaskFiles = ref({ inputs: {}, outputs: {} }); // å­˜å‚¨ä»»åŠ¡çš„è¾“å…¥è¾“å‡ºæ–‡ä»¶
                const loadingTaskFiles = ref(false); // åŠ è½½ä»»åŠ¡æ–‡ä»¶çš„çŠ¶æ€
                const statusFilter = ref('ALL');
                const pagination = ref(null);
                const currentPage = ref(1);
                const pageSize = ref(10);
                const pageInput = ref(1);
                const paginationKey = ref(0); // ç”¨äºå¼ºåˆ¶åˆ·æ–°åˆ†é¡µç»„ä»¶
                const taskMenuVisible = ref({}); // ç®¡ç†æ¯ä¸ªä»»åŠ¡çš„èœå•æ˜¾ç¤ºçŠ¶æ€
                const nameMap = {
                    't2v': 'æ–‡ç”Ÿè§†é¢‘',
                    'i2v': 'å›¾ç”Ÿè§†é¢‘',
                    's2v': 'æ•°å­—äºº'
                };

                // ä¸ºä¸‰ä¸ªä»»åŠ¡ç±»å‹åˆ†åˆ«åˆ›å»ºç‹¬ç«‹çš„è¡¨å•
                const t2vForm = ref({
                    task: 't2v',
                    model_cls: '',
                    stage: 'single_stage',
                    prompt: '',
                    seed: 42
                });

                const i2vForm = ref({
                    task: 'i2v',
                    model_cls: '',
                    stage: 'multi_stage',
                    imageFile: null,
                    prompt: '',
                    seed: 42
                });

                const s2vForm = ref({
                    task: 's2v',
                    model_cls: '',
                    stage: 'single_stage',
                    imageFile: null,
                    audioFile: null,
                    prompt: '',
                    seed: 42
                });

                // æ ¹æ®å½“å‰é€‰æ‹©çš„ä»»åŠ¡ç±»å‹è·å–å¯¹åº”çš„è¡¨å•
                const getCurrentForm = () => {
                    switch (selectedTaskId.value) {
                        case 't2v':
                            return t2vForm.value;
                        case 'i2v':
                            return i2vForm.value;
                        case 's2v':
                            return s2vForm.value;
                        default:
                            return t2vForm.value;
                    }
                };

                // ä¸ºæ¯ä¸ªä»»åŠ¡ç±»å‹åˆ›å»ºç‹¬ç«‹çš„é¢„è§ˆå˜é‡
                const i2vImagePreview = ref(null);
                const s2vImagePreview = ref(null);
                const s2vAudioPreview = ref(null);

                // æ ¹æ®å½“å‰ä»»åŠ¡ç±»å‹è·å–å¯¹åº”çš„é¢„è§ˆå˜é‡
                const getCurrentImagePreview = () => {
                    switch (selectedTaskId.value) {
                        case 't2v':
                            return null;
                        case 'i2v':
                            return i2vImagePreview.value;
                        case 's2v':
                            return s2vImagePreview.value;
                        default:
                            return null;
                    }
                };

                const getCurrentAudioPreview = () => {
                    switch (selectedTaskId.value) {
                        case 't2v':
                            return null
                        case 'i2v':
                            return null
                        case 's2v':
                            return s2vAudioPreview.value;
                        default:
                            return null;
                    }
                };

                const setCurrentImagePreview = (value) => {
                    switch (selectedTaskId.value) {
                        case 't2v':
                            break;
                        case 'i2v':
                            i2vImagePreview.value = value;
                            break;
                        case 's2v':
                            s2vImagePreview.value = value;
                            break;
                    }
                };

                const setCurrentAudioPreview = (value) => {
                    switch (selectedTaskId.value) {
                        case 't2v':
                            break;
                        case 'i2v':
                            break;
                        case 's2v':
                            s2vAudioPreview.value = value;
                            break;
                    }
                };

                // æç¤ºè¯æ¨¡æ¿ç›¸å…³
                const showTemplates = ref(false);
                const showHistory = ref(false);
                const showPromptModal = ref(false);
                const promptModalTab = ref('templates');

                // è®¡ç®—å±æ€§
                const availableTaskTypes = computed(() => {
                    const types = [...new Set(models.value.map(m => m.task))];
                    // é‡æ–°æ’åºï¼Œç¡®ä¿æ•°å­—äººåœ¨æœ€å·¦è¾¹
                    const orderedTypes = [];

                    // æ£€æŸ¥æ˜¯å¦æœ‰s2væ¨¡å‹ï¼Œå¦‚æœæœ‰åˆ™æ·»åŠ s2vç±»å‹
                    const hasS2vModels = models.value.some(m =>
                        m.task === 's2v'
                    );

                    // ä¼˜å…ˆæ·»åŠ æ•°å­—äººï¼ˆå¦‚æœå­˜åœ¨ç›¸å…³æ¨¡å‹ï¼‰
                    if (hasS2vModels) {
                        orderedTypes.push('s2v');
                    }

                    // ç„¶åæ·»åŠ å…¶ä»–ç±»å‹
                    types.forEach(type => {
                        if (type !== 's2v') {
                            orderedTypes.push(type);
                        }
                    });

                    return orderedTypes;
                });

                const availableModelClasses = computed(() => {
                    if (!selectedTaskId.value) return [];

                    // å…¶ä»–ä»»åŠ¡ç±»å‹æ­£å¸¸å¤„ç†
                    return [...new Set(models.value
                        .filter(m => m.task === selectedTaskId.value)
                        .map(m => m.model_cls))];
                });

                const filteredTasks = computed(() => {
                    let filtered = tasks.value;

                    // çŠ¶æ€è¿‡æ»¤
                    if (statusFilter.value !== 'ALL') {
                        filtered = filtered.filter(task => task.status === statusFilter.value);
                    }

                    // æœç´¢è¿‡æ»¤
                    if (searchQuery.value) {
                        filtered = filtered.filter(task =>
                        task.params.prompt?.toLowerCase().includes(searchQuery.value.toLowerCase()) ||
                        task.task_id.toLowerCase().includes(searchQuery.value.toLowerCase()) ||
                        nameMap[task.task_type].toLowerCase().includes(searchQuery.value.toLowerCase())
                    );
                    }

                    // æŒ‰æ—¶é—´æ’åºï¼Œæœ€æ–°çš„ä»»åŠ¡åœ¨å‰é¢
                    filtered = filtered.sort((a, b) => {
                        const timeA = parseInt(a.create_t) || 0;
                        const timeB = parseInt(b.create_t) || 0;
                        return timeB - timeA; // é™åºæ’åˆ—ï¼Œæœ€æ–°çš„åœ¨å‰
                    });

                    return filtered;
                });

                // ç›‘å¬çŠ¶æ€ç­›é€‰å˜åŒ–ï¼Œé‡ç½®åˆ†é¡µåˆ°ç¬¬ä¸€é¡µ
                watch(statusFilter, (newStatus, oldStatus) => {
                    if (newStatus !== oldStatus) {
                        currentPage.value = 1;
                        pageInput.value = 1;
                        refreshTasks(true); // å¼ºåˆ¶åˆ·æ–°
                    }
                });

                // ç›‘å¬æœç´¢æŸ¥è¯¢å˜åŒ–ï¼Œé‡ç½®åˆ†é¡µåˆ°ç¬¬ä¸€é¡µ
                watch(searchQuery, (newQuery, oldQuery) => {
                    if (newQuery !== oldQuery) {
                        currentPage.value = 1;
                        pageInput.value = 1;
                        refreshTasks(true); // å¼ºåˆ¶åˆ·æ–°
                    }
                });

                // åˆ†é¡µä¿¡æ¯è®¡ç®—å±æ€§ï¼Œç¡®ä¿å“åº”å¼æ›´æ–°
                const paginationInfo = computed(() => {
                    if (!pagination.value) return null;
                    
                    return {
                        total: pagination.value.total || 0,
                        total_pages: pagination.value.total_pages || 0,
                        current_page: pagination.value.current_page || currentPage.value,
                        page_size: pagination.value.page_size || pageSize.value
                    };
                });

                // æ–¹æ³•
                const showAlert = (message, type = 'info') => {
                    alert.value = { show: true, message, type };
                    setTimeout(() => {
                        alert.value.show = false;
                    }, 5000);
                };

                // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
                const showConfirmDialog = (options) => {
                    return new Promise((resolve) => {
                        confirmDialog.value = {
                            show: true,
                            title: options.title || 'ç¡®è®¤æ“ä½œ',
                            message: options.message || 'ç¡®å®šè¦æ‰§è¡Œæ­¤æ“ä½œå—ï¼Ÿ',
                            confirmText: options.confirmText || 'ç¡®è®¤',
                            warning: options.warning || null,
                            confirm: () => {
                                confirmDialog.value.show = false;
                                resolve(true);
                            },
                            cancel: () => {
                                confirmDialog.value.show = false;
                                resolve(false);
                            }
                        };
                    });
                };

                const setLoading = (value) => {
                    loading.value = value;
                };

                const apiCall = async (endpoint, options = {}) => {
                    const url = `${endpoint}`;
                    const headers = {
                        'Content-Type': 'application/json',
                        ...options.headers
                    };

                    if (localStorage.getItem('accessToken')) {
                        headers['Authorization'] = `Bearer ${localStorage.getItem('accessToken')}`;
                    }

                    const response = await fetch(url, {
                        ...options,
                        headers
                    });

                    if (response.status === 401) {
                        logout();
                        throw new Error('è®¤è¯å¤±è´¥ï¼Œè¯·é‡æ–°ç™»å½•'); }
                    if (response.status === 400) {
                        const error = await response.json();
                        showAlert(error.message, 'danger');
                        throw new Error(error.message);
                    }

                    // æ·»åŠ 50mså»¶è¿Ÿï¼Œé˜²æ­¢è§¦å‘æœåŠ¡ç«¯é¢‘ç‡é™åˆ¶
                    await new Promise(resolve => setTimeout(resolve, 50));

                    return response;
                };

                const loginWithGitHub = async () => {
                    try {
                        console.log('starting login')
                        loginLoading.value = true;
                        const response = await fetch('./auth/login/github');
                        const data = await response.json();
                        localStorage.setItem('loginSource', 'github');
                        window.location.href = data.auth_url;
                    } catch (error) {
                        showAlert('è·å–GitHubè®¤è¯URLå¤±è´¥', 'danger');
                    }
                };

                const loginWithGoogle = async () => {
                    try {
                        const response = await fetch('./auth/login/google');
                        const data = await response.json();
                        localStorage.setItem('loginSource', 'google');
                        window.location.href = data.auth_url;
                    } catch (error) {
                        showAlert('è·å–Googleè®¤è¯URLå¤±è´¥', 'danger');
                    }
                };

                // å‘é€çŸ­ä¿¡éªŒè¯ç 
                const sendSmsCode = async () => {
                    if (!phoneNumber.value) {
                        showAlert('è¯·è¾“å…¥æ‰‹æœºå·', 'warning');
                        return;
                    }

                    // ç®€å•çš„æ‰‹æœºå·æ ¼å¼éªŒè¯
                    const phoneRegex = /^1[3-9]\d{9}$/;
                    if (!phoneRegex.test(phoneNumber.value)) {
                        showAlert('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·æ ¼å¼', 'warning');
                        return;
                    }

                    try {
                        loginLoading.value = true;
                        const response = await fetch(`./auth/login/sms?phone_number=${phoneNumber.value}`);
                        const data = await response.json();

                        if (response.ok) {
                            showAlert('éªŒè¯ç å·²å‘é€ï¼Œè¯·æŸ¥æ”¶çŸ­ä¿¡', 'success');
                            // å¼€å§‹å€’è®¡æ—¶
                            startSmsCountdown();
                        } else {
                            showAlert(data.message || 'å‘é€éªŒè¯ç å¤±è´¥', 'danger');
                        }
                    } catch (error) {
                        showAlert('å‘é€éªŒè¯ç å¤±è´¥ï¼Œè¯·é‡è¯•', 'danger');
                    } finally {
                        loginLoading.value = false;
                    }
                };

                // çŸ­ä¿¡éªŒè¯ç ç™»å½•
                const loginWithSms = async () => {
                    if (!phoneNumber.value || !verifyCode.value) {
                        showAlert('è¯·è¾“å…¥æ‰‹æœºå·å’ŒéªŒè¯ç ', 'warning');
                        return;
                    }

                    try {
                        loginLoading.value = true;
                        const response = await fetch(`./auth/callback/sms?phone_number=${phoneNumber.value}&verify_code=${verifyCode.value}`);
                        const data = await response.json();

                        if (response.ok) {
                            localStorage.setItem('accessToken', data.access_token);
                            localStorage.setItem('currentUser', JSON.stringify(data.user_info));
                            currentUser.value = data.user_info;
                            isLoggedIn.value = true;

                            // ç™»å½•æˆåŠŸååˆå§‹åŒ–æ•°æ®
                            await init();

                            showAlert('ç™»å½•æˆåŠŸ', 'success');
                        } else {
                            showAlert(data.message || 'éªŒè¯ç é”™è¯¯æˆ–å·²è¿‡æœŸ', 'danger');
                        }
                    } catch (error) {
                        showAlert('ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•', 'danger');
                    } finally {
                        loginLoading.value = false;
                    }
                };

                // çŸ­ä¿¡éªŒè¯ç å€’è®¡æ—¶
                const startSmsCountdown = () => {
                    smsCountdown.value = 60;
                    const timer = setInterval(() => {
                        smsCountdown.value--;
                        if (smsCountdown.value <= 0) {
                            clearInterval(timer);
                        }
                    }, 1000);
                };

                // åˆ‡æ¢çŸ­ä¿¡ç™»å½•è¡¨å•æ˜¾ç¤º
                const toggleSmsLogin = () => {
                    showSmsForm.value = !showSmsForm.value;
                    if (!showSmsForm.value) {
                        // é‡ç½®è¡¨å•æ•°æ®
                        phoneNumber.value = '';
                        verifyCode.value = '';
                        smsCountdown.value = 0;
                    }
                };

                const handleLoginCallback = async (code, source) => {
                    try {
                        const response = await fetch(`./auth/callback/${source}?code=${code}`);
                        if (response.ok) {
                            const data = await response.json();
                            console.log(data);
                            localStorage.setItem('accessToken', data.access_token);
                            localStorage.setItem('currentUser', JSON.stringify(data.user_info));
                            currentUser.value = data.user_info;
                            isLoggedIn.value = true;
                            
                            // ç™»å½•æˆåŠŸååˆå§‹åŒ–æ•°æ®
                            await init();
                            
                            // æ¸…é™¤URLä¸­çš„codeå‚æ•°
                            window.history.replaceState({}, document.title, window.location.pathname);
                        } else {
                            const error = await response.json();
                            showAlert(`ç™»å½•å¤±è´¥: ${error.detail}`, 'danger');
                        }
                    } catch (error) {
                        showAlert('ç™»å½•è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯', 'danger');
                        console.error(error);
                    }
                };

                const logout = () => {
                    localStorage.removeItem('accessToken');
                    localStorage.removeItem('currentUser');
                    clearAllCache();

                    currentUser.value = {};
                    isLoggedIn.value = false;
                    models.value = [];
                    tasks.value = [];
                    showAlert('å·²é€€å‡ºç™»å½•', 'info');
                };

                const loadModels = async () => {
                    try {
                        // å…ˆå°è¯•ä»ç¼“å­˜åŠ è½½
                        const cachedModels = loadFromCache(MODELS_CACHE_KEY, MODELS_CACHE_EXPIRY);
                        if (cachedModels) {
                            console.log('ä»ç¼“å­˜åŠ è½½æ¨¡å‹åˆ—è¡¨');
                            models.value = cachedModels;
                            return;
                        }

                        console.log('å¼€å§‹åŠ è½½æ¨¡å‹åˆ—è¡¨...');
                        const response = await apiRequest('./api/v1/model/list');
                        if (response && response.ok) {
                            const data = await response.json();
                            console.log('æ¨¡å‹åˆ—è¡¨æ•°æ®:', data);
                            const modelsData = data.models || [];
                            models.value = modelsData;
                            
                            // ä¿å­˜åˆ°ç¼“å­˜
                            saveToCache(MODELS_CACHE_KEY, modelsData);
                            console.log('æ¨¡å‹åˆ—è¡¨å·²ç¼“å­˜');
                        } else if (response) {
                            console.error('æ¨¡å‹åˆ—è¡¨APIå“åº”å¤±è´¥:', response);
                            showAlert('åŠ è½½æ¨¡å‹åˆ—è¡¨å¤±è´¥', 'danger');
                        }
                        // å¦‚æœresponseä¸ºnullï¼Œè¯´æ˜æ˜¯è®¤è¯é”™è¯¯ï¼ŒapiRequestå·²ç»å¤„ç†äº†
                    } catch (error) {
                        console.error('åŠ è½½æ¨¡å‹å¤±è´¥:', error);
                        showAlert(`åŠ è½½æ¨¡å‹å¤±è´¥: ${error.message}`, 'danger');
                    }
                };

                // åŠ è½½æ¨¡æ¿æ–‡ä»¶
                const loadTemplates = async (forceRefresh = false) => {
                    try {
                        // å¦‚æœä¸æ˜¯å¼ºåˆ¶åˆ·æ–°ï¼Œå…ˆå°è¯•ä»ç¼“å­˜åŠ è½½
                        if (!forceRefresh) {
                        const cachedTemplates = loadFromCache(TEMPLATES_CACHE_KEY, TEMPLATES_CACHE_EXPIRY);
                        if (cachedTemplates) {
                            console.log('ä»ç¼“å­˜åŠ è½½æ¨¡æ¿åˆ—è¡¨');
                            imageTemplates.value = cachedTemplates.images || [];
                            audioTemplates.value = cachedTemplates.audios || [];
                                
                                // åå°æ£€æŸ¥æ›´æ–°
                                checkTemplateUpdates();
                            return;
                            }
                        }

                        const response = await apiCall('./api/v1/template/list');
                        if (response.ok) {
                            const data = await response.json();
                            const templatesData = {
                                images: data.templates.images || [],
                                audios: data.templates.audios || []
                            };
                            
                            // æ£€æŸ¥æ˜¯å¦æœ‰æ›´æ–°
                            const hasUpdates = checkTemplateChanges(templatesData);
                            
                            imageTemplates.value = templatesData.images;
                            audioTemplates.value = templatesData.audios;
                            
                            // ä¿å­˜åˆ°ç¼“å­˜
                            saveToCache(TEMPLATES_CACHE_KEY, templatesData);
                            console.log('ç´ æåº“å·²ç¼“å­˜', hasUpdates ? '(æœ‰æ›´æ–°)' : '');
                            
                            if (hasUpdates) {
                                showAlert('ç´ æåº“æœ‰æ›´æ–°', 'info');
                            }
                        } else {
                            console.warn('åŠ è½½ç´ æåº“å¤±è´¥');
                        }
                    } catch (error) {
                        console.warn('åŠ è½½ç´ æåº“å¤±è´¥:', error);
                    }
                };

                // æ£€æŸ¥ç´ æåº“æ›´æ–°
                const checkTemplateUpdates = async () => {
                    try {
                        const response = await apiCall('./api/v1/template/list');
                        if (response.ok) {
                            const data = await response.json();
                            const newTemplatesData = {
                                images: data.templates.images || [],
                                audios: data.templates.audios || []
                            };
                            
                            const hasUpdates = checkTemplateChanges(newTemplatesData);
                            if (hasUpdates) {
                                // æ›´æ–°ç´ ææ•°æ®
                                imageTemplates.value = newTemplatesData.images;
                                audioTemplates.value = newTemplatesData.audios;
                                
                                // æ›´æ–°ç¼“å­˜
                                saveToCache(TEMPLATES_CACHE_KEY, newTemplatesData);
                                showAlert('ç´ æåº“å·²æ›´æ–°', 'info');
                            }
                        }
                    } catch (error) {
                        console.warn('æ£€æŸ¥ç´ æåº“æ›´æ–°å¤±è´¥:', error);
                    }
                };

                // æ£€æŸ¥æ¨¡æ¿å˜åŒ–
                const checkTemplateChanges = (newTemplates) => {
                    const currentImages = imageTemplates.value || [];
                    const currentAudios = audioTemplates.value || [];
                    const newImages = newTemplates.images || [];
                    const newAudios = newTemplates.audios || [];
                    
                    // æ¯”è¾ƒæ•°é‡
                    if (currentImages.length !== newImages.length || currentAudios.length !== newAudios.length) {
                        return true;
                    }
                    
                    // æ¯”è¾ƒå›¾ç‰‡æ¨¡æ¿ID
                    const currentImageIds = currentImages.map(t => t.id).sort();
                    const newImageIds = newImages.map(t => t.id).sort();
                    if (JSON.stringify(currentImageIds) !== JSON.stringify(newImageIds)) {
                        return true;
                    }
                    
                    // æ¯”è¾ƒéŸ³é¢‘æ¨¡æ¿ID
                    const currentAudioIds = currentAudios.map(t => t.id).sort();
                    const newAudioIds = newAudios.map(t => t.id).sort();
                    if (JSON.stringify(currentAudioIds) !== JSON.stringify(newAudioIds)) {
                        return true;
                    }
                    
                    return false;
                };

                // è·å–ç´ ææ–‡ä»¶çš„é€šç”¨å‡½æ•°ï¼ˆå¸¦ç¼“å­˜ï¼‰
                const getTemplateFile = async (template) => {
                    const cacheKey = template.url;
                    
                    // å…ˆæ£€æŸ¥å†…å­˜ç¼“å­˜
                    if (templateFileCache.value.has(cacheKey)) {
                        console.log('ä»å†…å­˜ç¼“å­˜è·å–ç´ ææ–‡ä»¶:', template.filename);
                        return templateFileCache.value.get(cacheKey);
                    }
                    
                    // å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰ï¼Œåˆ™ä¸‹è½½å¹¶ç¼“å­˜
                    console.log('ä¸‹è½½ç´ ææ–‡ä»¶:', template.filename);
                    const response = await fetch(template.url, {
                        cache: 'force-cache' // å¼ºåˆ¶ä½¿ç”¨æµè§ˆå™¨ç¼“å­˜
                    });
                    
                    if (response.ok) {
                        const blob = await response.blob();
                        const file = new File([blob], template.filename, { type: blob.type });
                        
                        // ç¼“å­˜æ–‡ä»¶å¯¹è±¡
                        templateFileCache.value.set(cacheKey, file);
                        return file;
                    } else {
                        throw new Error('ä¸‹è½½ç´ ææ–‡ä»¶å¤±è´¥');
                    }
                };

                // é€‰æ‹©å›¾ç‰‡ç´ æ
                const selectImageTemplate = async (template) => {
                    try {
                        const file = await getTemplateFile(template);

                        if (selectedTaskId.value === 'i2v') {
                            i2vForm.value.imageFile = file;
                        } else if (selectedTaskId.value === 's2v') {
                            s2vForm.value.imageFile = file;
                        }

                        // åˆ›å»ºé¢„è§ˆ
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            setCurrentImagePreview(e.target.result);
                        };
                        reader.readAsDataURL(file);

                        showImageTemplates.value = false;
                        showAlert('å›¾ç‰‡ç´ æå·²é€‰æ‹©', 'success');
                    } catch (error) {
                        showAlert(`åŠ è½½å›¾ç‰‡ç´ æå¤±è´¥: ${error.message}`, 'danger');
                    }
                };

                // é€‰æ‹©éŸ³é¢‘ç´ æ
                const selectAudioTemplate = async (template) => {
                    try {
                        const file = await getTemplateFile(template);

                        s2vForm.value.audioFile = file;

                        // åˆ›å»ºé¢„è§ˆ
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            setCurrentAudioPreview(e.target.result);
                        };
                        reader.readAsDataURL(file);

                        showAudioTemplates.value = false;
                        showAlert('éŸ³é¢‘ç´ æå·²é€‰æ‹©', 'success');
                    } catch (error) {
                        showAlert(`åŠ è½½éŸ³é¢‘ç´ æå¤±è´¥: ${error.message}`, 'danger');
                    }
                };

                // é¢„è§ˆéŸ³é¢‘ç´ æ
                const previewAudioTemplate = (template) => {
                    const audio = new Audio(template.url);
                    audio.play().catch(error => {
                        console.error('éŸ³é¢‘æ’­æ”¾å¤±è´¥:', error);
                        showAlert('éŸ³é¢‘æ’­æ”¾å¤±è´¥', 'danger');
                    });
                };

                const handleImageUpload = (event) => {
                    const file = event.target.files[0];
                    if (file) {
                        if (selectedTaskId.value === 'i2v') {
                            i2vForm.value.imageFile = file;
                        } else if (selectedTaskId.value === 's2v') {
                            s2vForm.value.imageFile = file;
                        }
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            setCurrentImagePreview(e.target.result);
                        };
                        reader.readAsDataURL(file);
                    } else {
                        // ç”¨æˆ·å–æ¶ˆäº†é€‰æ‹©ï¼Œä¿æŒåŸæœ‰å›¾ç‰‡ä¸å˜
                        // ä¸åšä»»ä½•æ“ä½œ
                    }
                };

                const selectTask = (taskType) => {
                    selectedTaskId.value = taskType;

                    // æ ¹æ®ä»»åŠ¡ç±»å‹æ¢å¤å¯¹åº”çš„é¢„è§ˆ
                    if (taskType === 'i2v' && i2vForm.value.imageFile) {
                        // æ¢å¤å›¾ç‰‡é¢„è§ˆ
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            setCurrentImagePreview(e.target.result);
                        };
                        reader.readAsDataURL(i2vForm.value.imageFile);
                    } else if (taskType === 's2v') {
                        // æ¢å¤æ•°å­—äººä»»åŠ¡çš„å›¾ç‰‡å’ŒéŸ³é¢‘é¢„è§ˆ
                        if (s2vForm.value.imageFile) {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                setCurrentImagePreview(e.target.result);
                            };
                            reader.readAsDataURL(s2vForm.value.imageFile);
                        }
                        if (s2vForm.value.audioFile) {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                setCurrentAudioPreview(e.target.result);
                            };
                            reader.readAsDataURL(s2vForm.value.audioFile);
                        }
                    }

                    // å¦‚æœå½“å‰è¡¨å•æ²¡æœ‰é€‰æ‹©æ¨¡å‹ï¼Œè‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ªå¯ç”¨çš„æ¨¡å‹
                    const currentForm = getCurrentForm();
                    if (!currentForm.model_cls) {
                    const availableModels = models.value.filter(m => m.task === taskType);
                    if (availableModels.length > 0) {
                        const firstModel = availableModels[0];
                            currentForm.model_cls = firstModel.model_cls;
                            currentForm.stage = firstModel.stage;
                        }
                    }
                };

                const selectModel = (model) => {
                    getCurrentForm().model_cls = model;
                };

                const triggerImageUpload = () => {
                    document.querySelector('input[type="file"][accept="image/*"]').click();
                };

                const triggerAudioUpload = () => {
                    document.querySelector('input[type="file"][accept="audio/*"]').click();
                };

                const removeImage = () => {
                    setCurrentImagePreview(null);
                    if (selectedTaskId.value === 'i2v') {
                        i2vForm.value.imageFile = null;
                    } else if (selectedTaskId.value === 's2v') {
                        s2vForm.value.imageFile = null;
                    }
                    // é‡ç½®æ–‡ä»¶è¾“å…¥æ¡†ï¼Œç¡®ä¿å¯ä»¥é‡æ–°é€‰æ‹©ç›¸åŒæ–‡ä»¶
                    const imageInput = document.querySelector('input[type="file"][accept="image/*"]');
                    if (imageInput) {
                        imageInput.value = '';
                    }
                };

                const removeAudio = () => {
                    setCurrentAudioPreview(null);
                    s2vForm.value.audioFile = null;
                    console.log('éŸ³é¢‘å·²ç§»é™¤');
                    // é‡ç½®éŸ³é¢‘æ–‡ä»¶è¾“å…¥æ¡†ï¼Œç¡®ä¿å¯ä»¥é‡æ–°é€‰æ‹©ç›¸åŒæ–‡ä»¶
                    const audioInput = document.querySelector('input[type="file"][accept="audio/*"]');
                    if (audioInput) {
                        audioInput.value = '';
                    }
                };

                const getAudioMimeType = () => {
                    if (s2vForm.value.audioFile) {
                        return s2vForm.value.audioFile.type;
                    }
                    return 'audio/mpeg'; // é»˜è®¤ç±»å‹
                };

                const handleAudioUpload = (event) => {
                    const file = event.target.files[0];

                    if (file) {
                        s2vForm.value.audioFile = file;
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            setCurrentAudioPreview(e.target.result);
                            console.log('éŸ³é¢‘é¢„è§ˆå·²è®¾ç½®:', e.target.result);
                        };
                        reader.readAsDataURL(file);
                    } else {
                        setCurrentAudioPreview(null);
                    }
                };

                const submitTask = async () => {
                    try {
                        const currentForm = getCurrentForm();

                        // è¡¨å•éªŒè¯
                        if (!selectedTaskId.value) {
                            showAlert('è¯·é€‰æ‹©ä»»åŠ¡ç±»å‹', 'warning');
                            return;
                        }

                        if (!currentForm.model_cls) {
                            showAlert('è¯·é€‰æ‹©æ¨¡å‹', 'warning');
                            return;
                        }

                        if (!currentForm.prompt || currentForm.prompt.trim().length === 0) {
                            showAlert('è¯·è¾“å…¥æç¤ºè¯', 'warning');
                            return;
                        }

                        if (currentForm.prompt.length > 500) {
                            showAlert('æç¤ºè¯é•¿åº¦ä¸èƒ½è¶…è¿‡500ä¸ªå­—ç¬¦', 'warning');
                            return;
                        }

                        if (selectedTaskId.value === 'i2v' && !currentForm.imageFile) {
                            showAlert('å›¾ç”Ÿè§†é¢‘ä»»åŠ¡éœ€è¦ä¸Šä¼ å‚è€ƒå›¾ç‰‡', 'warning');
                            return;
                        }

                        if (selectedTaskId.value === 's2v' && !currentForm.imageFile) {
                            showAlert('æ•°å­—äººä»»åŠ¡éœ€è¦ä¸Šä¼ å‚è€ƒå›¾ç‰‡', 'warning');
                            return;
                        }

                        if (selectedTaskId.value === 's2v' && !currentForm.audioFile) {
                            showAlert('æ•°å­—äººä»»åŠ¡éœ€è¦ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶', 'warning');
                            return;
                        }
                        submitting.value = true;

                        // ç¡®å®šå®é™…æäº¤çš„ä»»åŠ¡ç±»å‹
                        let actualTaskType = selectedTaskId.value;

                        var formData = {
                            task: actualTaskType,
                            model_cls: currentForm.model_cls,
                            stage: currentForm.stage,
                            prompt: currentForm.prompt.trim(),
                            seed: currentForm.seed || Math.floor(Math.random() * 1000000)
                        };

                        if (currentForm.model_cls.startsWith('wan2.1')) {
                            formData.negative_prompt = "é•œå¤´æ™ƒåŠ¨ï¼Œè‰²è°ƒè‰³ä¸½ï¼Œè¿‡æ›ï¼Œé™æ€ï¼Œç»†èŠ‚æ¨¡ç³Šä¸æ¸…ï¼Œå­—å¹•ï¼Œé£æ ¼ï¼Œä½œå“ï¼Œç”»ä½œï¼Œç”»é¢ï¼Œé™æ­¢ï¼Œæ•´ä½“å‘ç°ï¼Œæœ€å·®è´¨é‡ï¼Œä½è´¨é‡ï¼ŒJPEGå‹ç¼©æ®‹ç•™ï¼Œä¸‘é™‹çš„ï¼Œæ®‹ç¼ºçš„ï¼Œå¤šä½™çš„æ‰‹æŒ‡ï¼Œç”»å¾—ä¸å¥½çš„æ‰‹éƒ¨ï¼Œç”»å¾—ä¸å¥½çš„è„¸éƒ¨ï¼Œç•¸å½¢çš„ï¼Œæ¯å®¹çš„ï¼Œå½¢æ€ç•¸å½¢çš„è‚¢ä½“ï¼Œæ‰‹æŒ‡èåˆï¼Œé™æ­¢ä¸åŠ¨çš„ç”»é¢ï¼Œæ‚ä¹±çš„èƒŒæ™¯ï¼Œä¸‰æ¡è…¿ï¼ŒèƒŒæ™¯äººå¾ˆå¤šï¼Œå€’ç€èµ°"
                        }

                        if (selectedTaskId.value === 'i2v' && currentForm.imageFile) {
                            const base64 = await fileToBase64(currentForm.imageFile);
                            formData.input_image = {
                                type: 'base64',
                                data: base64
                            };
                        }

                        if (selectedTaskId.value === 's2v') {
                            if (currentForm.imageFile) {
                                const base64 = await fileToBase64(currentForm.imageFile);
                                formData.input_image = {
                                    type: 'base64',
                                    data: base64
                                };
                            }
                            if (currentForm.audioFile) {
                                const base64 = await fileToBase64(currentForm.audioFile);
                                formData.input_audio = {
                                    type: 'base64',
                                    data: base64
                                };
                                formData.negative_prompt = "è‰²è°ƒè‰³ä¸½ï¼Œè¿‡æ›ï¼Œé™æ€ï¼Œç»†èŠ‚æ¨¡ç³Šä¸æ¸…ï¼Œå­—å¹•ï¼Œé£æ ¼ï¼Œä½œå“ï¼Œç”»ä½œï¼Œç”»é¢ï¼Œé™æ­¢ï¼Œæ•´ä½“å‘ç°ï¼Œæœ€å·®è´¨é‡ï¼Œä½è´¨é‡ï¼ŒJPEGå‹ç¼©æ®‹ç•™ï¼Œä¸‘é™‹çš„ï¼Œæ®‹ç¼ºçš„ï¼Œå¤šä½™çš„æ‰‹æŒ‡ï¼Œç”»å¾—ä¸å¥½çš„æ‰‹éƒ¨ï¼Œç”»å¾—ä¸å¥½çš„è„¸éƒ¨ï¼Œç•¸å½¢çš„ï¼Œæ¯å®¹çš„ï¼Œå½¢æ€ç•¸å½¢çš„è‚¢ä½“ï¼Œæ‰‹æŒ‡èåˆï¼Œé™æ­¢ä¸åŠ¨çš„ç”»é¢ï¼Œæ‚ä¹±çš„èƒŒæ™¯ï¼Œä¸‰æ¡è…¿ï¼ŒèƒŒæ™¯äººå¾ˆå¤šï¼Œå€’ç€èµ°"
                            }
                        }

                        const response = await apiRequest('./api/v1/task/submit', {
                            method: 'POST',
                            body: JSON.stringify(formData)
                        });

                        if (response && response.ok) {
                            const result = await response.json();
                            showAlert(`ä»»åŠ¡æäº¤æˆåŠŸï¼`, 'success');

                            // ä¿å­˜å®Œæ•´çš„ä»»åŠ¡å†å²ï¼ˆåŒ…æ‹¬æç¤ºè¯ã€å›¾ç‰‡å’ŒéŸ³é¢‘ï¼‰
                            addTaskToHistory(selectedTaskId.value, currentForm);

                            refreshTasks(true); // å¼ºåˆ¶åˆ·æ–°
                            
                            // å¼€å§‹è½®è¯¢æ–°æäº¤çš„ä»»åŠ¡çŠ¶æ€
                            startPollingTask(result.task_id);
                            
                            await resetForm(selectedTaskId.value);
                            // é‡ç½®å½“å‰ä»»åŠ¡ç±»å‹çš„è¡¨å•ï¼ˆä¿ç•™æ¨¡å‹é€‰æ‹©ï¼Œæ¸…ç©ºå›¾ç‰‡ã€éŸ³é¢‘å’Œæç¤ºè¯ï¼‰
                            selectedTaskId.value=selectedTaskId.value;
                            selectModel(currentForm.model_cls);
                            switchToProjectsView();

                        } else {
                            const error = await response.json();
                            showAlert(`ä»»åŠ¡æäº¤å¤±è´¥: ${error.message},${error.detail}`, 'danger');
                        }
                    } catch (error) {
                        showAlert(`æäº¤ä»»åŠ¡å¤±è´¥: ${error.message}`, 'danger');
                    } finally {
                        submitting.value = false;
                    }
                };

                const fileToBase64 = (file) => {
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.readAsDataURL(file);
                        reader.onload = () => {
                            const base64 = reader.result.split(',')[1];
                            resolve(base64);
                        };
                        reader.onerror = error => reject(error);
                    });
                };

                const formatTime = (timestamp) => {
                    if (!timestamp) return '';
                    const date = new Date(timestamp * 1000);
                    return date.toLocaleString('zh-CN');
                };


                // é€šç”¨ç¼“å­˜ç®¡ç†å‡½æ•°
                const loadFromCache = (cacheKey, expiryKey) => {
                    try {
                        const cached = localStorage.getItem(cacheKey);
                        if (cached) {
                            const data = JSON.parse(cached);
                            if (Date.now() - data.timestamp < expiryKey) {
                                return data.data;
                            } else {
                                // ç¼“å­˜è¿‡æœŸï¼Œæ¸…é™¤
                                localStorage.removeItem(cacheKey);
                            }
                        }
                    } catch (error) {
                        console.warn(`åŠ è½½ç¼“å­˜å¤±è´¥ ${cacheKey}:`, error);
                        localStorage.removeItem(cacheKey);
                    }
                    return null;
                };

                const saveToCache = (cacheKey, data) => {
                    try {
                        const cacheData = {
                            data: data,
                            timestamp: Date.now()
                        };
                        localStorage.setItem(cacheKey, JSON.stringify(cacheData));
                    } catch (error) {
                        console.warn(`ä¿å­˜ç¼“å­˜å¤±è´¥ ${cacheKey}:`, error);
                    }
                };

                // æ¸…é™¤æ‰€æœ‰åº”ç”¨ç¼“å­˜
                const clearAllCache = () => {
                    try {
                        const cacheKeys = [
                            TASK_FILE_CACHE_KEY,
                            MODELS_CACHE_KEY,
                            TEMPLATES_CACHE_KEY
                        ];
                        
                        // æ¸…é™¤æ‰€æœ‰ä»»åŠ¡ç¼“å­˜ï¼ˆä½¿ç”¨é€šé…ç¬¦åŒ¹é…ï¼‰
                        for (let i = 0; i < localStorage.length; i++) {
                            const key = localStorage.key(i);
                            if (key && key.startsWith(TASKS_CACHE_KEY)) {
                                localStorage.removeItem(key);
                            }
                        }
                        
                        // æ¸…é™¤å…¶ä»–ç¼“å­˜
                        cacheKeys.forEach(key => {
                            localStorage.removeItem(key);
                        });
                        
                        // æ¸…é™¤å†…å­˜ä¸­çš„ä»»åŠ¡æ–‡ä»¶ç¼“å­˜
                        taskFileCache.value.clear();
                        taskFileCacheLoaded.value = false;
                        
                        console.log('æ‰€æœ‰ç¼“å­˜å·²æ¸…é™¤');
                    } catch (error) {
                        console.warn('æ¸…é™¤ç¼“å­˜å¤±è´¥:', error);
                    }
                };

                // ä»»åŠ¡æ–‡ä»¶ç¼“å­˜ç®¡ç†å‡½æ•°
                const loadTaskFilesFromCache = () => {
                    try {
                        const cached = localStorage.getItem(TASK_FILE_CACHE_KEY);
                        if (cached) {
                            const data = JSON.parse(cached);
                            // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
                            if (Date.now() - data.timestamp < TASK_FILE_CACHE_EXPIRY) {
                                // å°†ç¼“å­˜æ•°æ®åŠ è½½åˆ°å†…å­˜ç¼“å­˜ä¸­
                                for (const [cacheKey, fileData] of Object.entries(data.files)) {
                                    taskFileCache.value.set(cacheKey, fileData);
                                }
                                return true;
                            } else {
                                // ç¼“å­˜è¿‡æœŸï¼Œæ¸…é™¤
                                localStorage.removeItem(TASK_FILE_CACHE_KEY);
                            }
                        }
                    } catch (error) {
                        console.warn('åŠ è½½ä»»åŠ¡æ–‡ä»¶ç¼“å­˜å¤±è´¥:', error);
                        localStorage.removeItem(TASK_FILE_CACHE_KEY);
                    }
                    return false;
                };

                const saveTaskFilesToCache = () => {
                    try {
                        const files = {};
                        for (const [cacheKey, fileData] of taskFileCache.value.entries()) {
                            files[cacheKey] = fileData;
                        }
                        const data = {
                            files,
                            timestamp: Date.now()
                        };
                        localStorage.setItem(TASK_FILE_CACHE_KEY, JSON.stringify(data));
                    } catch (error) {
                        console.warn('ä¿å­˜ä»»åŠ¡æ–‡ä»¶ç¼“å­˜å¤±è´¥:', error);
                    }
                };

                // ç”Ÿæˆç¼“å­˜é”®
                const getTaskFileCacheKey = (taskId, fileKey) => {
                    return `${taskId}_${fileKey}`;
                };

                // ä»ç¼“å­˜è·å–ä»»åŠ¡æ–‡ä»¶
                const getTaskFileFromCache = (taskId, fileKey) => {
                    const cacheKey = getTaskFileCacheKey(taskId, fileKey);
                    return taskFileCache.value.get(cacheKey) || null;
                };

                // è®¾ç½®ä»»åŠ¡æ–‡ä»¶åˆ°ç¼“å­˜
                const setTaskFileToCache = (taskId, fileKey, fileData) => {
                    const cacheKey = getTaskFileCacheKey(taskId, fileKey);
                    taskFileCache.value.set(cacheKey, fileData);
                    // å¼‚æ­¥ä¿å­˜åˆ°localStorage
                    setTimeout(() => {
                        saveTaskFilesToCache();
                    }, 100);
                };

                const getTaskFileUrlFromApi = async (taskId, fileKey) => {
                    let apiUrl = `./api/v1/task/input_url?task_id=${taskId}&name=${fileKey}`;
                    if (fileKey.includes('output')) {
                        apiUrl = `./api/v1/task/result_url?task_id=${taskId}&name=${fileKey}`;
                    }
                    const response = await apiRequest(apiUrl);
                    if (response && response.ok) {
                        const data = await response.json();
                        let assertUrl = data.url;
                        if (assertUrl.startsWith('./assets/')) {
                            const token = localStorage.getItem('accessToken');
                            if (token) {
                                assertUrl = `${assertUrl}&token=${encodeURIComponent(token)}`;
                            }
                        }
                        setTaskFileToCache(taskId, fileKey, {
                            url: assertUrl,
                            timestamp: Date.now()
                        });
                        return assertUrl;
                    }
                    return null;
                };

                // è·å–ä»»åŠ¡æ–‡ä»¶URLï¼ˆä¼˜å…ˆä»ç¼“å­˜ï¼Œç¼“å­˜æ²¡æœ‰åˆ™è°ƒç”¨åç«¯ï¼‰
                const getTaskFileUrl = async (taskId, fileKey) => {
                    // å…ˆä»ç¼“å­˜è·å–
                    const cachedFile = getTaskFileFromCache(taskId, fileKey);
                    if (cachedFile) {
                        return cachedFile.url;
                    }
                    return await getTaskFileUrlFromApi(taskId, fileKey);
                };

                // è·å–ä»»åŠ¡çš„ç¬¬ä¸€ä¸ªå›¾ç‰‡é”®
                const getFirstImageKey = (task) => {
                    if (!task || !task.inputs) return null;
                    
                    const imageInputs = Object.keys(task.inputs).filter(key =>
                        key.includes('image') ||
                        task.inputs[key].toString().toLowerCase().match(/\.(jpg|jpeg|png|gif|bmp|webp)$/)
                    );
                    
                    return imageInputs.length > 0 ? imageInputs[0] : null;
                };

                // åŒæ­¥è·å–ä»»åŠ¡æ–‡ä»¶URLï¼ˆä»…ä»ç¼“å­˜è·å–ï¼Œç”¨äºæ¨¡æ¿æ˜¾ç¤ºï¼‰
                const getTaskFileUrlSync = (taskId, fileKey) => {
                    const cachedFile = getTaskFileFromCache(taskId, fileKey);
                    if (cachedFile) {
                        console.log('getTaskFileUrlSync: ä»ç¼“å­˜è·å–', { taskId, fileKey, url: cachedFile.url, type: typeof cachedFile.url });
                        return cachedFile.url;
                    }
                    console.log('getTaskFileUrlSync: ç¼“å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°', { taskId, fileKey });
                    return null;
                };

                // é¢„åŠ è½½ä»»åŠ¡æ–‡ä»¶
                const preloadTaskFiles = async (tasks) => {
                    if (!tasks || tasks.length === 0) return;

                    // å…ˆå°è¯•ä»localStorageåŠ è½½ç¼“å­˜
                    if (taskFileCache.value.size === 0) {
                        loadTaskFilesFromCache();
                    }

                    console.log(`å¼€å§‹é¢„åŠ è½½ ${tasks.length} ä¸ªä»»åŠ¡çš„æ–‡ä»¶`);

                    // åˆ†æ‰¹é¢„åŠ è½½ï¼Œé¿å…è¿‡å¤šå¹¶å‘è¯·æ±‚
                    const batchSize = 5;
                    for (let i = 0; i < tasks.length; i += batchSize) {
                        const batch = tasks.slice(i, i + batchSize);
                        
                        const promises = batch.map(async (task) => {
                            if (!task.task_id) return;

                            // é¢„åŠ è½½è¾“å…¥å›¾ç‰‡
                            if (task.inputs) {
                                const imageInputs = Object.keys(task.inputs).filter(key =>
                                    key.includes('image') ||
                                    task.inputs[key].toString().toLowerCase().match(/\.(jpg|jpeg|png|gif|bmp|webp)$/)
                                );
                                
                                for (const imageKey of imageInputs) {
                                    await getTaskFileUrl(task.task_id, imageKey);
                                }
                            }

                            // é¢„åŠ è½½è¾“å‡ºè§†é¢‘
                            if (task.outputs && task.outputs.output_video && task.status === 'SUCCEED') {
                                await getTaskFileUrl(task.task_id, 'output_video');
                            }
                        });

                        await Promise.all(promises);
                        
                        // æ‰¹æ¬¡é—´æ·»åŠ å»¶è¿Ÿ
                        if (i + batchSize < tasks.length) {
                            await new Promise(resolve => setTimeout(resolve, 200));
                        }
                    }

                    console.log('ä»»åŠ¡æ–‡ä»¶é¢„åŠ è½½å®Œæˆ');
                };





                const refreshTasks = async (forceRefresh = false) => {
                    try {
                        console.log('å¼€å§‹åˆ·æ–°ä»»åŠ¡åˆ—è¡¨, forceRefresh:', forceRefresh, 'currentPage:', currentPage.value);
                        
                        // æ„å»ºç¼“å­˜é”®ï¼ŒåŒ…å«åˆ†é¡µå’Œè¿‡æ»¤æ¡ä»¶
                        const cacheKey = `${TASKS_CACHE_KEY}_${currentPage.value}_${pageSize.value}_${statusFilter.value}`;
                        
                        // å¦‚æœä¸æ˜¯å¼ºåˆ¶åˆ·æ–°ï¼Œå…ˆå°è¯•ä»ç¼“å­˜åŠ è½½
                        if (!forceRefresh) {
                            const cachedTasks = loadFromCache(cacheKey, TASKS_CACHE_EXPIRY);
                            if (cachedTasks) {
                                console.log('ä»ç¼“å­˜åŠ è½½ä»»åŠ¡åˆ—è¡¨');
                                tasks.value = cachedTasks.tasks || [];
                                pagination.value = cachedTasks.pagination || null;
                                // å¼ºåˆ¶è§¦å‘å“åº”å¼æ›´æ–°
                                await nextTick();
                                // å¼ºåˆ¶åˆ·æ–°åˆ†é¡µç»„ä»¶
                                paginationKey.value++;
                                // ä½¿ç”¨æ–°çš„ä»»åŠ¡æ–‡ä»¶é¢„åŠ è½½é€»è¾‘
                                await preloadTaskFiles(tasks.value);
                                return;
                            }
                        }

                        const params = new URLSearchParams({
                            page: currentPage.value.toString(),
                            page_size: pageSize.value.toString()
                        });

                        if (statusFilter.value !== 'ALL') {
                            params.append('status', statusFilter.value);
                        }

                        console.log('è¯·æ±‚ä»»åŠ¡åˆ—è¡¨API:', `./api/v1/task/list?${params.toString()}`);
                        const response = await apiRequest(`./api/v1/task/list?${params.toString()}`);
                        if (response && response.ok) {
                            const data = await response.json();
                            console.log('ä»»åŠ¡åˆ—è¡¨APIå“åº”:', data);
                            
                            // å¼ºåˆ¶æ¸…ç©ºå¹¶é‡æ–°èµ‹å€¼ï¼Œç¡®ä¿Vueæ£€æµ‹åˆ°å˜åŒ–
                            tasks.value = [];
                            pagination.value = null;
                            await nextTick();
                            
                            tasks.value = data.tasks || [];
                            pagination.value = data.pagination || null;
                            
                            console.log('æ›´æ–°åçš„tasks.value:', tasks.value);
                            console.log('æ›´æ–°åçš„pagination.value:', pagination.value);

                            // ä¿å­˜åˆ°ç¼“å­˜
                            saveToCache(cacheKey, {
                                tasks: data.tasks || [],
                                pagination: data.pagination || null
                            });
                            console.log('ä»»åŠ¡åˆ—è¡¨å·²ç¼“å­˜');

                            // å¼ºåˆ¶è§¦å‘å“åº”å¼æ›´æ–°
                            await nextTick();
                            
                            // å¼ºåˆ¶åˆ·æ–°åˆ†é¡µç»„ä»¶
                            paginationKey.value++;
                            
                            // ä½¿ç”¨æ–°çš„ä»»åŠ¡æ–‡ä»¶é¢„åŠ è½½é€»è¾‘
                            await preloadTaskFiles(tasks.value);
                        } else if (response) {
                            showAlert('åˆ·æ–°ä»»åŠ¡åˆ—è¡¨å¤±è´¥', 'danger');
                        }
                        // å¦‚æœresponseä¸ºnullï¼Œè¯´æ˜æ˜¯è®¤è¯é”™è¯¯ï¼ŒapiRequestå·²ç»å¤„ç†äº†
                    } catch (error) {
                        console.error('åˆ·æ–°ä»»åŠ¡åˆ—è¡¨å¤±è´¥:', error);
                        showAlert(`åˆ·æ–°ä»»åŠ¡åˆ—è¡¨å¤±è´¥: ${error.message}`, 'danger');
                    }
                };

                // åˆ†é¡µç›¸å…³å‡½æ•°
                const goToPage = async (page) => {
                    if (page < 1 || page > pagination.value?.total_pages || page === currentPage.value) {
                        return;
                    }
                    currentPage.value = page;
                    pageInput.value = page; // åŒæ­¥æ›´æ–°è¾“å…¥æ¡†
                    refreshTasks();
                };

                const jumpToPage = async () => {
                    const page = parseInt(pageInput.value);
                    if (page && page >= 1 && page <= pagination.value?.total_pages && page !== currentPage.value) {
                        await goToPage(page);
                    } else {
                        // å¦‚æœè¾“å…¥æ— æ•ˆï¼Œæ¢å¤åˆ°å½“å‰é¡µ
                        pageInput.value = currentPage.value;
                    }
                };

                const getVisiblePages = () => {
                    if (!pagination.value) return [];
                    
                    const totalPages = pagination.value.total_pages;
                    const current = currentPage.value;
                    const pages = [];
                    
                    // æ€»æ˜¯æ˜¾ç¤ºç¬¬ä¸€é¡µ
                    pages.push(1);
                    
                    if (totalPages <= 5) {
                        // å¦‚æœæ€»é¡µæ•°å°‘äºç­‰äº7é¡µï¼Œæ˜¾ç¤ºæ‰€æœ‰é¡µç 
                        for (let i = 2; i <= totalPages - 1; i++) {
                            pages.push(i);
                        }
                    } else {
                        // å¦‚æœæ€»é¡µæ•°å¤§äº7é¡µï¼Œä½¿ç”¨çœç•¥å·
                        if (current <= 3) {
                            // å½“å‰é¡µåœ¨å‰4é¡µ
                            for (let i = 2; i <= 3; i++) {
                                pages.push(i);
                            }
                            pages.push('...');
                        } else if (current >= totalPages - 2) {
                            // å½“å‰é¡µåœ¨å4é¡µ
                            pages.push('...');
                            for (let i = totalPages - 2; i <= totalPages - 1; i++) {
                                pages.push(i);
                            }
                        } else {
                            // å½“å‰é¡µåœ¨ä¸­é—´
                            pages.push('...');
                            for (let i = current - 1; i <= current + 1; i++) {
                                pages.push(i);
                            }
                            pages.push('...');
                        }
                    }
                    
                    // æ€»æ˜¯æ˜¾ç¤ºæœ€åä¸€é¡µï¼ˆå¦‚æœä¸æ˜¯ç¬¬ä¸€é¡µï¼‰
                    if (totalPages > 1) {
                        pages.push(totalPages);
                    }
                    
                    return pages;
                };

                const getStatusBadgeClass = (status) => {
                    const statusMap = {
                        'SUCCEED': 'bg-success',
                        'FAILED': 'bg-danger',
                        'RUNNING': 'bg-warning',
                        'PENDING': 'bg-secondary',
                        'CREATED': 'bg-secondary'
                    };
                    return statusMap[status] || 'bg-secondary';
                };

                const downloadSingleResult = async (taskId, key, outputPath) => {
                    try {
                        downloadLoading.value = true;

                        const url = await getTaskFileUrl(taskId, key);
                        if (url) {
                            const response = await fetch(url);
                            if (response.ok) {
                                const blob = await response.blob();
                                const url = window.URL.createObjectURL(blob);
                                const a = document.createElement('a');
                                a.href = url;
                                // ä½¿ç”¨åŸå§‹æ–‡ä»¶åï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨outputPath
                                const filename = key || outputPath || `result_${taskId}`;
                                a.download = filename;
                                document.body.appendChild(a);
                                a.click();
                                document.body.removeChild(a);
                                window.URL.revokeObjectURL(url);
                                showAlert('æ–‡ä»¶ä¸‹è½½æˆåŠŸ', 'success');
                            } else {
                                showAlert('è·å–ç»“æœå¤±è´¥', 'danger');
                            }
                        } else {
                            showAlert('è·å–ç»“æœå¤±è´¥', 'danger');
                        }
                    } catch (error) {
                        showAlert(`ä¸‹è½½ç»“æœå¤±è´¥: ${error.message}`, 'danger');
                    } finally {
                        downloadLoading.value = false;
                    }
                };

                const viewSingleResult = async (taskId, key) => {
                    try {
                        downloadLoading.value = true;
                        const url = await getTaskFileUrl(taskId, key);
                        if (url) {
                            const response = await fetch(url);
                            if (response.ok) {
                                const blob = await response.blob();
                                const videoBlob = new Blob([blob], { type: 'video/mp4' });
                                const url = window.URL.createObjectURL(videoBlob);
                                window.open(url, '_blank');
                            } else {
                                showAlert('è·å–ç»“æœå¤±è´¥', 'danger');
                            }
                        } else {
                            showAlert('è·å–ç»“æœå¤±è´¥', 'danger');
                        }
                    } catch (error) {
                        showAlert(`æŸ¥çœ‹ç»“æœå¤±è´¥: ${error.message}`, 'danger');
                    } finally {
                        downloadLoading.value = false;
                    }
                };

                const getVideoUrl = (taskId, key) => {
                    // ä¼˜å…ˆä»ç¼“å­˜è·å–
                    const cachedUrl = getTaskFileUrlSync(taskId, key);
                    if (cachedUrl) {
                        console.log('getVideoUrl: ä»ç¼“å­˜è·å–', { taskId, key, url: cachedUrl });
                        return cachedUrl;
                    }
                    // ç¼“å­˜æ²¡æœ‰åˆ™ç”ŸæˆURLå¹¶ç¼“å­˜
                    const token = localStorage.getItem('accessToken');
                    const url = token 
                        ? `./assets/task/result?task_id=${taskId}&name=${key}&token=${encodeURIComponent(token)}`
                        : `./assets/task/result?task_id=${taskId}&name=${key}`;
                    
                    // ç¼“å­˜API URL
                    setTaskFileToCache(taskId, key, {
                        url: url,
                        timestamp: Date.now()
                    });
                    
                    console.log('getVideoUrl: ç”Ÿæˆå¹¶ç¼“å­˜è§†é¢‘URL', { taskId, key, url });
                    return url;
                };

                const cancelTask = async (taskId, fromDetailPage = false) => {
                    try {
                        // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
                        const confirmed = await showConfirmDialog({
                            title: 'å–æ¶ˆä»»åŠ¡ï¼Ÿ',
                            message: 'å–æ¶ˆä»»åŠ¡åä»»åŠ¡å°†åœæ­¢æ‰§è¡Œï¼Œå·²ç”Ÿæˆçš„éƒ¨åˆ†ç»“æœå¯èƒ½ä¸¢å¤±ï¼Œå¯ä»¥ç¨åé‡æ–°ç”Ÿæˆã€‚',
                            confirmText: 'å–æ¶ˆ',
                        });
                        
                        if (!confirmed) {
                            return;
                        }

                        const response = await apiRequest(`./api/v1/task/cancel?task_id=${taskId}`);
                        if (response && response.ok) {
                            showAlert('ä»»åŠ¡å–æ¶ˆæˆåŠŸ', 'success');
                            
                            // å¦‚æœå½“å‰åœ¨ä»»åŠ¡è¯¦æƒ…ç•Œé¢ï¼Œå…ˆåˆ·æ–°ä»»åŠ¡åˆ—è¡¨ï¼Œç„¶åé‡æ–°è·å–ä»»åŠ¡ä¿¡æ¯
                            if (fromDetailPage) {
                                refreshTasks(true); // å¼ºåˆ¶åˆ·æ–°
                                const updatedTask = tasks.value.find(t => t.task_id === taskId);
                                if (updatedTask) {
                                    selectedTask.value = updatedTask;
                                }
                                await nextTick();
                            } else {
                                refreshTasks(true); // å¼ºåˆ¶åˆ·æ–°
                            }
                                
                        } else if (response) {
                            const error = await response.json();
                            showAlert(`å–æ¶ˆä»»åŠ¡å¤±è´¥: ${error.message}`, 'danger');
                        }
                        // å¦‚æœresponseä¸ºnullï¼Œè¯´æ˜æ˜¯è®¤è¯é”™è¯¯ï¼ŒapiRequestå·²ç»å¤„ç†äº†
                    } catch (error) {
                        showAlert(`å–æ¶ˆä»»åŠ¡å¤±è´¥: ${error.message}`, 'danger');
                    }
                };

                const resumeTask = async (taskId, fromDetailPage = false) => {
                    try {
                        const response = await apiRequest(`./api/v1/task/resume?task_id=${taskId}`);
                        if (response && response.ok) {
                            showAlert('ä»»åŠ¡é‡è¯•æˆåŠŸ', 'success');
                            
                            // å¦‚æœå½“å‰åœ¨ä»»åŠ¡è¯¦æƒ…ç•Œé¢ï¼Œå…ˆåˆ·æ–°ä»»åŠ¡åˆ—è¡¨ï¼Œç„¶åé‡æ–°è·å–ä»»åŠ¡ä¿¡æ¯
                            if (fromDetailPage) {
                                refreshTasks(true); // å¼ºåˆ¶åˆ·æ–°
                                const updatedTask = tasks.value.find(t => t.task_id === taskId);
                                if (updatedTask) {
                                    selectedTask.value = updatedTask;
                                }
                                startPollingTask(taskId);
                                await nextTick();
                            } else {
                                refreshTasks(true); // å¼ºåˆ¶åˆ·æ–°
                                
                                // å¼€å§‹è½®è¯¢æ–°æäº¤çš„ä»»åŠ¡çŠ¶æ€
                                startPollingTask(taskId);
                            }
                        } else if (response) {
                            const error = await response.json();
                            showAlert(`é‡è¯•ä»»åŠ¡å¤±è´¥: ${error.message}`, 'danger');
                        }
                        // å¦‚æœresponseä¸ºnullï¼Œè¯´æ˜æ˜¯è®¤è¯é”™è¯¯ï¼ŒapiRequestå·²ç»å¤„ç†äº†
                    } catch (error) {
                        showAlert(`é‡è¯•ä»»åŠ¡å¤±è´¥: ${error.message}`, 'danger');
                    }
                };

                // åˆ‡æ¢ä»»åŠ¡èœå•æ˜¾ç¤ºçŠ¶æ€
                const toggleTaskMenu = (taskId) => {
                    // å…ˆå…³é—­æ‰€æœ‰å…¶ä»–èœå•
                    closeAllTaskMenus();
                    // ç„¶åæ‰“å¼€å½“å‰èœå•
                    taskMenuVisible.value[taskId] = true;
                };

                // å…³é—­æ‰€æœ‰ä»»åŠ¡èœå•
                const closeAllTaskMenus = () => {
                    taskMenuVisible.value = {};
                };

                // ç‚¹å‡»å¤–éƒ¨å…³é—­èœå•
                const handleClickOutside = (event) => {
                    if (!event.target.closest('.task-menu-container')) {
                        closeAllTaskMenus();
                    }
                };

                const deleteTask = async (taskId, fromDetailPage = false) => {
                    try {
                        // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
                        const confirmed = await showConfirmDialog({
                            title: 'åˆ é™¤ä»»åŠ¡ï¼Ÿ',
                            message: 'åˆ é™¤åæ— æ³•æ¢å¤ï¼ŒåŒ…æ‹¬ä»»åŠ¡è®°å½•ã€ç”Ÿæˆçš„æ–‡ä»¶ã€ç›¸å…³æ•°æ®ã€‚æ­¤æ“ä½œä¸å¯æ’¤é”€ï¼',
                            confirmText: 'åˆ é™¤'
                        });
                        
                        if (!confirmed) {
                            return;
                        }

                        // æ˜¾ç¤ºåˆ é™¤ä¸­çš„æç¤º
                        showAlert('æ­£åœ¨åˆ é™¤ä»»åŠ¡...', 'info');

                        const response = await apiRequest(`./api/v1/task/delete?task_id=${taskId}`, {
                            method: 'DELETE'
                        });
                        
                        if (response && response.ok) {
                            showAlert('ä»»åŠ¡åˆ é™¤æˆåŠŸ', 'success');
                            refreshTasks(true); // å¼ºåˆ¶åˆ·æ–°
                            
                            // å¦‚æœæ˜¯ä»ä»»åŠ¡è¯¦æƒ…é¡µåˆ é™¤ï¼Œåˆ™è·³è½¬å›ä¸»é¡µ
                            if (fromDetailPage) {
                                if (!selectedTaskId.value) {
                                    if (availableTaskTypes.value.includes('s2v')) {
                                        selectTask('s2v');
                                    }
                                }
                            }
                        } else if (response) {
                            const error = await response.json();
                            showAlert(`åˆ é™¤ä»»åŠ¡å¤±è´¥: ${error.message}`, 'danger');
                        }
                        // å¦‚æœresponseä¸ºnullï¼Œè¯´æ˜æ˜¯è®¤è¯é”™è¯¯ï¼ŒapiRequestå·²ç»å¤„ç†äº†
                    } catch (error) {
                        showAlert(`åˆ é™¤ä»»åŠ¡å¤±è´¥: ${error.message}`, 'danger');
                    }
                };



                const loadTaskFiles = async (taskId) => {
                    try {
                        loadingTaskFiles.value = true;

                        // é€šè¿‡APIè·å–ä»»åŠ¡è¯¦æƒ…
                        const response = await apiRequest(`./api/v1/task/query?task_id=${taskId}`);
                        if (!response || !response.ok) {
                            showAlert('è·å–ä»»åŠ¡è¯¦æƒ…å¤±è´¥', 'danger');
                            return;
                        }

                        const task = await response.json();
                        if (!task) {
                            showAlert('ä»»åŠ¡ä¸å­˜åœ¨', 'danger');
                            return;
                        }

                        const files = { inputs: {}, outputs: {} };

                        // è·å–è¾“å…¥æ–‡ä»¶ï¼ˆæ‰€æœ‰çŠ¶æ€çš„ä»»åŠ¡éƒ½éœ€è¦ï¼‰
                        if (task.inputs) {
                            for (const [key, inputPath] of Object.entries(task.inputs)) {
                                try {
                                    const url = await getTaskFileUrl(taskId, key);
                                    if (url) {
                                        const response = await fetch(url);
                                        if (response && response.ok) {
                                            const blob = await response.blob()
                                            files.inputs[key] = {
                                                name: inputPath, // ä½¿ç”¨åŸå§‹æ–‡ä»¶åè€Œä¸æ˜¯key
                                                path: inputPath,
                                                blob: blob,
                                                url: URL.createObjectURL(blob)
                                            }
                                        }
                                    }
                                } catch (error) {
                                    console.error(`Failed to load input ${key}:`, error);
                                    files.inputs[key] = {
                                        name: inputPath, // ä½¿ç”¨åŸå§‹æ–‡ä»¶åè€Œä¸æ˜¯key
                                        path: inputPath,
                                        error: true
                                    };
                                }
                            }
                        }

                        // åªå¯¹æˆåŠŸå®Œæˆçš„ä»»åŠ¡è·å–è¾“å‡ºæ–‡ä»¶
                        if (task.status === 'SUCCEED' && task.outputs) {
                            for (const [key, outputPath] of Object.entries(task.outputs)) {
                                try {
                                    const url = await getTaskFileUrl(taskId, key);
                                    if (url) {
                                        const response = await fetch(url);
                                        if (response && response.ok) {
                                            const blob = await response.blob()
                                            files.outputs[key] = {
                                                name: outputPath, // ä½¿ç”¨åŸå§‹æ–‡ä»¶åè€Œä¸æ˜¯key
                                                path: outputPath,
                                                blob: blob,
                                                url: URL.createObjectURL(blob)
                                            }
                                        };
                                    }
                                } catch (error) {
                                    console.error(`Failed to load output ${key}:`, error);
                                    files.outputs[key] = {
                                        name: outputPath, // ä½¿ç”¨åŸå§‹æ–‡ä»¶åè€Œä¸æ˜¯key
                                        path: outputPath,
                                        error: true
                                    };
                                }
                            }
                        }

                        selectedTaskFiles.value = files;

                    } catch (error) {
                        console.error('Failed to load task files:', error);
                        showAlert('åŠ è½½ä»»åŠ¡æ–‡ä»¶å¤±è´¥', 'danger');
                    } finally {
                        loadingTaskFiles.value = false;
                    }
                };

                const viewTaskDetail = async (task) => {
                    selectedTask.value = task;
                    selectedTaskId.value = task.task_type;

                    try {
                    const response = await apiRequest(`./api/v1/task/query?task_id=${task.task_id}`);
                        if (response && response.ok) {
                            const updatedTask = await response.json();
                            selectedTask.value = updatedTask;
                            console.log('updated task data:', updatedTask);
                            await nextTick();
                        }
                    } catch (error) {
                        console.warn('Failed to fetch updated task data:', error);
                    }
                    // å¦‚æœä»»åŠ¡è¿˜åœ¨è¿›è¡Œä¸­ï¼Œå¼€å§‹è½®è¯¢çŠ¶æ€
                    if (['CREATED', 'PENDING', 'RUNNING'].includes(task.status)) {

                        startPollingTask(task.task_id);
                    }

                    // ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰ä»»åŠ¡æ–‡ä»¶
                    await loadTaskFiles(task.task_id);
                };

                const reuseTask = async (task) => {
                    try {
                        // è·³è½¬åˆ°ä»»åŠ¡åˆ›å»ºç•Œé¢
                        switchToCreateView();
                        
                        // è®¾ç½®ä»»åŠ¡ç±»å‹
                        selectedTaskId.value = task.task_type;
                        console.log('selectedTaskId.value', selectedTaskId.value);
                        
                        // è·å–å½“å‰è¡¨å•
                        const currentForm = getCurrentForm();
                        
                        // è®¾ç½®æ¨¡å‹
                        if (task.params && task.params.model_cls) {
                            currentForm.model_cls = task.params.model_cls;
                        }
                        
                        // è®¾ç½®prompt
                        if (task.params && task.params.prompt) {
                            currentForm.prompt = task.params.prompt;
                        }
                        
                        // å°è¯•ä»localStorageè·å–ä»»åŠ¡å†å²æ•°æ®
                        const taskHistory = JSON.parse(localStorage.getItem('taskHistory') || '[]');
                        const historyItem = taskHistory.find(item => item.task_id === task.task_id);
                        
                        if (historyItem) {
                            // ä»localStorageæ¢å¤å›¾ç‰‡å’ŒéŸ³é¢‘
                            if (historyItem.imageFile && historyItem.imageFile.blob) {
                                // é‡æ–°åˆ›å»ºFileå¯¹è±¡
                                const imageFile = new File([historyItem.imageFile.blob], historyItem.imageFile.name, { type: historyItem.imageFile.type });
                                currentForm.imageFile = imageFile;
                                setCurrentImagePreview(URL.createObjectURL(imageFile));
                            }
                            
                            if (historyItem.audioFile && historyItem.audioFile.blob) {
                                // é‡æ–°åˆ›å»ºFileå¯¹è±¡
                                let mimeType = historyItem.audioFile.type;
                                if (!mimeType || mimeType === 'application/octet-stream') {
                                    const filename = historyItem.audioFile.name || 'audio.wav';
                                    const ext = filename.toLowerCase().split('.').pop();
                                    const mimeTypes = {
                                        'mp3': 'audio/mpeg',
                                        'wav': 'audio/wav',
                                        'mp4': 'audio/mp4',
                                        'aac': 'audio/aac',
                                        'ogg': 'audio/ogg',
                                        'm4a': 'audio/mp4'
                                    };
                                    mimeType = mimeTypes[ext] || 'audio/mpeg';
                                }
                                const audioFile = new File([historyItem.audioFile.blob], historyItem.audioFile.name, { type: mimeType });
                                currentForm.audioFile = audioFile;
                                console.log('å¤ç”¨ä»»åŠ¡ - ä»localStorageæ¢å¤éŸ³é¢‘æ–‡ä»¶:', {
                                    name: audioFile.name,
                                    type: audioFile.type,
                                    size: audioFile.size
                                });
                                // ä½¿ç”¨FileReaderç”Ÿæˆdata URLï¼Œä¸æ­£å¸¸ä¸Šä¼ ä¿æŒä¸€è‡´
                                const reader = new FileReader();
                                reader.onload = (e) => {
                                    setCurrentAudioPreview(e.target.result);
                                    console.log('å¤ç”¨ä»»åŠ¡ - éŸ³é¢‘é¢„è§ˆå·²è®¾ç½®:', e.target.result.substring(0, 50) + '...');
                                };
                                reader.readAsDataURL(audioFile);
                            }
                        } else {
                            // å¦‚æœlocalStorageä¸­æ²¡æœ‰ï¼Œå°è¯•ä»åç«¯è·å–ä»»åŠ¡æ–‡ä»¶
                            try {
                                // ä½¿ç”¨ç°æœ‰çš„å‡½æ•°è·å–å›¾ç‰‡å’ŒéŸ³é¢‘URL
                                const imageUrl = getTaskInputImage(task);
                                const audioUrl = getTaskInputAudio(task);
                                
                                // åŠ è½½å›¾ç‰‡æ–‡ä»¶
                                if (imageUrl) {
                                    try {
                                        const imageResponse = await fetch(imageUrl);
                                        if (imageResponse && imageResponse.ok) {
                                            const blob = await imageResponse.blob();
                                            const filename = task.inputs[Object.keys(task.inputs).find(key => 
                                                key.includes('image') || 
                                                task.inputs[key].toString().toLowerCase().match(/\.(jpg|jpeg|png|gif|bmp|webp)$/)
                                            )] || 'image.jpg';
                                            const file = new File([blob], filename, { type: blob.type });
                                            currentForm.imageFile = file;
                                            setCurrentImagePreview(URL.createObjectURL(file));
                                        }
                                    } catch (error) {
                                        console.warn('Failed to load image file:', error);
                                    }
                                }
                                
                                // åŠ è½½éŸ³é¢‘æ–‡ä»¶
                                if (audioUrl) {
                                    try {
                                        const audioResponse = await fetch(audioUrl);
                                        if (audioResponse && audioResponse.ok) {
                                            const blob = await audioResponse.blob();
                                            const filename = task.inputs[Object.keys(task.inputs).find(key => 
                                                key.includes('audio') || 
                                                task.inputs[key].toString().toLowerCase().match(/\.(mp3|wav|mp4|aac|ogg|m4a)$/)
                                            )] || 'audio.wav';
                                            
                                            // æ ¹æ®æ–‡ä»¶æ‰©å±•åç¡®å®šæ­£ç¡®çš„MIMEç±»å‹
                                            let mimeType = blob.type;
                                            if (!mimeType || mimeType === 'application/octet-stream') {
                                                const ext = filename.toLowerCase().split('.').pop();
                                                const mimeTypes = {
                                                    'mp3': 'audio/mpeg',
                                                    'wav': 'audio/wav',
                                                    'mp4': 'audio/mp4',
                                                    'aac': 'audio/aac',
                                                    'ogg': 'audio/ogg',
                                                    'm4a': 'audio/mp4'
                                                };
                                                mimeType = mimeTypes[ext] || 'audio/mpeg';
                                            }
                                            
                                            const file = new File([blob], filename, { type: mimeType });
                                            currentForm.audioFile = file;
                                            console.log('å¤ç”¨ä»»åŠ¡ - ä»åç«¯åŠ è½½éŸ³é¢‘æ–‡ä»¶:', {
                                                name: file.name,
                                                type: file.type,
                                                size: file.size,
                                                originalBlobType: blob.type
                                            });
                                            // ä½¿ç”¨FileReaderç”Ÿæˆdata URLï¼Œä¸æ­£å¸¸ä¸Šä¼ ä¿æŒä¸€è‡´
                                            const reader = new FileReader();
                                            reader.onload = (e) => {
                                                setCurrentAudioPreview(e.target.result);
                                                console.log('å¤ç”¨ä»»åŠ¡ - éŸ³é¢‘é¢„è§ˆå·²è®¾ç½®:', e.target.result.substring(0, 50) + '...');
                                            };
                                            reader.readAsDataURL(file);
                                        }
                                    } catch (error) {
                                        console.warn('Failed to load audio file:', error);
                                    }
                                }
                            } catch (error) {
                                console.warn('Failed to load task data from backend:', error);
                            }
                        }
                        
                        showAlert('ä»»åŠ¡ç´ æå¤ç”¨æˆåŠŸ', 'success');
                        
                    } catch (error) {
                        console.error('Failed to reuse task:', error);
                        showAlert('åŠ è½½ä»»åŠ¡æ•°æ®å¤±è´¥', 'danger');
                    }
                };

                const downloadFile = (fileInfo) => {
                    if (!fileInfo || !fileInfo.blob) {
                        showAlert('æ–‡ä»¶ä¸å¯ç”¨', 'danger');
                        return;
                    }

                    try {
                        const url = URL.createObjectURL(fileInfo.blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = fileInfo.name || 'download';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                    } catch (error) {
                        console.error('Download failed:', error);
                        showAlert('ä¸‹è½½å¤±è´¥', 'danger');
                    }
                };

                const viewFile = (fileInfo) => {
                    if (!fileInfo || !fileInfo.url) {
                        showAlert('æ–‡ä»¶ä¸å¯ç”¨', 'danger');
                        return;
                    }

                    // åœ¨æ–°çª—å£ä¸­æ‰“å¼€æ–‡ä»¶
                    window.open(fileInfo.url, '_blank');
                };

                const clearTaskFiles = () => {
                    // æ¸…ç† URL å¯¹è±¡ï¼Œé‡Šæ”¾å†…å­˜
                    Object.values(selectedTaskFiles.value.inputs).forEach(file => {
                        if (file.url) {
                            URL.revokeObjectURL(file.url);
                        }
                    });
                    Object.values(selectedTaskFiles.value.outputs).forEach(file => {
                        if (file.url) {
                            URL.revokeObjectURL(file.url);
                        }
                    });
                    selectedTaskFiles.value = { inputs: {}, outputs: {} };
                };

                const showTaskCreator = () => {
                    selectedTask.value = null;
                    // clearTaskFiles(); // æ¸…ç©ºæ–‡ä»¶ç¼“å­˜
                    selectedTaskId.value = 's2v'; // é»˜è®¤é€‰æ‹©æ•°å­—äººä»»åŠ¡
                    
                    // åœæ­¢æ‰€æœ‰ä»»åŠ¡çŠ¶æ€è½®è¯¢
                    pollingTasks.value.clear();
                    if (pollingInterval.value) {
                        clearInterval(pollingInterval.value);
                        pollingInterval.value = null;
                    }
                };

                const toggleSidebar = () => {
                    sidebarCollapsed.value = !sidebarCollapsed.value;
                    
                    if (sidebarCollapsed.value) {
                        // æ”¶èµ·æ—¶ï¼Œå°†å†å²ä»»åŠ¡æ éšè—åˆ°å±å¹•å·¦ä¾§
                        if (sidebar.value) {
                            sidebar.value.style.transform = 'translateX(-100%)';
                        }
                    } else {
                        // å±•å¼€æ—¶ï¼Œæ¢å¤å†å²ä»»åŠ¡æ ä½ç½®
                        if (sidebar.value) {
                            sidebar.value.style.transform = 'translateX(0)';
                        }
                    }
                    
                    // æ›´æ–°æ‚¬æµ®æŒ‰é’®ä½ç½®
                    updateFloatingButtonPosition(sidebarWidth.value);
                };

                const clearPrompt = () => {
                    getCurrentForm().prompt = '';
                };

                const getTaskItemClass = (status) => {
                    if (status === 'SUCCEED') return 'bg-laser-purple/15 border border-laser-purple/30';
                    if (status === 'RUNNING') return 'bg-laser-purple/15 border border-laser-purple/30';
                    if (status === 'FAILED') return 'bg-red-500/15 border border-red-500/30';
                    return 'bg-dark-light border border-gray-700';
                };

                const getStatusIndicatorClass = (status) => {
                const base = 'inline-block w-2 aspect-square rounded-full shrink-0 align-middle';
                    if (status === 'SUCCEED')
                        return `${base} bg-gradient-to-r from-emerald-200 to-green-300 shadow-md shadow-emerald-300/30`;
                    if (status === 'RUNNING')
                        return `${base} bg-gradient-to-r from-amber-200 to-yellow-300 shadow-md shadow-amber-300/30 animate-pulse`;
                    if (status === 'FAILED')
                        return `${base} bg-gradient-to-r from-red-200 to-pink-300 shadow-md shadow-red-300/30`;
                    return `${base} bg-gradient-to-r from-gray-200 to-gray-300 shadow-md shadow-gray-300/30`;
                    };


                const getTaskTypeBtnClass = (taskType) => {
                    if (selectedTaskId.value === taskType) {
                        return 'text-gradient-icon border-b-2 border-laser-purple';
                    }
                    return 'text-gray-400 hover:text-gradient-icon';
                };

                const getModelBtnClass = (model) => {
                    if (getCurrentForm().model_cls === model) {
                        return 'bg-laser-purple/20 border border-laser-purple/40 active shadow-laser animate-electric-pulse';
                    }
                    return 'bg-dark-light border border-gray-700 hover:bg-laser-purple/15 hover:border-laser-purple/40 transition-all hover:shadow-laser';
                };

                const getTaskTypeIcon = (taskType) => {
                    const iconMap = {
                        't2v': 'fas fa-font',
                        'i2v': 'fas fa-image',
                        's2v': 'fas fa-user'
                    };
                    return iconMap[taskType] || 'fas fa-video';
                };

                const getTaskTypeName = (task) => {
                    // å¦‚æœä¼ å…¥çš„æ˜¯å­—ç¬¦ä¸²ï¼Œç›´æ¥è¿”å›æ˜ å°„
                    if (typeof task === 'string') {
                        return nameMap[task] || task;
                    }

                    // å¦‚æœä¼ å…¥çš„æ˜¯ä»»åŠ¡å¯¹è±¡ï¼Œæ ¹æ®æ¨¡å‹ç±»å‹åˆ¤æ–­
                    if (task && task.model_cls) {
                        const modelCls = task.model_cls.toLowerCase();

                        return nameMap[task.task_type] || task.task_type;
                    }

                    // é»˜è®¤è¿”å›task_type
                    return task.task_type || 'æœªçŸ¥';
                };

                const getPromptPlaceholder = () => {
                    if (selectedTaskId.value === 't2v') {
                        return 'è¯·è¾“å…¥è§†é¢‘ç”Ÿæˆæç¤ºè¯ï¼Œæè¿°è§†é¢‘å†…å®¹ã€é£æ ¼ã€åœºæ™¯ç­‰...';
                    } else if (selectedTaskId.value === 'i2v') {
                        return 'è¯·è¾“å…¥è§†é¢‘ç”Ÿæˆæç¤ºè¯ï¼Œæè¿°åŸºäºå›¾ç‰‡çš„è§†é¢‘å†…å®¹ã€åŠ¨ä½œè¦æ±‚ç­‰...';
                    } else if (selectedTaskId.value === 's2v') {
                        return 'è¯·è¾“å…¥è§†é¢‘ç”Ÿæˆæç¤ºè¯ï¼Œæè¿°æ•°å­—äººå½¢è±¡ã€èƒŒæ™¯é£æ ¼ã€åŠ¨ä½œè¦æ±‚ç­‰...';
                    }
                    return 'è¯·è¾“å…¥è§†é¢‘ç”Ÿæˆæç¤ºè¯...';
                };

                const getStatusTextClass = (status) => {
                    if (status === 'SUCCEED') return 'text-emerald-400';
                    if (status === 'CREATED') return 'text-blue-400';
                    if (status === 'PENDING') return 'text-yellow-400';
                    if (status === 'RUNNING') return 'text-amber-400';
                    if (status === 'FAILED') return 'text-red-400';
                    if (status === 'CANCEL') return 'text-gray-400';
                    return 'text-gray-400';
                };



                const getImagePreview = (base64Data) => {
                    if (!base64Data) return '';
                    return `data:image/jpeg;base64,${base64Data}`;
                };

                const getTaskInputUrl = (taskId, key) => {
                    // ä¼˜å…ˆä»ç¼“å­˜è·å–
                    const cachedUrl = getTaskFileUrlSync(taskId, key);
                    if (cachedUrl) {
                        console.log('getTaskInputUrl: ä»ç¼“å­˜è·å–', { taskId, key, url: cachedUrl });
                        return cachedUrl;
                    }
                    
                    // ç¼“å­˜æ²¡æœ‰åˆ™ç”ŸæˆURLå¹¶ç¼“å­˜
                    const token = localStorage.getItem('accessToken');
                    const url = token 
                        ? `./assets/task/input?task_id=${taskId}&name=${key}&token=${encodeURIComponent(token)}`
                        : `./assets/task/input?task_id=${taskId}&name=${key}`;
                    
                    // ç¼“å­˜API URL
                    setTaskFileToCache(taskId, key, {
                        url: url,
                        timestamp: Date.now()
                    });
                    
                    console.log('getTaskInputUrl: ç”Ÿæˆå¹¶ç¼“å­˜è¾“å…¥URL', { taskId, key, url });
                    return url;
                };

                const getTaskInputImage = (task) => {
                    
                    if (!task || !task.inputs) {
                        console.log('getTaskInputImage: ä»»åŠ¡æˆ–è¾“å…¥ä¸ºç©º', { task: task?.task_id, inputs: task?.inputs });
                        return null;
                    }
                    
                    const imageInputs = Object.keys(task.inputs).filter(key =>
                        key.includes('image') ||
                        task.inputs[key].toString().toLowerCase().match(/\.(jpg|jpeg|png|gif|bmp|webp)$/)
                    );


                    if (imageInputs.length > 0) {
                        const firstImageKey = imageInputs[0];
                        // ä¼˜å…ˆä»ç¼“å­˜è·å–
                        const cachedUrl = getTaskFileUrlSync(task.task_id, firstImageKey);
                        if (cachedUrl) {
                            console.log('getTaskInputImage: ä»ç¼“å­˜è·å–', { taskId: task.task_id, key: firstImageKey, url: cachedUrl });
                            return cachedUrl;
                        }
                        // ç¼“å­˜æ²¡æœ‰åˆ™ç”ŸæˆURL
                        const url = getTaskInputUrl(task.task_id, firstImageKey);
                        console.log('getTaskInputImage: ç”ŸæˆURL', { taskId: task.task_id, key: firstImageKey, url });
                        return url;
                    }

                    console.log('getTaskInputImage: æ²¡æœ‰æ‰¾åˆ°å›¾ç‰‡è¾“å…¥');
                    return null;
                };

                const getTaskInputAudio = (task) => {
                    if (!task || !task.inputs) return null;
                    const audioInputs = Object.keys(task.inputs).filter(key =>
                        key.includes('audio') ||
                        task.inputs[key].toString().toLowerCase().match(/\.(mp3|wav|mp4|aac|ogg|m4a)$/)
                    );

                    if (audioInputs.length > 0) {
                        const firstAudioKey = audioInputs[0];
                        return getTaskInputUrl(task.task_id, firstAudioKey);
                    }

                    return null;
                };


                const handleThumbnailError = (event) => {
                    // å½“è¾“å…¥å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶ï¼Œæ˜¾ç¤ºé»˜è®¤å›¾æ ‡
                    const img = event.target;
                    const parent = img.parentElement;
                    parent.innerHTML = '<div class="w-full h-full bg-laser-purple/20 flex items-center justify-center"><i class="fas fa-video text-gradient-icon text-xl"></i></div>';
                };

                const handleImageError = (event) => {
                    // å½“å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶ï¼Œéšè—å›¾ç‰‡ï¼Œæ˜¾ç¤ºæ–‡ä»¶å
                    const img = event.target;
                    img.style.display = 'none';
                    // æ–‡ä»¶åå·²ç»æ˜¾ç¤ºï¼Œä¸éœ€è¦é¢å¤–å¤„ç†
                };

                const handleImageLoad = (event) => {
                    // å½“å›¾ç‰‡åŠ è½½æˆåŠŸæ—¶ï¼Œæ˜¾ç¤ºå›¾ç‰‡å’Œä¸‹è½½æŒ‰é’®ï¼Œéšè—æ–‡ä»¶å
                    const img = event.target;
                    img.style.display = 'block';
                    // æ˜¾ç¤ºä¸‹è½½æŒ‰é’®
                    const downloadBtn = img.parentElement.querySelector('button');
                    if (downloadBtn) {
                        downloadBtn.style.display = 'block';
                    }
                    // éšè—æ–‡ä»¶åspan
                    const span = img.parentElement.parentElement.querySelector('span');
                    if (span) {
                        span.style.display = 'none';
                    }
                };

                const handleAudioError = (event) => {
                    // å½“éŸ³é¢‘åŠ è½½å¤±è´¥æ—¶ï¼Œéšè—éŸ³é¢‘æ§ä»¶å’Œä¸‹è½½æŒ‰é’®ï¼Œæ˜¾ç¤ºæ–‡ä»¶å
                    const audio = event.target;
                    audio.style.display = 'none';
                    // éšè—ä¸‹è½½æŒ‰é’®
                    const downloadBtn = audio.parentElement.querySelector('button');
                    if (downloadBtn) {
                        downloadBtn.style.display = 'none';
                    }
                    // æ–‡ä»¶åå·²ç»æ˜¾ç¤ºï¼Œä¸éœ€è¦é¢å¤–å¤„ç†
                };

                const handleAudioLoad = (event) => {
                    // å½“éŸ³é¢‘åŠ è½½æˆåŠŸæ—¶ï¼Œæ˜¾ç¤ºéŸ³é¢‘æ§ä»¶å’Œä¸‹è½½æŒ‰é’®ï¼Œéšè—æ–‡ä»¶å
                    const audio = event.target;
                    audio.style.display = 'block';
                    // æ˜¾ç¤ºä¸‹è½½æŒ‰é’®
                    const downloadBtn = audio.parentElement.querySelector('button');
                    if (downloadBtn) {
                        downloadBtn.style.display = 'block';
                    }
                    // éšè—æ–‡ä»¶åspan
                    const span = audio.parentElement.parentElement.querySelector('span');
                    if (span) {
                        span.style.display = 'none';
                    }
                };


                const downloadTaskInput = async (taskId, inputName, fileName) => {
                    try {
                        const url = getTaskInputUrl(taskId, inputName);
                        const response = await fetch(url);

                        if (!response || !response.ok) {
                            throw new Error(`ä¸‹è½½å¤±è´¥: ${response ? response.status : 'è®¤è¯å¤±è´¥'}`);
                        }

                        const blob = await response.blob();
                        const downloadUrl = window.URL.createObjectURL(blob);

                        // åˆ›å»ºä¸‹è½½é“¾æ¥
                        const link = document.createElement('a');
                        link.href = downloadUrl;
                        // ä½¿ç”¨åŸå§‹æ–‡ä»¶åï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨inputName
                        const filename = inputName || fileName || `input_${taskId}`;
                        link.download = filename;
                        document.body.appendChild(link);
                        link.click();

                        // æ¸…ç†
                        document.body.removeChild(link);
                        window.URL.revokeObjectURL(downloadUrl);

                        showAlert('æ–‡ä»¶ä¸‹è½½æˆåŠŸ', 'success');
                    } catch (error) {
                        console.error('ä¸‹è½½å¤±è´¥:', error);
                        showAlert(`ä¸‹è½½å¤±è´¥: ${error.message}`, 'danger');
                    }
                };

                // ç›‘å¬currentPageå˜åŒ–ï¼ŒåŒæ­¥æ›´æ–°pageInput
                watch(currentPage, (newPage) => {
                    pageInput.value = newPage;
                });

                // ç›‘å¬paginationå˜åŒ–ï¼Œç¡®ä¿åˆ†é¡µç»„ä»¶æ›´æ–°
                watch(pagination, (newPagination) => {
                    console.log('paginationå˜åŒ–:', newPagination);
                    if (newPagination && newPagination.total_pages) {
                        // ç¡®ä¿å½“å‰é¡µä¸è¶…è¿‡æ€»é¡µæ•°
                        if (currentPage.value > newPagination.total_pages) {
                            currentPage.value = newPagination.total_pages;
                        }
                    }
                }, { deep: true });

                // ç»Ÿä¸€çš„åˆå§‹åŒ–å‡½æ•°
                const init = async () => {
                    try {
                        // 1. åŠ è½½æ¨¡å‹å’Œä»»åŠ¡æ•°æ®
                        await loadModels();
                        
                        // 3. é€‰æ‹©ä»»åŠ¡ç±»å‹ï¼ˆä¼˜å…ˆé€‰æ‹©æ•°å­—äººä»»åŠ¡ï¼‰
                        let selectedTaskType = null;
                        if (availableTaskTypes.value.includes('s2v')) {
                            selectedTaskType = 's2v';
                        } else if (availableTaskTypes.value.length > 0) {
                            selectedTaskType = availableTaskTypes.value[0];
                        }
                        
                        if (selectedTaskType) {
                            selectTask(selectedTaskType);
                            
                            // 4. ä¸ºé€‰ä¸­çš„ä»»åŠ¡ç±»å‹é€‰æ‹©ç¬¬ä¸€ä¸ªæ¨¡å‹
                            const currentForm = getCurrentForm();
                            if (!currentForm.model_cls && availableModelClasses.value.length > 0) {
                                selectModel(availableModelClasses.value[0]);
                            }
                        }

                        refreshTasks();
                        
                        // 2. åŠ è½½æ¨¡æ¿å’Œå†å²è®°å½•
                        await loadTemplates();
                        await getPromptHistory();
                        loadTaskFilesFromCache();
                        
                        console.log('åˆå§‹åŒ–å®Œæˆ:', {
                            currentUser: currentUser.value,
                            availableModels: models.value,
                            tasks: tasks.value,
                            selectedTaskType: selectedTaskType,
                            selectedModel: getCurrentForm().model_cls
                        });
                        
                    } catch (error) {
                        console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                        showAlert('åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'danger');
                    }
                };

                // é‡ç½®è¡¨å•å‡½æ•°ï¼ˆä¿ç•™æ¨¡å‹é€‰æ‹©ï¼Œæ¸…ç©ºå›¾ç‰‡ã€éŸ³é¢‘å’Œæç¤ºè¯ï¼‰
                const resetForm = async (taskType) => {
                    const currentForm = getCurrentForm();
                    const currentModel = currentForm.model_cls;
                    const currentStage = currentForm.stage;
                    
                    // é‡ç½®è¡¨å•ä½†ä¿ç•™æ¨¡å‹å’Œé˜¶æ®µ
                    switch (taskType) {
                        case 't2v':
                            t2vForm.value = {
                                task: 't2v',
                                model_cls: currentModel || '',
                                stage: currentStage || 'single_stage',
                                prompt: '',
                                seed: Math.floor(Math.random() * 1000000)
                            };
                            break;
                        case 'i2v':
                            i2vForm.value = {
                                task: 'i2v',
                                model_cls: currentModel || '',
                                stage: currentStage || 'multi_stage',
                                imageFile: null,
                                prompt: '',
                                seed: Math.floor(Math.random() * 1000000)
                            };
                            // ç›´æ¥æ¸…ç©ºi2vå›¾ç‰‡é¢„è§ˆ
                            i2vImagePreview.value = null;
                            // æ¸…ç†å›¾ç‰‡æ–‡ä»¶è¾“å…¥æ¡†
                            const imageInput = document.querySelector('input[type="file"][accept="image/*"]');
                            if (imageInput) {
                                imageInput.value = '';
                            }
                            break;
                        case 's2v':
                            s2vForm.value = {
                                task: 's2v',
                                model_cls: currentModel || '',
                                stage: currentStage || 'single_stage',
                                imageFile: null,
                                audioFile: null,
                                prompt: '',
                                seed: Math.floor(Math.random() * 1000000)
                            };
                            break;
                    }
                    
                    // å¼ºåˆ¶è§¦å‘Vueå“åº”å¼æ›´æ–°
                    setCurrentImagePreview(null);
                    setCurrentAudioPreview(null);
                    await nextTick();
                };

                // å¼€å§‹è½®è¯¢ä»»åŠ¡çŠ¶æ€
                const startPollingTask = (taskId) => {
                    if (!pollingTasks.value.has(taskId)) {
                        pollingTasks.value.add(taskId);
                        console.log(`å¼€å§‹è½®è¯¢ä»»åŠ¡çŠ¶æ€: ${taskId}`);
                        
                        // å¦‚æœè¿˜æ²¡æœ‰è½®è¯¢å®šæ—¶å™¨ï¼Œå¯åŠ¨ä¸€ä¸ª
                        if (!pollingInterval.value) {
                            pollingInterval.value = setInterval(async () => {
                                await pollTaskStatuses();
                            }, 1000); // æ¯1ç§’è½®è¯¢ä¸€æ¬¡
                        }
                    }
                };

                // åœæ­¢è½®è¯¢ä»»åŠ¡çŠ¶æ€
                const stopPollingTask = (taskId) => {
                    pollingTasks.value.delete(taskId);
                    console.log(`åœæ­¢è½®è¯¢ä»»åŠ¡çŠ¶æ€: ${taskId}`);
                    
                    // å¦‚æœæ²¡æœ‰ä»»åŠ¡éœ€è¦è½®è¯¢äº†ï¼Œæ¸…é™¤å®šæ—¶å™¨
                    if (pollingTasks.value.size === 0 && pollingInterval.value) {
                        clearInterval(pollingInterval.value);
                        pollingInterval.value = null;
                        console.log('åœæ­¢æ‰€æœ‰ä»»åŠ¡çŠ¶æ€è½®è¯¢');
                    }
                };

                const refreshTaskFiles = (task) => {
                    for (const [key, inputPath] of Object.entries(task.inputs)) {
                        getTaskFileUrlFromApi(task.task_id, key).then(url => {
                            console.log('refreshTaskFiles: input', task.task_id, key, url);
                        });
                    }
                    for (const [key, outputPath] of Object.entries(task.outputs)) {
                        getTaskFileUrlFromApi(task.task_id, key).then(url => {
                            console.log('refreshTaskFiles: output', task.task_id, key, url);
                        });
                    }
                };

                // è½®è¯¢ä»»åŠ¡çŠ¶æ€
                const pollTaskStatuses = async () => {
                    if (pollingTasks.value.size === 0) return;
                    
                    try {
                        const taskIds = Array.from(pollingTasks.value);
                        const response = await apiRequest(`./api/v1/task/query?task_ids=${taskIds.join(',')}`);
                        
                        if (response && response.ok) {
                            const tasksData = await response.json();
                            const updatedTasks = tasksData.tasks || [];
                            
                            // æ›´æ–°ä»»åŠ¡åˆ—è¡¨ä¸­çš„ä»»åŠ¡çŠ¶æ€
                            let hasUpdates = false;
                            updatedTasks.forEach(updatedTask => {
                                const existingTaskIndex = tasks.value.findIndex(t => t.task_id === updatedTask.task_id);
                                if (existingTaskIndex !== -1) {
                                    const oldTask = tasks.value[existingTaskIndex];
                                    tasks.value[existingTaskIndex] = updatedTask;
                                    console.log('updatedTask', updatedTask);
                                    console.log('oldTask', oldTask);
                                    
                                    // å¦‚æœçŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œè®°å½•æ—¥å¿—
                                    if (oldTask !== updatedTask) {
                                        hasUpdates = true;
                                        
                                        // å¦‚æœå½“å‰åœ¨æŸ¥çœ‹è¿™ä¸ªä»»åŠ¡çš„è¯¦æƒ…ï¼Œæ›´æ–°selectedTask
                                        if (modalTask.value && modalTask.value.task_id === updatedTask.task_id) {
                                            modalTask.value = updatedTask;
                                        }

                                        // å¦‚æœå½“å‰åœ¨projectsé¡µé¢ï¼Œæ›´æ–°tasks
                                        if (currentView.value === 'projects') {
                                            refreshTasks(true);
                                        }
                                        
                                        // å¦‚æœä»»åŠ¡å®Œæˆæˆ–å¤±è´¥ï¼Œåœæ­¢è½®è¯¢å¹¶æ˜¾ç¤ºæç¤º
                                        if (['SUCCEED', 'FAILED', 'CANCEL'].includes(updatedTask.status)) {
                                            stopPollingTask(updatedTask.task_id);
                                            refreshTaskFiles(updatedTask);
                                            if (currentView.value === 'projects') {
                                                refreshTasks(true);
                                            }
                                            
                                            // æ˜¾ç¤ºä»»åŠ¡å®Œæˆæç¤º
                                            if (updatedTask.status === 'SUCCEED') {
                                                showAlert('è§†é¢‘ç”Ÿæˆå®Œæˆï¼', 'success');
                                            } else if (updatedTask.status === 'FAILED') {
                                                showAlert('è§†é¢‘ç”Ÿæˆå¤±è´¥ï¼Œè¯·æŸ¥çœ‹è¯¦æƒ…', 'danger');
                                            } else if (updatedTask.status === 'CANCEL') {
                                                showAlert('ä»»åŠ¡å·²å–æ¶ˆ', 'warning');
                                            }
                                        }
                                    }
                                }
                            });
                            
                            // å¦‚æœæœ‰æ›´æ–°ï¼Œè§¦å‘ç•Œé¢åˆ·æ–°
                            if (hasUpdates) {
                                await nextTick();
                            }
                        }
                    } catch (error) {
                        console.error('è½®è¯¢ä»»åŠ¡çŠ¶æ€å¤±è´¥:', error);
                    }
                };

                // ä»»åŠ¡çŠ¶æ€ç®¡ç†
                const getTaskStatusDisplay = (status) => {
                    const statusMap = {
                        'CREATED': 'åˆ›å»º',
                        'PENDING': 'ç­‰å¾…',
                        'RUNNING': 'è¿›è¡Œ',
                        'SUCCEED': 'å®Œæˆ',
                        'FAILED': 'å¤±è´¥',
                        'CANCEL': 'å–æ¶ˆ'
                    };
                    return statusMap[status] || status;
                };

                const getTaskStatusColor = (status) => {
                    const colorMap = {
                        'CREATED': 'text-blue-400',
                        'PENDING': 'text-yellow-400',
                        'RUNNING': 'text-amber-400',
                        'SUCCEED': 'text-emerald-400',
                        'FAILED': 'text-red-400',
                        'CANCEL': 'text-gray-400'
                    };
                    return colorMap[status] || 'text-gray-400';
                };

                const getTaskStatusIcon = (status) => {
                    const iconMap = {
                        'CREATED': 'fas fa-clock',
                        'PENDING': 'fas fa-hourglass-half',
                        'RUNNING': 'fas fa-spinner fa-spin',
                        'SUCCEED': 'fas fa-check-circle',
                        'FAILED': 'fas fa-exclamation-triangle',
                        'CANCEL': 'fas fa-ban'
                    };
                    return iconMap[status] || 'fas fa-question-circle';
                };


                // ä»»åŠ¡æ—¶é—´æ ¼å¼åŒ–
                const getTaskDuration = (startTime, endTime) => {
                    if (!startTime || !endTime) return 'æœªçŸ¥';
                    const start = new Date(startTime * 1000);
                    const end = new Date(endTime * 1000);
                    const diff = end - start;
                    const minutes = Math.floor(diff / 60000);
                    const seconds = Math.floor((diff % 60000) / 1000);
                    return `${minutes}åˆ†${seconds}ç§’`;
                };

                // ç›¸å¯¹æ—¶é—´æ ¼å¼åŒ–
                const getRelativeTime = (timestamp) => {
                    if (!timestamp) return 'æœªçŸ¥';
                    const now = new Date();
                    const time = new Date(timestamp * 1000);
                    const diff = now - time;

                    const minutes = Math.floor(diff / 60000);
                    const hours = Math.floor(diff / 3600000);
                    const days = Math.floor(diff / 86400000);
                    const months = Math.floor(diff / 2592000000); // 30å¤©
                    const years = Math.floor(diff / 31536000000);

                    if (years > 0) {
                        return years === 1 ? 'ä¸€å¹´å‰' : `${years}å¹´å‰`;
                    } else if (months > 0) {
                        return months === 1 ? 'ä¸€ä¸ªæœˆå‰' : `${months}ä¸ªæœˆå‰`;
                    } else if (days > 0) {
                        return days === 1 ? 'ä¸€å¤©å‰' : `${days}å¤©å‰`;
                    } else if (hours > 0) {
                        return hours === 1 ? 'ä¸€å°æ—¶å‰' : `${hours}å°æ—¶å‰`;
                    } else if (minutes > 0) {
                        return minutes === 1 ? 'ä¸€åˆ†é’Ÿå‰' : `${minutes}åˆ†é’Ÿå‰`;
                    } else {
                        return 'åˆšåˆš';
                    }
                };

                // ä»»åŠ¡å†å²è®°å½•ç®¡ç†
                const getTaskHistory = () => {
                    return tasks.value.filter(task =>
                        ['SUCCEED', 'FAILED', 'CANCEL'].includes(task.status)
                    );
                };

                // å­ä»»åŠ¡è¿›åº¦ç›¸å…³å‡½æ•°
                const getOverallProgress = (subtasks) => {
                    if (!subtasks || subtasks.length === 0) return 0;
                    
                    let completedCount = 0;
                    subtasks.forEach(subtask => {
                        if (subtask.status === 'SUCCEED') {
                            completedCount++;
                        }
                    });
                    
                    return Math.round((completedCount / subtasks.length) * 100);
                };

                // è·å–è¿›åº¦æ¡æ ‡é¢˜
                const getProgressTitle = (subtasks) => {
                    if (!subtasks || subtasks.length === 0) return 'æ€»ä½“è¿›åº¦';
                    
                    const pendingSubtasks = subtasks.filter(subtask => subtask.status === 'PENDING');
                    const runningSubtasks = subtasks.filter(subtask => subtask.status === 'RUNNING');
                    
                    if (pendingSubtasks.length > 0) {
                        return 'æ’é˜ŸçŠ¶æ€';
                    } else if (runningSubtasks.length > 0) {
                        return 'æ­£åœ¨è¿è¡Œ';
                    } else {
                        return 'æ€»ä½“è¿›åº¦';
                    }
                };

                // è·å–è¿›åº¦ä¿¡æ¯
                const getProgressInfo = (subtasks) => {
                    if (!subtasks || subtasks.length === 0) return '0%';
                    
                    const pendingSubtasks = subtasks.filter(subtask => subtask.status === 'PENDING');
                    const runningSubtasks = subtasks.filter(subtask => subtask.status === 'RUNNING');
                    
                    if (pendingSubtasks.length > 0) {
                        // æ˜¾ç¤ºæ’é˜Ÿä¿¡æ¯
                        const firstPending = pendingSubtasks[0];
                        const queuePosition = firstPending.estimated_pending_order;
                        const estimatedTime = firstPending.estimated_pending_secs;
                        
                        let info = `æ’é˜Ÿä¸­`;
                        if (queuePosition !== null && queuePosition !== undefined) {
                            info += ` (ä½ç½®: ${queuePosition})`;
                        }
                        if (estimatedTime !== null && estimatedTime !== undefined) {
                            info += ` - ${formatDuration(estimatedTime)}`;
                        }
                        return info;
                    } else if (runningSubtasks.length > 0) {
                        // æ˜¾ç¤ºè¿è¡Œä¿¡æ¯
                        const firstRunning = runningSubtasks[0];
                        const workerName = firstRunning.worker_name || 'æœªçŸ¥';
                        const estimatedTime = firstRunning.estimated_running_secs;
                        
                        let info = `å­ä»»åŠ¡ ${workerName}`;
                        if (estimatedTime !== null && estimatedTime !== undefined) {
                            const elapses = firstRunning.elapses || {};
                            const runningTime = elapses['RUNNING-'] || 0;
                            const remaining = Math.max(0, estimatedTime - runningTime);
                            info += ` - å‰©ä½™ ${formatDuration(remaining)}`;
                        }
                        return info;
                    } else {
                        // æ˜¾ç¤ºæ€»ä½“è¿›åº¦
                        return getOverallProgress(subtasks) + '%';
                    }
                };

                const getSubtaskProgress = (subtask) => {
                    if (subtask.status === 'SUCCEED') return 100;
                    if (subtask.status === 'FAILED' || subtask.status === 'CANCEL') return 0;
                    
                    // å¯¹äºPENDINGå’ŒRUNNINGçŠ¶æ€ï¼ŒåŸºäºæ—¶é—´ä¼°ç®—è¿›åº¦
                    if (subtask.status === 'PENDING') {
                        // æ’é˜Ÿä¸­çš„ä»»åŠ¡ï¼Œè¿›åº¦ä¸º0
                        return 0;
                    }
                    
                    if (subtask.status === 'RUNNING') {
                        // è¿è¡Œä¸­çš„ä»»åŠ¡ï¼ŒåŸºäºå·²è¿è¡Œæ—¶é—´ä¼°ç®—è¿›åº¦
                        const elapses = subtask.elapses || {};
                        const runningTime = elapses['RUNNING-'] || 0;
                        const estimatedTotal = subtask.estimated_running_secs || 0;
                        
                        if (estimatedTotal > 0) {
                            const progress = Math.min((runningTime / estimatedTotal) * 100, 95); // æœ€å¤š95%ï¼Œé¿å…æ˜¾ç¤º100%ä½†æœªå®Œæˆ
                            return Math.round(progress);
                        }
                    }
                    
                    return 0;
                };

                const getSubtaskStatusText = (status) => {
                    const statusMap = {
                        'PENDING': 'æ’é˜Ÿä¸­',
                        'RUNNING': 'è¿è¡Œä¸­',
                        'SUCCEED': 'å·²å®Œæˆ',
                        'FAILED': 'å¤±è´¥',
                        'CANCEL': 'å·²å–æ¶ˆ'
                    };
                    return statusMap[status] || status;
                };

                const formatEstimatedTime = (subtask) => {
                    if (subtask.status === 'PENDING') {
                        const pendingSecs = subtask.estimated_pending_secs;
                        const queuePosition = subtask.estimated_pending_order;
                        
                        if (pendingSecs !== null && pendingSecs !== undefined) {
                            let info = formatDuration(pendingSecs);
                            if (queuePosition !== null && queuePosition !== undefined) {
                                info += ` (ä½ç½®: ${queuePosition})`;
                            }
                            return info;
                        }
                        return 'è®¡ç®—ä¸­...';
                    }
                    
                    if (subtask.status === 'RUNNING') {
                        const elapses = subtask.elapses || {};
                        const runningTime = elapses['RUNNING-'] || 0;
                        const estimatedTotal = subtask.estimated_running_secs || 0;
                        
                        if (estimatedTotal > 0) {
                            const remaining = Math.max(0, estimatedTotal - runningTime);
                            return `å‰©ä½™ ${formatDuration(remaining)}`;
                        }
                        return 'è®¡ç®—ä¸­...';
                    }
                    
                    return 'å·²å®Œæˆ';
                };

                const formatDuration = (seconds) => {
                    if (seconds < 60) {
                        return `${Math.round(seconds)}ç§’`;
                    } else if (seconds < 3600) {
                        const minutes = Math.round(seconds / 60);
                        return `${minutes}åˆ†é’Ÿ`;
                    } else {
                        const hours = Math.floor(seconds / 3600);
                        const minutes = Math.round((seconds % 3600) / 60);
                        return `${hours}å°æ—¶${minutes}åˆ†é’Ÿ`;
                    }
                };

                const getTaskFailureInfo = (task) => {
                    if (!task) return null;
                    
                    // æ£€æŸ¥ä»»åŠ¡çº§åˆ«çš„å¤±è´¥ä¿¡æ¯
                    if (task.fail_msg) {
                        return task.fail_msg;
                    }
                    
                    // æ£€æŸ¥å­ä»»åŠ¡çš„å¤±è´¥ä¿¡æ¯
                    if (task.subtasks && task.subtasks.length > 0) {
                        const failedSubtasks = task.subtasks.filter(subtask => 
                            (subtask.extra_info && subtask.extra_info.fail_msg) || subtask.fail_msg
                        );
                        if (failedSubtasks.length > 0) {
                            const msg = failedSubtasks.map(subtask => 
                                (subtask.extra_info && subtask.extra_info.fail_msg) || subtask.fail_msg
                            ).join('\n');
                            return msg;
                        }
                    }
                    
                    return null;
                };

                const getActiveTasks = () => {
                    return tasks.value.filter(task =>
                        ['CREATED', 'PENDING', 'RUNNING'].includes(task.status)
                    );
                };

                // ä»»åŠ¡æœç´¢å’Œè¿‡æ»¤å¢å¼º
                const searchTasks = (query) => {
                    if (!query) return tasks.value;
                    return tasks.value.filter(task => {
                        const searchText = [
                            task.task_id,
                            task.task_type,
                            task.model_cls,
                            task.params?.prompt || '',
                            getTaskStatusDisplay(task.status)
                        ].join(' ').toLowerCase();
                        return searchText.includes(query.toLowerCase());
                    });
                };

                const filterTasksByStatus = (status) => {
                    if (status === 'ALL') return tasks.value;
                    return tasks.value.filter(task => task.status === status);
                };

                const filterTasksByType = (type) => {
                    if (!type) return tasks.value;
                    return tasks.value.filter(task => task.task_type === type);
                };

                // æç¤ºæ¶ˆæ¯æ ·å¼ç®¡ç†
                const getAlertClass = (type) => {
                    const classMap = {
                        'success': 'animate-slide-down',
                        'warning': 'animate-slide-down',
                        'danger': 'animate-slide-down',
                        'info': 'animate-slide-down'
                    };
                    return classMap[type] || 'animate-slide-down';
                };

                const getAlertBorderClass = (type) => {
                    const borderMap = {
                        'success': 'border-green-500',
                        'warning': 'border-yellow-500',
                        'danger': 'border-red-500',
                        'info': 'border-blue-500'
                    };
                    return borderMap[type] || 'border-gray-500';
                };

                const getAlertTextClass = (type) => {
                    // ç»Ÿä¸€ä½¿ç”¨ç™½è‰²æ–‡å­—
                    return 'text-white';
                };

                const getAlertIcon = (type) => {
                    const iconMap = {
                        'success': 'fas fa-check text-white',
                        'warning': 'fas fa-exclamation text-white',
                        'danger': 'fas fa-times text-white',
                        'info': 'fas fa-info text-white'
                    };
                    return iconMap[type] || 'fas fa-info text-white';
                };

                const getAlertIconBgClass = (type) => {
                    const bgMap = {
                        'success': 'bg-green-500/30',
                        'warning': 'bg-yellow-500/30',
                        'danger': 'bg-red-500/30',
                        'info': 'bg-laser-purple/30'
                    };
                    return bgMap[type] || 'bg-laser-purple/30';
                };

                // ç›‘å¬å™¨ - ç›‘å¬ä»»åŠ¡ç±»å‹å˜åŒ–
                watch(() => selectedTaskId.value, () => {
                    const currentForm = getCurrentForm();

                    // åªæœ‰å½“å½“å‰è¡¨å•æ²¡æœ‰é€‰æ‹©æ¨¡å‹æ—¶ï¼Œæ‰è‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ªå¯ç”¨çš„æ¨¡å‹
                    if (!currentForm.model_cls) {
                        let availableModels;

                        availableModels = models.value.filter(m => m.task === selectedTaskId.value);

                        if (availableModels.length > 0) {
                            const firstModel = availableModels[0];
                            currentForm.model_cls = firstModel.model_cls;
                            currentForm.stage = firstModel.stage;
                        }
                    }

                    // æ³¨æ„ï¼šè¿™é‡Œä¸éœ€è¦é‡ç½®é¢„è§ˆï¼Œå› ä¸ºæˆ‘ä»¬è¦ä¿æŒæ¯ä¸ªä»»åŠ¡çš„ç‹¬ç«‹æ€§
                    // é¢„è§ˆä¼šåœ¨ selectTask å‡½æ•°ä¸­æ ¹æ®æ–‡ä»¶çŠ¶æ€æ¢å¤
                });

                watch(() => getCurrentForm().model_cls, () => {
                    const currentForm = getCurrentForm();

                    // åªæœ‰å½“å½“å‰è¡¨å•æ²¡æœ‰é€‰æ‹©é˜¶æ®µæ—¶ï¼Œæ‰è‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ªå¯ç”¨çš„é˜¶æ®µ
                    if (!currentForm.stage) {
                        let availableStages;

                        availableStages = models.value
                                .filter(m => m.task === selectedTaskId.value && m.model_cls === currentForm.model_cls)
                                .map(m => m.stage);

                        if (availableStages.length > 0) {
                            currentForm.stage = availableStages[0];
                        }
                    }
                });

                // ç”Ÿå‘½å‘¨æœŸ
                onMounted(async () => {
                    // è®¾ç½®åˆå§‹åŒ–loadingçŠ¶æ€
                    initLoading.value = true;
                    // æ·»åŠ å…¨å±€ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
                    document.addEventListener('click', handleClickOutside);

                    try {
                        // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
                        const savedToken = localStorage.getItem('accessToken');
                        const savedUser = localStorage.getItem('currentUser');

                        if (savedToken && savedUser) {
                            currentUser.value = JSON.parse(savedUser);
                            await init();
                        } else {
                            // æ£€æŸ¥æ˜¯å¦æ˜¯GitHubå›è°ƒ
                            const urlParams = new URLSearchParams(window.location.search);
                            const code = urlParams.get('code');
                            if (code) {
                                source = localStorage.getItem('loginSource');
                                await handleLoginCallback(code, source);
                            }
                        }
                    } catch (error) {
                        console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                        showAlert('åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'danger');
                    } finally {
                        isLoggedIn.value = true;
                        loginLoading.value = false;
                        initLoading.value = false;
                    }
                });

                // é¡µé¢å¸è½½æ—¶æ¸…ç†è½®è¯¢
                onUnmounted(() => {
                    if (pollingInterval.value) {
                        clearInterval(pollingInterval.value);
                        pollingInterval.value = null;
                    }
                    pollingTasks.value.clear();
                });

                // æç¤ºè¯æ¨¡æ¿ç®¡ç†
                const promptTemplates = {
                    's2v': [
                        {
                            id: 's2v_1',
                            title: 'å•†åŠ¡æ¼”è®²',
                            prompt: 'æ•°å­—äººè¿›è¡Œå•†åŠ¡æ¼”è®²ï¼Œè¡¨æƒ…è‡ªç„¶ï¼Œæ‰‹åŠ¿å¾—ä½“ï¼ŒèƒŒæ™¯ä¸ºç°ä»£åŒ–çš„ä¼šè®®å®¤ï¼Œæ•´ä½“é£æ ¼ä¸“ä¸šå•†åŠ¡ã€‚'
                        },
                        {
                            id: 's2v_2',
                            title: 'äº§å“ä»‹ç»',
                            prompt: 'æ•°å­—äººä»‹ç»äº§å“ç‰¹ç‚¹ï¼Œè¯­æ°”äº²åˆ‡ï¼ŒåŠ¨ä½œè‡ªç„¶ï¼ŒèƒŒæ™¯ä¸ºäº§å“å±•ç¤ºåŒºï¼Œçªå‡ºäº§å“çš„ç§‘æŠ€æ„Ÿå’Œå®ç”¨æ€§ã€‚'
                        }
                    ],
                    't2v': [
                        {
                            id: 't2v_1',
                            title: 'è‡ªç„¶é£æ™¯',
                            prompt: 'ä¸€ä¸ªå®é™çš„å±±è°·ï¼Œé˜³å…‰é€è¿‡äº‘å±‚æ´’åœ¨ç»¿è‰²çš„è‰åœ°ä¸Šï¼Œè¿œå¤„æœ‰é›ªå±±ï¼Œè¿‘å¤„æœ‰æ¸…æ¾ˆçš„æºªæµï¼Œç”»é¢æ¸©æš–è‡ªç„¶ï¼Œå……æ»¡ç”Ÿæœºã€‚'
                        },
                        {
                            id: 't2v_2',
                            title: 'åŸå¸‚å¤œæ™¯',
                            prompt: 'ç¹åçš„åŸå¸‚å¤œæ™¯ï¼Œéœ“è™¹ç¯é—ªçƒï¼Œé«˜æ¥¼å¤§å¦æ—ç«‹ï¼Œè½¦æµå¦‚ç»‡ï¼Œå¤©ç©ºä¸­æœ‰æ˜Ÿæ˜Ÿç‚¹ç¼€ï¼Œè¥é€ å‡ºéƒ½å¸‚çš„ç¹åæ°›å›´ã€‚'
                        },
                        {
                            id: 't2v_3',
                            title: 'ç§‘æŠ€æœªæ¥',
                            prompt: 'æœªæ¥ç§‘æŠ€åŸå¸‚ï¼Œé£è¡Œæ±½è½¦ç©¿æ¢­ï¼Œå…¨æ¯æŠ•å½±éšå¤„å¯è§ï¼Œå»ºç­‘å…·æœ‰æµçº¿å‹è®¾è®¡ï¼Œå……æ»¡ç§‘æŠ€æ„Ÿå’Œæœªæ¥æ„Ÿã€‚'
                        }
                    ],
                    'i2v': [
                        {
                            id: 'i2v_1',
                            title: 'äººç‰©åŠ¨ä½œ',
                            prompt: 'åŸºäºå‚è€ƒå›¾ç‰‡ï¼Œè®©è§’è‰²åšå‡ºè‡ªç„¶çš„è¡Œèµ°åŠ¨ä½œï¼Œä¿æŒåŸæœ‰çš„æœè£…å’Œé£æ ¼ï¼ŒèƒŒæ™¯å¯ä»¥é€‚å½“å˜åŒ–ã€‚'
                        },
                        {
                            id: 'i2v_2',
                            title: 'åœºæ™¯è½¬æ¢',
                            prompt: 'ä¿æŒå‚è€ƒå›¾ç‰‡ä¸­çš„äººç‰©å½¢è±¡ï¼Œå°†èƒŒæ™¯è½¬æ¢ä¸ºä¸åŒçš„å­£èŠ‚æˆ–ç¯å¢ƒï¼Œå¦‚ä»å®¤å†…åˆ°æˆ·å¤–ï¼Œä»ç™½å¤©åˆ°å¤œæ™šã€‚'
                        }
                    ]
                };

                const getPromptTemplates = (taskType) => {
                    return promptTemplates[taskType] || [];
                };


                const selectPromptTemplate = (template) => {
                    getCurrentForm().prompt = template.prompt;
                    showPromptModal.value = false;
                    showAlert(`å·²åº”ç”¨æ¨¡æ¿: ${template.title}`, 'success');
                };

                // æç¤ºè¯å†å²è®°å½•ç®¡ç† - ç°åœ¨ç›´æ¥ä»taskHistoryä¸­è·å–
                const promptHistory = ref([]);

                const getPromptHistory = async () => {
                    try {
                        // ä»taskHistoryä¸­è·å–promptå†å²ï¼Œå»é‡å¹¶æŒ‰æ—¶é—´æ’åº
                        const taskHistory = await getLocalTaskHistory();
                        const uniquePrompts = [];
                        const seenPrompts = new Set();
                        
                        // éå†taskHistoryï¼Œæå–å”¯ä¸€çš„prompt
                        for (const task of taskHistory) {
                            if (task.prompt && task.prompt.trim() && !seenPrompts.has(task.prompt.trim())) {
                                uniquePrompts.push(task.prompt.trim());
                                seenPrompts.add(task.prompt.trim());
                            }
                        }
                        
                        const result = uniquePrompts.slice(0, 10); // åªæ˜¾ç¤ºæœ€è¿‘10æ¡
                        promptHistory.value = result; // æ›´æ–°å“åº”å¼æ•°æ®
                        return result;
                    } catch (error) {
                        console.error('è·å–promptå†å²å¤±è´¥:', error);
                        promptHistory.value = []; // æ›´æ–°å“åº”å¼æ•°æ®
                        return [];
                    }
                };

                // addPromptToHistoryå‡½æ•°å·²åˆ é™¤ï¼Œç°åœ¨promptå†å²ç›´æ¥ä»taskHistoryä¸­è·å–

                // ä¿å­˜å®Œæ•´çš„ä»»åŠ¡å†å²ï¼ˆåŒ…æ‹¬æç¤ºè¯ã€å›¾ç‰‡ã€éŸ³é¢‘ï¼‰
                const addTaskToHistory = (taskType, formData) => {
                    const historyItem = {
                        id: Date.now(),
                        timestamp: new Date().toISOString(),
                        taskType: taskType,
                        prompt: formData.prompt || '',
                        imageFile: null,
                        audioFile: null
                    };

                    // ä¿å­˜å›¾ç‰‡æ–‡ä»¶
                    if (formData.imageFile) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            historyItem.imageFile = {
                                name: formData.imageFile.name,
                                type: formData.imageFile.type,
                                size: formData.imageFile.size,
                                data: e.target.result
                            };
                            saveTaskHistoryItem(historyItem);
                        };
                        reader.readAsDataURL(formData.imageFile);
                    } else {
                        // æ²¡æœ‰å›¾ç‰‡æ–‡ä»¶ï¼Œç›´æ¥ä¿å­˜
                        saveTaskHistoryItem(historyItem);
                    }

                    // ä¿å­˜éŸ³é¢‘æ–‡ä»¶
                    if (formData.audioFile) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            historyItem.audioFile = {
                                name: formData.audioFile.name,
                                type: formData.audioFile.type,
                                size: formData.audioFile.size,
                                data: e.target.result
                            };
                            saveTaskHistoryItem(historyItem);
                        };
                        reader.readAsDataURL(formData.audioFile);
                    }
                };

                // ä¿å­˜ä»»åŠ¡å†å²é¡¹åˆ°localStorage
                const saveTaskHistoryItem = (historyItem) => {
                    try {
                        const existingHistory = JSON.parse(localStorage.getItem('taskHistory') || '[]');
                        
                        // é¿å…é‡å¤æ·»åŠ ï¼ˆåŸºäºæç¤ºè¯å’Œä»»åŠ¡ç±»å‹ï¼‰
                        const isDuplicate = existingHistory.some(item => 
                            item.prompt === historyItem.prompt && 
                            item.taskType === historyItem.taskType
                        );
                        
                        if (!isDuplicate) {
                            // æŒ‰æ—¶é—´æˆ³æ’åºï¼Œç¡®ä¿æœ€æ–°çš„è®°å½•åœ¨æœ€å
                            existingHistory.push(historyItem);
                            existingHistory.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
                            
                            // é™åˆ¶å†å²è®°å½•æ•°é‡ï¼Œåˆ é™¤æœ€æ—§çš„è®°å½•ï¼ˆæœ€æ™šçš„è®°å½•ï¼‰
                            if (existingHistory.length > 20) {
                                // åˆ é™¤æœ€å‰é¢çš„è®°å½•ï¼ˆæœ€æ—§çš„ï¼‰
                                existingHistory.splice(0, existingHistory.length - 20);
                            }
                            
                            localStorage.setItem('taskHistory', JSON.stringify(existingHistory));
                            console.log('ä»»åŠ¡å†å²å·²ä¿å­˜:', historyItem);
                        }
                    } catch (error) {
                        console.error('ä¿å­˜ä»»åŠ¡å†å²å¤±è´¥:', error);
                    }
                };

                // è·å–æœ¬åœ°å­˜å‚¨çš„ä»»åŠ¡å†å²
                const getLocalTaskHistory = async () => {
                    try {
                        // ä½¿ç”¨Promiseæ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œï¼Œé¿å…é˜»å¡UI
                        return await new Promise((resolve) => {
                            setTimeout(() => {
                                try {
                                    const history = JSON.parse(localStorage.getItem('taskHistory') || '[]');
                                    // æŒ‰æ—¶é—´æˆ³æ’åºï¼Œæœ€æ–°çš„è®°å½•åœ¨å‰
                                    const sortedHistory = history.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                                    resolve(sortedHistory);
                                } catch (error) {
                                    console.error('è§£æä»»åŠ¡å†å²å¤±è´¥:', error);
                                    resolve([]);
                                }
                            }, 0);
                        });
                    } catch (error) {
                        console.error('è·å–ä»»åŠ¡å†å²å¤±è´¥:', error);
                        return [];
                    }
                };

                const selectPromptHistory = (prompt) => {
                    getCurrentForm().prompt = prompt;
                    showPromptModal.value = false;
                    showAlert('å·²åº”ç”¨å†å²æç¤ºè¯', 'success');
                };

                const clearPromptHistory = () => {
                    // æ¸…ç©ºtaskHistoryä¸­çš„promptç›¸å…³æ•°æ®
                    localStorage.removeItem('taskHistory');
                    showAlert('æç¤ºè¯å†å²å·²æ¸…ç©º', 'info');
                };

                // å›¾ç‰‡å†å²è®°å½•ç®¡ç†
                const getImageHistory = async () => {
                    try {
                        const taskHistory = await getLocalTaskHistory();
                        const uniqueImages = [];
                        const seenImages = new Set();
                        
                        // éå†taskHistoryï¼Œæå–å”¯ä¸€çš„å›¾ç‰‡
                        for (const task of taskHistory) {
                            if (task.imageFile && task.imageFile.name && !seenImages.has(task.imageFile.name)) {
                                uniqueImages.push({
                                    filename: task.imageFile.name,
                                    thumbnail: task.imageFile.data,
                                    data: task.imageFile.data,
                                    timestamp: task.timestamp
                                });
                                seenImages.add(task.imageFile.name);
                            }
                        }
                        
                        const result = uniqueImages.slice(0, 20); // åªæ˜¾ç¤ºæœ€è¿‘20æ¡
                        imageHistory.value = result;
                        return result;
                    } catch (error) {
                        console.error('è·å–å›¾ç‰‡å†å²å¤±è´¥:', error);
                        imageHistory.value = [];
                        return [];
                    }
                };

                // éŸ³é¢‘å†å²è®°å½•ç®¡ç†
                const getAudioHistory = async () => {
                    try {
                        const taskHistory = await getLocalTaskHistory();
                        const uniqueAudios = [];
                        const seenAudios = new Set();
                        
                        // éå†taskHistoryï¼Œæå–å”¯ä¸€çš„éŸ³é¢‘
                        for (const task of taskHistory) {
                            if (task.audioFile && task.audioFile.name && !seenAudios.has(task.audioFile.name)) {
                                uniqueAudios.push({
                                    filename: task.audioFile.name,
                                    data: task.audioFile.data,
                                    timestamp: task.timestamp
                                });
                                seenAudios.add(task.audioFile.name);
                            }
                        }
                        
                        const result = uniqueAudios.slice(0, 20); // åªæ˜¾ç¤ºæœ€è¿‘20æ¡
                        audioHistory.value = result;
                        return result;
                    } catch (error) {
                        console.error('è·å–éŸ³é¢‘å†å²å¤±è´¥:', error);
                        audioHistory.value = [];
                        return [];
                    }
                };

                // é€‰æ‹©å›¾ç‰‡å†å²è®°å½•
                const selectImageHistory = (history) => {
                    // åˆ›å»ºFileå¯¹è±¡
                    const byteCharacters = atob(history.data.split(',')[1]);
                    const byteNumbers = new Array(byteCharacters.length);
                    for (let i = 0; i < byteCharacters.length; i++) {
                        byteNumbers[i] = byteCharacters.charCodeAt(i);
                    }
                    const byteArray = new Uint8Array(byteNumbers);
                    const file = new File([byteArray], history.filename, { type: 'image/jpeg' });
                    
                    // è®¾ç½®å›¾ç‰‡é¢„è§ˆ
                    setCurrentImagePreview(history.data);
                    
                    // æ›´æ–°è¡¨å•
                    const currentForm = getCurrentForm();
                    currentForm.imageFile = file;
                    
                    showImageTemplates.value = false;
                    showAlert('å·²åº”ç”¨å†å²å›¾ç‰‡', 'success');
                };

                // é€‰æ‹©éŸ³é¢‘å†å²è®°å½•
                const selectAudioHistory = (history) => {
                    // åˆ›å»ºFileå¯¹è±¡
                    const byteCharacters = atob(history.data.split(',')[1]);
                    const byteNumbers = new Array(byteCharacters.length);
                    for (let i = 0; i < byteCharacters.length; i++) {
                        byteNumbers[i] = byteCharacters.charCodeAt(i);
                    }
                    const byteArray = new Uint8Array(byteNumbers);
                    const file = new File([byteArray], history.filename, { type: 'audio/mpeg' });
                    
                    // è®¾ç½®éŸ³é¢‘é¢„è§ˆ
                    setCurrentAudioPreview(history.data);
                    
                    // æ›´æ–°è¡¨å•
                    const currentForm = getCurrentForm();
                    currentForm.audioFile = file;
                    
                    showAudioTemplates.value = false;
                    showAlert('å·²åº”ç”¨å†å²éŸ³é¢‘', 'success');
                };

                // é¢„è§ˆéŸ³é¢‘å†å²è®°å½•
                const previewAudioHistory = (history) => {
                    const audio = new Audio(history.data);
                    audio.play().catch(error => {
                        console.error('éŸ³é¢‘æ’­æ”¾å¤±è´¥:', error);
                        showAlert('éŸ³é¢‘æ’­æ”¾å¤±è´¥', 'danger');
                    });
                };

                // æ¸…ç©ºå›¾ç‰‡å†å²è®°å½•
                const clearImageHistory = () => {
                    imageHistory.value = [];
                    showAlert('å›¾ç‰‡å†å²å·²æ¸…ç©º', 'info');
                };

                // æ¸…ç©ºéŸ³é¢‘å†å²è®°å½•
                const clearAudioHistory = () => {
                    audioHistory.value = [];
                    showAlert('éŸ³é¢‘å†å²å·²æ¸…ç©º', 'info');
                };

                const getAuthHeaders = () => {
                    const headers = {
                        'Content-Type': 'application/json'
                    };

                    const token = localStorage.getItem('accessToken');
                    if (token) {
                        headers['Authorization'] = `Bearer ${token}`;
                        console.log('ä½¿ç”¨Tokenè¿›è¡Œè®¤è¯:', token.substring(0, 20) + '...');
                    } else {
                        console.warn('æ²¡æœ‰æ‰¾åˆ°accessToken');
                    }
                    return headers;
                };

                // éªŒè¯tokenæ˜¯å¦æœ‰æ•ˆ
                const validateToken = async (token) => {
                    try {
                        const response = await fetch('./api/v1/model/list', {
                            method: 'GET',
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json'
                            }
                        });
                        await new Promise(resolve => setTimeout(resolve, 100));
                        return response.ok;
                    } catch (error) {
                        console.error('Token validation failed:', error);
                        return false;
                    }
                };

                // å¢å¼ºçš„APIè¯·æ±‚å‡½æ•°ï¼Œè‡ªåŠ¨å¤„ç†è®¤è¯é”™è¯¯
                const apiRequest = async (url, options = {}) => {
                    const headers = getAuthHeaders();

                    try {
                        const response = await fetch(url, {
                            ...options,
                            headers: {
                                ...headers,
                                ...options.headers
                            }
                        });
                        await new Promise(resolve => setTimeout(resolve, 100));
                        // æ£€æŸ¥æ˜¯å¦æ˜¯è®¤è¯é”™è¯¯
                        if (response.status === 401 || response.status === 403) {
                            // Tokenæ— æ•ˆï¼Œæ¸…é™¤æœ¬åœ°å­˜å‚¨å¹¶è·³è½¬åˆ°ç™»å½•é¡µ
                            logout();
                            showAlert('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•', 'warning');
                            return null;
                        }
                        return response;
                    } catch (error) {
                        console.error('API request failed:', error);
                        showAlert('ç½‘ç»œè¯·æ±‚å¤±è´¥', 'danger');
                        return null;
                    }
                };

                // ä¾§è¾¹æ æ‹–æ‹½è°ƒæ•´åŠŸèƒ½
                const sidebar = ref(null);
                const sidebarWidth = ref(256); // é»˜è®¤å®½åº¦ 256px (w-64)
                let isResizing = false;
                let startX = 0;
                let startWidth = 0;

                // æ›´æ–°æ‚¬æµ®æŒ‰é’®ä½ç½®
                const updateFloatingButtonPosition = (width) => {
                    const floatingBtn = document.querySelector('.floating-toggle-btn');
                    if (floatingBtn) {
                        if (sidebarCollapsed.value) {
                            // æ”¶èµ·çŠ¶æ€æ—¶ï¼ŒæŒ‰é’®ä½äºå±å¹•å·¦ä¾§
                            floatingBtn.style.left = '0px';
                            floatingBtn.style.right = 'auto';
                        } else {
                            // å±•å¼€çŠ¶æ€æ—¶ï¼ŒæŒ‰é’®ä½äºå†å²ä»»åŠ¡æ å³ä¾§
                            floatingBtn.style.left = width + 'px';
                            floatingBtn.style.right = 'auto';
                        }
                    }
                };

                const startResize = (e) => {
                    e.preventDefault();
                    console.log('startResize called');

                    isResizing = true;
                    startX = e.clientX;
                    startWidth = sidebar.value.offsetWidth;
                    console.log('Resize started, width:', startWidth);

                    document.body.classList.add('resizing');
                    document.addEventListener('mousemove', handleResize);
                    document.addEventListener('mouseup', stopResize);
                };

                const handleResize = (e) => {
                    if (!isResizing) return;

                    const deltaX = e.clientX - startX;
                    const newWidth = startWidth + deltaX;
                    const minWidth = 200;
                    const maxWidth = 500;

                    if (newWidth >= minWidth && newWidth <= maxWidth) {
                        // ç«‹å³æ›´æ–°æ‚¬æµ®æŒ‰é’®ä½ç½®ï¼Œä¸ç­‰å¾…å…¶ä»–æ›´æ–°
                        const floatingBtn = document.querySelector('.floating-toggle-btn');
                        if (floatingBtn && !sidebarCollapsed.value) {
                            floatingBtn.style.left = newWidth + 'px';
                        }
                        
                        sidebarWidth.value = newWidth; // æ›´æ–°å“åº”å¼å˜é‡
                        sidebar.value.style.setProperty('width', newWidth + 'px', 'important');
                        
                        // åŒæ—¶è°ƒæ•´ä¸»å†…å®¹åŒºåŸŸå®½åº¦
                        const mainContent = document.querySelector('.main-container main');
                        if (mainContent) {
                            mainContent.style.setProperty('width', `calc(100% - ${newWidth}px)`, 'important');
                        } else {
                            const altMain = document.querySelector('main');
                            if (altMain) {
                                altMain.style.setProperty('width', `calc(100% - ${newWidth}px)`, 'important');
                            }
                        }
                    } else {
                        console.log('Width out of range:', newWidth);
                    }
                };

                const stopResize = () => {
                    isResizing = false;
                    document.body.classList.remove('resizing');
                    document.removeEventListener('mousemove', handleResize);
                    document.removeEventListener('mouseup', stopResize);

                    // ä¿å­˜å½“å‰å®½åº¦åˆ°localStorage
                    if (sidebar.value) {
                        localStorage.setItem('sidebarWidth', sidebar.value.offsetWidth);
                    }
                };

                // åº”ç”¨å“åº”å¼ä¾§è¾¹æ å®½åº¦
                const applyResponsiveWidth = () => {
                    if (!sidebar.value) return;

                    const windowWidth = window.innerWidth;
                    let sidebarWidthPx;

                    if (windowWidth <= 768) {
                        sidebarWidthPx = 200;
                    } else if (windowWidth <= 1200) {
                        sidebarWidthPx = 250;
                    } else {
                        // å¤§å±å¹•æ—¶ä½¿ç”¨ä¿å­˜çš„å®½åº¦æˆ–é»˜è®¤å®½åº¦
                        const savedWidth = localStorage.getItem('sidebarWidth');
                        if (savedWidth) {
                            const width = parseInt(savedWidth);
                            if (width >= 200 && width <= 500) {
                                sidebarWidthPx = width;
                            } else {
                                sidebarWidthPx = 256; // é»˜è®¤ w-64
                            }
                        } else {
                            sidebarWidthPx = 256; // é»˜è®¤ w-64
                        }
                    }

                    sidebarWidth.value = sidebarWidthPx; // æ›´æ–°å“åº”å¼å˜é‡
                    sidebar.value.style.width = sidebarWidthPx + 'px';
                    
                    // æ›´æ–°æ‚¬æµ®æŒ‰é’®ä½ç½®
                    updateFloatingButtonPosition(sidebarWidthPx);
                    
                    const mainContent = document.querySelector('main');
                    if (mainContent) {
                        mainContent.style.width = `calc(100% - ${sidebarWidthPx}px)`;
                    }
                };

                // æ–°å¢ï¼šè§†å›¾åˆ‡æ¢æ–¹æ³•
                const switchToCreateView = () => {
                    currentView.value = 'create';
                };

                const switchToProjectsView = () => {
                    currentView.value = 'projects';
                    // åˆ·æ–°ä»»åŠ¡åˆ—è¡¨
                    refreshTasks(true);
                };

                const switchToInspirationView = () => {
                    currentView.value = 'inspiration';
                    // åŠ è½½çµæ„Ÿæ•°æ®
                    loadInspirationData();
                };

                // æ—¥æœŸæ ¼å¼åŒ–å‡½æ•°
                const formatDate = (date) => {
                    if (!date) return '';
                    const d = new Date(date);
                    return d.toLocaleDateString('zh-CN', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit'
                    });
                };

                // çµæ„Ÿå¹¿åœºç›¸å…³æ–¹æ³•
                const loadInspirationData = async () => {
                    try {
                        // åŠ è½½æ¨¡æ¿ä»»åŠ¡æ•°æ®
                        const response = await apiCall('./api/v1/template/tasks');
                        if (response.ok) {
                            const data = await response.json();
                            const templates = data.templates || [];
                            
                            // è½¬æ¢æ¨¡æ¿æ•°æ®ä¸ºçµæ„Ÿå¹¿åœºæ ¼å¼
                            const inspirationData = templates.map(template => {
                                const task = template.task;
                                
                                return {
                                    id: task.task_id,
                                    title: task.params.prompt || 'æœªå‘½åæ¨¡æ¿',
                                    description: `æ¨¡å‹: ${task.model_cls} | ç±»å‹: ${task.task_type}`,
                                    category: 'person',
                                    thumbnail: task.outputs?.output_video ? 
                                        `./api/v1/template/videos/${task.outputs.output_video}` : '',
                                    videoUrl: task.outputs?.output_video ? 
                                        `./api/v1/template/videos/${task.outputs.output_video}` : '',
                                    imageUrl: task.inputs?.input_image ? 
                                        `./api/v1/template/images/${task.inputs.input_image}` : '',
                                    audioUrl: task.inputs?.input_audio ? 
                                        `./api/v1/template/audios/${task.inputs.input_audio}` : '',
                                    tags: [task.model_cls, task.task_type, task.tag || 'æ¨¡æ¿'],
                                    createdAt: new Date(task.create_t),
                                    templateData: template // ä¿å­˜å®Œæ•´çš„æ¨¡æ¿æ•°æ®
                                };
                            });
                            
                            inspirationItems.value = inspirationData;
                            console.log('åŠ è½½æ¨¡æ¿æ•°æ®æˆåŠŸ:', inspirationData.length, 'ä¸ªæ¨¡æ¿');
                        } else {
                            console.warn('åŠ è½½æ¨¡æ¿æ•°æ®å¤±è´¥');
                        }
                    } catch (error) {
                        console.warn('åŠ è½½æ¨¡æ¿æ•°æ®å¤±è´¥:', error);
                    }
                };
                // ç­›é€‰çµæ„Ÿå†…å®¹
                const filteredInspirationItems = computed(() => {
                    let filtered = inspirationItems.value;
                    
                    // æŒ‰åˆ†ç±»ç­›é€‰
                    if (selectedInspirationCategory.value !== 'all') {
                        filtered = filtered.filter(item => item.category === selectedInspirationCategory.value);
                    }
                    
                    // æŒ‰æœç´¢å…³é”®è¯ç­›é€‰
                    if (inspirationSearchQuery.value.trim()) {
                        const query = inspirationSearchQuery.value.toLowerCase();
                        filtered = filtered.filter(item => 
                            item.title.toLowerCase().includes(query) ||
                            item.description.toLowerCase().includes(query) ||
                            item.tags.some(tag => tag.toLowerCase().includes(query))
                        );
                    }
                    
                    return filtered;
                });

                // é€‰æ‹©åˆ†ç±»
                const selectInspirationCategory = (categoryId) => {
                    selectedInspirationCategory.value = categoryId;
                };

                // è§†é¢‘æ’­æ”¾æ§åˆ¶
                const playVideo = (event) => {
                    const video = event.target;
                    if (video.readyState >= 2) { // HAVE_CURRENT_DATA
                        video.currentTime = 0; // ä»å¤´å¼€å§‹æ’­æ”¾
                        video.play().catch(e => {
                            console.log('è§†é¢‘æ’­æ”¾å¤±è´¥:', e);
                            // å¦‚æœè‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œå¯ä»¥å°è¯•ç”¨æˆ·äº¤äº’åæ’­æ”¾
                        });
                    } else {
                        // å¦‚æœè§†é¢‘è¿˜æ²¡åŠ è½½å®Œæˆï¼Œç­‰å¾…åŠ è½½å®Œæˆåå†æ’­æ”¾
                        video.addEventListener('loadeddata', () => {
                            video.currentTime = 0;
                            video.play().catch(e => console.log('è§†é¢‘æ’­æ”¾å¤±è´¥:', e));
                        }, { once: true });
                    }
                };

                const pauseVideo = (event) => {
                    const video = event.target;
                    video.pause();
                    video.currentTime = 0; // é‡ç½®åˆ°å¼€å¤´
                };

                const onVideoLoaded = (event) => {
                    const video = event.target;
                    // è§†é¢‘åŠ è½½å®Œæˆï¼Œå‡†å¤‡æ’­æ”¾
                    console.log('è§†é¢‘åŠ è½½å®Œæˆ:', video.src);
                };

                const onVideoError = (event) => {
                    const video = event.target;
                    console.error('è§†é¢‘åŠ è½½å¤±è´¥:', video.src, event);
                    // å¯ä»¥åœ¨è¿™é‡Œæ˜¾ç¤ºé”™è¯¯çŠ¶æ€æˆ–å›é€€åˆ°å›¾ç‰‡
                };

                // é¢„è§ˆæ¨¡æ¿è¯¦æƒ…
                const previewTemplateDetail = (item) => {
                    selectedTemplate.value = item;
                    showTemplateDetailModal.value = true;
                };

                // å…³é—­æ¨¡æ¿è¯¦æƒ…å¼¹çª—
                const closeTemplateDetailModal = () => {
                    showTemplateDetailModal.value = false;
                    selectedTemplate.value = null;
                };

                // ä½¿ç”¨æ¨¡æ¿
                const useTemplate = async (item) => {
                    if (!item || !item.templateData) {
                        showAlert('æ¨¡æ¿æ•°æ®ä¸å®Œæ•´', 'danger');
                        return;
                    }

                    try {
                        const template = item.templateData;
                        const task = template.task;

                        // å…ˆè®¾ç½®ä»»åŠ¡ç±»å‹
                        selectedTaskId.value = task.task_type;

                        // è·å–å½“å‰è¡¨å•
                        const currentForm = getCurrentForm();

                        // è®¾ç½®è¡¨å•æ•°æ®
                        currentForm.prompt = task.params?.prompt || '';
                        currentForm.negative_prompt = task.params?.negative_prompt || '';
                        currentForm.seed = task.params?.seed || 42;
                        currentForm.model_cls = task.model_cls || '';
                        currentForm.stage = task.stage || 'single_stage';

                        // å¦‚æœæœ‰è¾“å…¥å›¾ç‰‡ï¼Œå…ˆè®¾ç½®URLï¼Œå»¶è¿ŸåŠ è½½æ–‡ä»¶
                        if (task.inputs && task.inputs.input_image) {
                            const imageUrl = `./api/v1/template/images/${task.inputs.input_image}`;
                            currentForm.imageUrl = imageUrl;
                            setCurrentImagePreview(imageUrl); // ç›´æ¥ä½¿ç”¨URLä½œä¸ºé¢„è§ˆ
                            console.log('æ¨¡æ¿è¾“å…¥å›¾ç‰‡:', imageUrl);
                            
                            // å¼‚æ­¥åŠ è½½å›¾ç‰‡æ–‡ä»¶ï¼ˆä¸é˜»å¡UIï¼‰
                            setTimeout(async () => {
                                try {
                                    const imageResponse = await fetch(imageUrl);
                                    if (imageResponse.ok) {
                                        const blob = await imageResponse.blob();
                                        const filename = task.inputs.input_image;
                                        const file = new File([blob], filename, { type: blob.type });
                                        currentForm.imageFile = file;
                                        console.log('æ¨¡æ¿å›¾ç‰‡æ–‡ä»¶å·²åŠ è½½');
                                    }
                                } catch (error) {
                                    console.warn('Failed to load template image file:', error);
                                }
                            }, 100);
                        }

                        // å¦‚æœæœ‰è¾“å…¥éŸ³é¢‘ï¼Œå…ˆè®¾ç½®URLï¼Œå»¶è¿ŸåŠ è½½æ–‡ä»¶
                        if (task.inputs && task.inputs.input_audio) {
                            const audioUrl = `./api/v1/template/audios/${task.inputs.input_audio}`;
                            currentForm.audioUrl = audioUrl;
                            setCurrentAudioPreview(audioUrl); // ç›´æ¥ä½¿ç”¨URLä½œä¸ºé¢„è§ˆ
                            console.log('æ¨¡æ¿è¾“å…¥éŸ³é¢‘:', audioUrl);
                            
                            // å¼‚æ­¥åŠ è½½éŸ³é¢‘æ–‡ä»¶ï¼ˆä¸é˜»å¡UIï¼‰
                            setTimeout(async () => {
                                try {
                                    const audioResponse = await fetch(audioUrl);
                                    if (audioResponse.ok) {
                                        const blob = await audioResponse.blob();
                                        const filename = task.inputs.input_audio;
                                        
                                        // æ ¹æ®æ–‡ä»¶æ‰©å±•åç¡®å®šæ­£ç¡®çš„MIMEç±»å‹
                                        let mimeType = blob.type;
                                        if (!mimeType || mimeType === 'application/octet-stream') {
                                            const ext = filename.toLowerCase().split('.').pop();
                                            const mimeTypes = {
                                                'mp3': 'audio/mpeg',
                                                'wav': 'audio/wav',
                                                'mp4': 'audio/mp4',
                                                'aac': 'audio/aac',
                                                'ogg': 'audio/ogg',
                                                'm4a': 'audio/mp4'
                                            };
                                            mimeType = mimeTypes[ext] || 'audio/mpeg';
                                        }
                                        
                                        const file = new File([blob], filename, { type: mimeType });
                                        currentForm.audioFile = file;
                                        console.log('æ¨¡æ¿éŸ³é¢‘æ–‡ä»¶å·²åŠ è½½');
                                        // ä½¿ç”¨FileReaderç”Ÿæˆdata URLï¼Œä¸æ­£å¸¸ä¸Šä¼ ä¿æŒä¸€è‡´
                                        const reader = new FileReader();
                                        reader.onload = (e) => {
                                            setCurrentAudioPreview(e.target.result);
                                            console.log('æ¨¡æ¿éŸ³é¢‘é¢„è§ˆå·²è®¾ç½®:', e.target.result.substring(0, 50) + '...');
                                        };
                                        reader.readAsDataURL(file);
                                    }
                                } catch (error) {
                                    console.warn('Failed to load template audio file:', error);
                                }
                            }, 100);
                        }

                        // å…³é—­æ¨¡æ¿è¯¦æƒ…å¼¹çª—
                        closeTemplateDetailModal();

                        // åˆ‡æ¢åˆ°åˆ›å»ºè§†å›¾
                        currentView.value = 'create';

                        showAlert(`å·²åº”ç”¨æ¨¡æ¿: ${item.title}`, 'success');
                    } catch (error) {
                        console.error('åº”ç”¨æ¨¡æ¿å¤±è´¥:', error);
                        showAlert(`åº”ç”¨æ¨¡æ¿å¤±è´¥: ${error.message}`, 'danger');
                    }
                };

                // åŠ è½½æ›´å¤šçµæ„Ÿ
                const loadMoreInspiration = () => {
                    showAlert('åŠ è½½æ›´å¤šçµæ„ŸåŠŸèƒ½å¼€å‘ä¸­...', 'info');
                };

                // æ–°å¢ï¼šä»»åŠ¡è¯¦æƒ…å¼¹çª—æ–¹æ³•
                const openTaskDetailModal = (task) => {
                    modalTask.value = task;
                    showTaskDetailModal.value = true;
                    // åŠ è½½ä»»åŠ¡è¯¦æƒ…
                    viewTaskDetail(task);
                };

                const closeTaskDetailModal = () => {
                    showTaskDetailModal.value = false;
                    modalTask.value = null;
                    selectedTask.value = null;
                };

                // æ¢å¤ä¿å­˜çš„ä¾§è¾¹æ å®½åº¦
                onMounted(() => {
                    applyResponsiveWidth();

                    // ç›‘å¬çª—å£å¤§å°å˜åŒ–
                    window.addEventListener('resize', applyResponsiveWidth);
                    
                    // ç¡®ä¿æ‚¬æµ®æŒ‰é’®åˆå§‹ä½ç½®æ­£ç¡®
                    setTimeout(() => {
                        updateFloatingButtonPosition(sidebarWidth.value);
                    }, 100);
                });

                return {
                    isLoggedIn,
                    loading,
                    loginLoading,
                    initLoading,
                    downloadLoading,
                    loginWithGitHub,
                    loginWithGoogle,
                    // çŸ­ä¿¡ç™»å½•ç›¸å…³
                    phoneNumber,
                    verifyCode,
                    smsCountdown,
                    showSmsForm,
                    sendSmsCode,
                    loginWithSms,
                    toggleSmsLogin,
                    submitting,
                    searchQuery,
                    currentUser,
                    models,
                    tasks,
                    alert,
                    showErrorDetails,
                    showFailureDetails,
                    confirmDialog,
                    showConfirmDialog,
                    // æ–°å¢ï¼šè§†å›¾åˆ‡æ¢ç›¸å…³çŠ¶æ€
                    currentView,
                    showTaskDetailModal,
                    modalTask,
                    t2vForm,
                    i2vForm,
                    s2vForm,
                    getCurrentForm,
                    i2vImagePreview,
                    s2vImagePreview,
                    s2vAudioPreview,
                    getCurrentImagePreview,
                    getCurrentAudioPreview,
                    availableTaskTypes,
                    availableModelClasses,
                    filteredTasks,
                    selectedTaskId,
                    selectedTask,
                    selectedTaskFiles,
                    loadingTaskFiles,
                    statusFilter,
                    pagination,
                    paginationInfo,
                    currentPage,
                    pageSize,
                    pageInput,
                    paginationKey,
                    taskMenuVisible,
                    toggleTaskMenu,
                    closeAllTaskMenus,
                    handleClickOutside,
                    showAlert,
                    setLoading,
                    apiCall,
                    logout,
                    loadModels,
                    sidebarCollapsed,
                    sidebarWidth,
                    showExpandHint,
                    showGlow,
                    taskFileCache,
                    taskFileCacheLoaded,
                    loadTaskFiles,
                    downloadFile,
                    viewFile,
                    handleImageUpload,
                    selectTask,
                    selectModel,
                    resetForm,
                    triggerImageUpload,
                    triggerAudioUpload,
                    removeImage,
                    removeAudio,
                    handleAudioUpload,
                    loadTemplates,
                    checkTemplateUpdates,
                    checkTemplateChanges,
                    selectImageTemplate,
                    selectAudioTemplate,
                    previewAudioTemplate,
                    getTemplateFile,
                    imageTemplates,
                    audioTemplates,
                    showImageTemplates,
                    showAudioTemplates,
                    mediaModalTab,
                    imageHistory,
                    audioHistory,
                    templateFileCache,
                    showTemplates,
                    showHistory,
                    showPromptModal,
                    promptModalTab,
                    submitTask,
                    fileToBase64,
                    formatTime,
                    refreshTasks,
                    goToPage,
                    jumpToPage,
                    getVisiblePages,
                    preloadTaskFiles,
                    loadTaskFilesFromCache,
                    saveTaskFilesToCache,
                    getTaskFileFromCache,
                    setTaskFileToCache,
                    getTaskFileUrlFromApi,
                    getTaskFileUrl,
                    getTaskFileUrlSync,
                    getFirstImageKey,
                    loadFromCache,
                    saveToCache,
                    clearAllCache,
                    getStatusBadgeClass,
                    downloadSingleResult,
                    viewSingleResult,
                    cancelTask,
                    resumeTask,
                    deleteTask,
                    startPollingTask,
                    stopPollingTask,
                    viewTaskDetail,
                    reuseTask,
                    showTaskCreator,
                    toggleSidebar,
                    clearPrompt,
                    getTaskItemClass,
                    getStatusIndicatorClass,
                    getTaskTypeBtnClass,
                    getModelBtnClass,
                    getTaskTypeIcon,
                    getTaskTypeName,
                    getPromptPlaceholder,
                    getStatusTextClass,
                    getImagePreview,
                    getTaskInputUrl,
                    getTaskInputImage,
                    getTaskInputAudio,
                    handleThumbnailError,
                    handleImageError,
                    handleImageLoad,
                    handleAudioError,
                    handleAudioLoad,
                    downloadTaskInput,
                    getVideoUrl,
                    getTaskStatusDisplay,
                    getTaskStatusColor,
                    getTaskStatusIcon,
                    getTaskDuration,
                    getRelativeTime,
                    getTaskHistory,
                    getActiveTasks,
                    getOverallProgress,
                    getProgressTitle,
                    getProgressInfo,
                    getSubtaskProgress,
                    getSubtaskStatusText,
                    formatEstimatedTime,
                    formatDuration,
                    getTaskFailureInfo,
                    searchTasks,
                    filterTasksByStatus,
                    filterTasksByType,
                    getAlertClass,
                    getAlertBorderClass,
                    getAlertTextClass,
                    getAlertIcon,
                    getAlertIconBgClass,
                    getPromptTemplates,
                    selectPromptTemplate,
                    promptHistory,
                    getPromptHistory,
                    addTaskToHistory,
                    getLocalTaskHistory,
                    selectPromptHistory,
                    clearPromptHistory,
                    getImageHistory,
                    getAudioHistory,
                    selectImageHistory,
                    selectAudioHistory,
                    previewAudioHistory,
                    clearImageHistory,
                    clearAudioHistory,
                    getAudioMimeType,
                    getAuthHeaders,
                    startResize,
                    sidebar,
                    switchToCreateView,
                    switchToProjectsView,
                    switchToInspirationView,
                    openTaskDetailModal,
                    closeTaskDetailModal,
                    // çµæ„Ÿå¹¿åœºç›¸å…³
                    inspirationSearchQuery,
                    selectedInspirationCategory,
                    inspirationItems,
                    inspirationCategories,
                    filteredInspirationItems,
                    loadInspirationData,
                    selectInspirationCategory,
                    loadMoreInspiration,
                    // å·¥å…·å‡½æ•°
                    formatDate,
                    // æ¨¡æ¿è¯¦æƒ…å¼¹çª—ç›¸å…³
                    showTemplateDetailModal,
                    selectedTemplate,
                    previewTemplateDetail,
                    closeTemplateDetailModal,
                    useTemplate,
                    // è§†é¢‘æ’­æ”¾æ§åˆ¶
                    playVideo,
                    pauseVideo,
                    onVideoLoaded,
                    onVideoError
                };
            }
        }).mount('#app');
    </script>
</body>
</html>

